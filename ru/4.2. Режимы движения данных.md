В главе обсуждаются методы кодирования данных для передачи между процессами без совместно используемой памяти. Рассматриваются вопросы совместимости и эволюции схем, а также способы передачи данных через БД, сервисы и асинхронные сообщения.

### Поток данных через БД

В процессе работы с базой данных записывающий процесс кодирует данные, а читающий — декодирует. Это может быть один и тот же процесс, что делает обратную совместимость критически важной, иначе "будущее" состояние не сможет корректно интерпретировать ранее сохранённые данные. Часто происходит одновременное обращение к БД от различных приложений или экземпляров одного сервиса, что может привести к ситуации, когда новая версия кода записывает данные, а старая их читает. Прямая совместимость также необходима. При добавлении новых полей в схему важно, чтобы старая версия не изменяла их, чтобы избежать потери данных. Форматы кодирования могут поддерживать защиту от неопознанных полей, но иногда это нужно учитывать на уровне приложения, чтобы предотвратить их потерю при преобразовании.

![[20. Db data stream.png]]

### В разные моменты времени записываются различные значения

База данных позволяет обновлять значения в любое время, что означает, что данные могут иметь разные временные метки — от нескольких миллисекунд до пяти лет. При обновлении приложения новая версия может заменять старую, но данные остаются в исходном формате, что приводит к ситуации, когда "время жизни данных превышает время жизни кода". Миграция данных в новую схему возможна, но трудоемка, поэтому большинство баз данных избегают её. Простые изменения схемы, например, добавление столбца со значением null, обычно допустимы. Эволюция схемы позволяет базе данных выглядеть так, будто она использует единую схему, несмотря на различные версии записей.

### Архивное хранение

При создании резервных копий БД данные обычно кодируются по самой новой схеме, даже если в источнике присутствует смесь различных версий. Дамп данных, записываемый за один раз и неизменяемый, хорошо подходит для форматов, таких как Avro или столбцовый формат Parquet, что упрощает дальнейший анализ.

### Поток данных через сервисы: REST и RPC

Взаимодействие процессов по сети чаще всего организуется через архитектуру клиент-сервер. Серверы предоставляют API, к которому клиенты (например, браузеры или мобильные приложения) могут подключаться для выполнения запросов. Запросы могут быть GET (для получения данных) или POST (для отправки данных). API состоит из стандартных протоколов и форматов, таких как HTTP и JSON, что позволяет разным клиентам обращаться к серверам.

Сервисы могут также выступать в роли клиентов по отношению к другим сервисам, что поддерживает архитектуру микросервисов, где приложения разбиваются на более мелкие независимые сервисы. Это упрощает обновление и поддержку, позволяя каждой команде разработчиков работать над своим сервисом без зависимости от других. Совместимость форматов кодирования данных между различными версиями API критически важна для обеспечения бесшовной работы старых и новых версий.

### Веб-сервисы

Сервисы, использующие протокол HTTP, называются веб-сервисами, хотя они могут работать не только в Интернете. Клиентские приложения, такие как мобильные или JavaScript-приложения, выполняют запросы к таким сервисам, передавая их через Интернет или локальные сети. Веб-сервисы могут быть организованы в рамках одной компании или между различными организациями, обеспечивая обмен данными через общедоступные API.

Существуют два основных подхода к проектированию веб-сервисов: REST и SOAP. REST — это архитектурный стиль, акцентирующий внимание на простоте и использовании стандартных возможностей HTTP. API, основанные на REST, называют RESTful. В отличие от этого, SOAP — это протокол на основе XML, который требует множества дополнительных стандартов (WS-*), что делает его более сложным и менее удобным для использования.

API SOAP описывается с помощью WSDL, что позволяет генерировать код для интеграции с удаленными сервисами, но это менее удобно для динамически типизированных языков. SOAP продолжает использоваться в крупных организациях, но его популярность снижается, особенно среди малых компаний. В то же время REST-ориентированные API легче в разработке и интеграции, что делает их предпочтительными для современных приложений.

