Цель секционирования — равномерно распределить данные и запросы по узлам, что повышает производительность. Неравномерное секционирование вызывает асимметрию, где на некоторые узлы приходится больше данных или запросов, создавая горячие точки, что снижает эффективность системы. Простое случайное распределение данных решает эту проблему, но усложняет поиск данных, поскольку нужно параллельно опрашивать все узлы. Более эффективный способ — использовать ключи для предсказуемого распределения данных, как в алфавитном порядке.

### Секционирование по диапазонам значений ключа

Один из методов секционирования — использование непрерывных диапазонов значений ключей для разделения данных на секции, как в бумажной энциклопедии. Для поиска нужного ключа необходимо знать границы диапазонов и соответствие секций узлам. Границы секций могут быть одинаковыми или адаптированными под неравномерное распределение данных. Например, в энциклопедии одни тома могут содержать больше информации, чем другие, если диапазоны неравномерны. Базы данных, такие как Bigtable, HBase и MongoDB до версии 2.4, применяют эту стратегию секционирования.

Внутри каждой секции ключи могут храниться в отсортированном порядке, что упрощает индексацию и позволяет извлекать связанные записи одним запросом. Например, для данных с датчиками, где ключ — метка времени, можно эффективно извлекать данные за определенный период. Однако секционирование по диапазонам может привести к горячим точкам, если все записи поступают в одну секцию, например, для сегодняшней даты.

Для предотвращения перегрузки одной секции можно изменить структуру ключа: например, использовать сначала название датчика, а потом время. Это равномерно распределит нагрузку по секциям. Однако при запросах по диапазону данных для нескольких датчиков потребуется выполнить отдельный запрос для каждого датчика.

### Секционирование по хешу ключа

Многие распределенные базы данных используют хеш-функции для секционирования данных с целью избежать асимметрии и горячих точек. Хеш-функция преобразует данные в равномерно распределенные значения, что позволяет распределить их по узлам. Например, Cassandra и MongoDB применяют MD5. Хеш-функция не должна быть криптографически стойкой, достаточно обычной, равномерно распределяющей значения.

Секционирование по хешу помогает избежать перегрузки секций, распределяя данные по секциям на основе хеш-значений ключей. Однако этот метод теряет возможность выполнять запросы по диапазонам, поскольку ключи теряют порядок. Например, MongoDB и другие системы с хеш-секционированием требуют опроса всех секций при запросах по диапазону.

Cassandra решает проблему с помощью составных ключей, хешируя только первую часть ключа, а остальные столбцы используют для сортировки в SS-таблицах. Это позволяет эффективно выполнять запросы по диапазонам других столбцов, например, извлекать сообщения пользователя по метке времени.

### Асимметричные нагрузки и разгрузка горячих точек

