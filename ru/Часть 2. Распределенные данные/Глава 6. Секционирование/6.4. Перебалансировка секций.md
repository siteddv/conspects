Перебалансировка в базе данных — процесс перемещения нагрузки (данных, запросов) между узлами кластера для оптимизации работы системы. С ростом количества запросов и объема данных требуется добавление процессоров, дисков и памяти. Перебалансировка должна обеспечить равномерное распределение нагрузки, минимизировать перебои в работе базы данных и уменьшить затраты на ввод/вывод. Процесс должен быть быстрым, с минимальными переносами данных между узлами.

### Методики перебалансировки

Существует несколько различных способов распределения секций по узлам.
Обсудим вкратце их все по очереди.

### Как делать не следует: хеширование по модулю N

При секционировании по хешу использование оператора mod может привести к частым перемещениям данных при изменении количества узлов. Например, при переходе от 10 узлов к 11 или 12 ключи могут переместиться в другие узлы, что делает перебалансировку затратной. Вместо простого mod предложено использовать разбивку хешей на диапазоны, где каждый диапазон соответствует своей секции. Это уменьшает количество перемещаемых данных при изменении числа узлов и упрощает перебалансировку.

### Фиксированное количество секций

Для эффективной перебалансировки в распределенной базе данных рекомендуется создать значительно больше секций, чем узлов. Например, в кластере из 10 узлов можно создать 1000 секций, по 100 секций на узел. При добавлении нового узла он может "позаимствовать" несколько секций у каждого из существующих узлов до тех пор, пока распределение не станет равномерным. Секции перемещаются целиком, при этом количество данных и соответствие ключей секциям не изменяется, только их распределение по узлам. Этот процесс может занимать время, и во время перемещения используется старое распределение. 

![[39. Rebalancing sections.png]]

Система может учитывать производительность узлов, распределяя больше секций на более мощные узлы. Количество секций фиксируется при первоначальной настройке базы данных и обычно не меняется. Правильный выбор количества секций важен, так как слишком большое их количество увеличивает накладные расходы на управление, а слишком малое — приводит к дополнительным расходам. Идеальный размер секций зависит от изменений в объеме данных, поскольку большие секции требуют больше ресурсов для перебалансировки, а маленькие — увеличивают накладные расходы.

### Динамическое секционирование

