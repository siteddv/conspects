Вторичные индексы не идентифицируют записи однозначно, а служат для поиска значений по критериям, что усложняет их использование при секционировании баз данных. Это актуально для реляционных и документоориентированных БД, таких как HBase, Voldemort, Riak, Solr и Elasticsearch. Основные подходы к секционированию с вторичными индексами — по документам и по термам.

### Секционирование вторичных индексов по документам

При секционировании базы данных по документам каждый документ имеет уникальный ID, и данные делятся на секции по диапазонам ID (например, ID 0-499 — секция 0, 500-999 — секция 1). Для поиска автомобилей по дополнительным признакам (цвет, производитель) создаются вторичные индексы, которые автоматически обновляются при добавлении документов. Каждый индекс локален для своей секции, что позволяет эффективно выполнять записи, обновления и удаления.

![[37. Sectioning by secondary indexes.png]]

Однако при чтении данных возникает проблема: автомобили одного цвета могут быть распределены по нескольким секциям. В таком случае нужно выполнять запросы ко всем секциям и объединять результаты, что может быть затратным по времени. Этот процесс называется фрагментированным чтением (scatter/gather), и при параллельной обработке запросов он может увеличить время ожидания. Несмотря на это, фрагментированное чтение активно используется в таких системах, как MongoDB, Riak, Cassandra и Elasticsearch. Рекомендуется проектировать схему так, чтобы запросы по вторичным индексам обрабатывались в одной секции, хотя это не всегда возможно.