### **5.1. –ü–æ—á–µ–º—É –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ?**

–ü—Ä–∏ –æ–±—ã—á–Ω–æ–π –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –º—ã –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ **–∞–∫—Ç—É–∞–ª—å–Ω—ã–µ** –∑–∞–ø–∏—Å–∏, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º **—Ç–µ—Ä—è–µ–º –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π**.  
–≠—Ç–æ **–ø—Ä–æ–±–ª–µ–º–∞**, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–µ **–º–µ–Ω—è—é—Ç—Å—è –∑–∞–¥–Ω–∏–º —á–∏—Å–ª–æ–º**.

üìå **–ü—Ä–∏–º–µ—Ä:**

- **1 —Å–µ–Ω—Ç—è–±—Ä—è** —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ —Ä–∞–±–æ—Ç–∞–ª –≤ **–ú–∞–≥–∞–∑–∏–Ω–µ ‚Ññ1**, –ø—Ä–æ–¥–∞–ª **100 —Ç–æ–≤–∞—Ä–æ–≤**.
- **2 —Å–µ–Ω—Ç—è–±—Ä—è** —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω –≤ **–ú–∞–≥–∞–∑–∏–Ω ‚Ññ2**.
- –í —Ö—Ä–∞–Ω–∏–ª–∏—â–µ **–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–∞–≥–∞–∑–∏–Ω–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞**.

**–ß—Ç–æ –Ω–µ —Ç–∞–∫?**  
‚ùå –¢–µ–ø–µ—Ä—å –≤ –æ—Ç—á–µ—Ç–∞—Ö **–≤—Å–µ –ø—Ä–æ–¥–∞–∂–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ —Å—á–∏—Ç–∞—é—Ç—Å—è –ø—Ä–æ–¥–∞–∂–∞–º–∏ –ú–∞–≥–∞–∑–∏–Ω–∞ ‚Ññ2**, —Ö–æ—Ç—è **1 —Å–µ–Ω—Ç—è–±—Ä—è –æ–Ω —Ä–∞–±–æ—Ç–∞–ª –≤ –¥—Ä—É–≥–æ–º –º–∞–≥–∞–∑–∏–Ω–µ**!

**–†–µ—à–µ–Ω–∏–µ:**  
‚úÖ –í–º–µ—Å—Ç–æ –ø—Ä–æ—Å—Ç–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–µ–π **—Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é**  
‚úÖ –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–ª–æ–Ω–∫–∏ **–≤—Ä–µ–º–µ–Ω–∏ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö**

---

### **5.2. –ö–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç –∏—Å—Ç–æ—Ä–∏—á–Ω–æ—Å—Ç—å –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö?**

–î–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏—Å—Ç–æ—Ä–∏—á–Ω–æ—Å—Ç–∏ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏–Ω—Ü–∏–ø **SCD Type 2 (Slowly Changing Dimension)**:

- **–ö–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏ –ø—Ä–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–µ–π—Å—Ç–≤–∏—è (effective date)**
- **–°—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ –∑–∞–ø–∏—Å–µ–π —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è**, –∞ –Ω–µ –∑–∞–º–µ–Ω—è—é—Ç—Å—è

üìå **–ü—Ä–∏–º–µ—Ä —Ç–∞–±–ª–∏—Ü—ã `core.rental` —Å –∏—Å—Ç–æ—Ä–∏—á–Ω–æ—Å—Ç—å—é**

```
| rental_id | film_id | rental_date        | return_date        | is_active | valid_from          | valid_to            |
|-----------|--------|--------------------|--------------------|----------|--------------------|--------------------|
| 101       | 5      | 2024-09-01 10:00:00 | 2024-09-02 12:00:00 | FALSE    | 2024-09-01 10:00:00 | 2024-09-04 08:00:00 |
| 101       | 5      | 2024-09-01 10:00:00 | 2024-09-03 15:00:00 | TRUE     | 2024-09-04 08:00:00 | 9999-12-31 00:00:00 |
```

üü¢ –¢–µ–ø–µ—Ä—å –≤–∏–¥–Ω–æ, —á—Ç–æ –∑–∞–ø–∏—Å—å –±—ã–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ **4 —Å–µ–Ω—Ç—è–±—Ä—è –≤ 08:00**, –∏ **—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è –±—ã–ª–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞**.

---

### **5.3. –†–∞–∑–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∫ —Ö—Ä–∞–Ω–µ–Ω–∏—é –∏—Å—Ç–æ—Ä–∏—á–Ω–æ—Å—Ç–∏**

–°—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Ç–æ–¥–æ–≤ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

|–ú–µ—Ç–æ–¥|–û–ø–∏—Å–∞–Ω–∏–µ|–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ|
|---|---|---|
|**SCD Type 1**|–ü—Ä–æ—Å—Ç–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π, –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏|–ü–æ–¥—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏—è –Ω–µ –≤–∞–∂–Ω–∞|
|**SCD Type 2**|–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π —Å –¥–∞—Ç–∞–º–∏ `valid_from` –∏ `valid_to`|–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –µ—Å–ª–∏ –≤–∞–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è|
|**SCD Type 3**|–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º|–†–µ–¥–∫–æ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è)|

–í —Ö—Ä–∞–Ω–∏–ª–∏—â–µ **–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SCD Type 2**, —Ç–∞–∫ –∫–∞–∫ –æ–Ω **–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π**.

---

### **5.4. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏—Å—Ç–æ—Ä–∏—á–Ω–æ—Å—Ç–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ —Ñ–∞–∫—Ç–æ–≤ `rental`**

–î–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏—Å—Ç–æ—Ä–∏—á–Ω–æ—Å—Ç–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:  
‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫–∏ **`valid_from`** –∏ **`valid_to`**  
‚úÖ –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö **–∑–∞–∫—Ä—ã–≤–∞—Ç—å —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—É—é**

#### **1Ô∏è‚É£ –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ `core.rental`**

```sql
ALTER TABLE core.rental ADD COLUMN valid_from TIMESTAMP;
ALTER TABLE core.rental ADD COLUMN valid_to TIMESTAMP DEFAULT '9999-12-31';
```

#### **2Ô∏è‚É£ –ü–æ–º–µ—á–∞–µ–º —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ –∑–∞–ø–∏—Å–µ–π –∫–∞–∫ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ**

```sql
UPDATE core.rental
SET valid_to = CURRENT_TIMESTAMP, is_active = FALSE
WHERE rental_id IN (
    SELECT rental_id FROM staging.rental WHERE last_update > GetLastUpdate('rental')
);
```

#### **3Ô∏è‚É£ –í—Å—Ç–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**

```sql
INSERT INTO core.rental (rental_id, film_id, rental_date, return_date, is_active, valid_from, valid_to)
SELECT rental_id, film_id, rental_date, return_date, TRUE, CURRENT_TIMESTAMP, '9999-12-31'
FROM staging.rental
WHERE last_update > GetLastUpdate('rental');
```

üìå –¢–µ–ø–µ—Ä—å **–ª—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ** —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ **—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å—Ç–∞—Ä—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π**.

---

### **5.5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –∏—Å—Ç–æ—Ä–∏—á–Ω–æ—Å—Ç–∏**

**1Ô∏è‚É£ –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å**

```sql
INSERT INTO staging.rental (rental_id, film_id, rental_date, return_date, last_update)
VALUES (105, 10, '2024-09-05 10:00:00', NULL, CURRENT_TIMESTAMP);
```

üìå –í —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ø–æ—è–≤–∏–ª–∞—Å—å –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å.

**2Ô∏è‚É£ –ò–∑–º–µ–Ω—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å**

```sql
UPDATE staging.rental
SET return_date = '2024-09-06 18:00:00', last_update = CURRENT_TIMESTAMP
WHERE rental_id = 101;
```

üìå –¢–µ–ø–µ—Ä—å –≤ `core.rental` –¥–≤–µ –≤–µ—Ä—Å–∏–∏ —ç—Ç–æ–π –∑–∞–ø–∏—Å–∏: **—Å—Ç–∞—Ä–∞—è –∏ –Ω–æ–≤–∞—è**.

**3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç**

```sql
SELECT * FROM core.rental WHERE rental_id = 101;
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

```
| rental_id | rental_date        | return_date        | is_active | valid_from          | valid_to            |
|-----------|--------------------|--------------------|----------|--------------------|--------------------|
| 101       | 2024-09-01 10:00:00 | 2024-09-02 12:00:00 | FALSE    | 2024-09-01 10:00:00 | 2024-09-04 08:00:00 |
| 101       | 2024-09-01 10:00:00 | 2024-09-06 18:00:00 | TRUE     | 2024-09-04 08:00:00 | 9999-12-31 00:00:00 |
```

‚úÖ **–ò—Å—Ç–æ—Ä–∏—á–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç! –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ª—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –¥–∞–Ω–Ω—ã—Ö.**

---

### **–í—ã–≤–æ–¥ –ø–æ –ø—è—Ç–æ–π —á–∞—Å—Ç–∏**

üìå **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏—Å—Ç–æ—Ä–∏—á–Ω–æ—Å—Ç–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ —Ñ–∞–∫—Ç–æ–≤**  
üìå **–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤–æ –≤—Ä–µ–º–µ–Ω–∏**  
üìå **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ SCD Type 2, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ –∑–∞–ø–∏—Å–µ–π**

---

‚úÖ **–ü—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Å —á–∞—Å—Ç—å—é 6?**