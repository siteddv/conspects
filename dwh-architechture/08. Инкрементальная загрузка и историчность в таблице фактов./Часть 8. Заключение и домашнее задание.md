### **8.1. –¶–µ–ª—å —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —ç—Ç–∞–ø–∞**

–ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ **–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏**, **–∏—Å—Ç–æ—Ä–∏—á–Ω–æ—Å—Ç–∏** –∏ **–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏** —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å–ª–µ–¥—É—é—â–∏–º —ç—Ç–∞–ø–æ–º —Å—Ç–∞–ª–∞ –∑–∞–¥–∞—á–∞:  
‚úÖ **–û–±–æ–±—â–∏—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö**  
‚úÖ **–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –º–æ–¥–µ–ª—å —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –Ω–∞ –¥—Ä—É–≥—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö** (—á—Ç–æ–±—ã –∑–∞–∫—Ä–µ–ø–∏—Ç—å –∑–Ω–∞–Ω–∏—è)

üìå **–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ?**

- –í —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –º–æ–∂–µ—Ç **–º–µ–Ω—è—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö**
- –í–∞–∂–Ω–æ **–ø–æ–Ω–∏–º–∞—Ç—å –ª–æ–≥–∏–∫—É ETL-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤**, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –æ–¥–Ω–æ–π –±–∞–∑–æ–π
- –ü—Ä–∏ —Å–º–µ–Ω–µ –±–∞–∑—ã **–º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –Ω–æ–≤—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –Ω—é–∞–Ω—Å—ã**

---

### **8.2. –ò—Ç–æ–≥–æ–≤—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã —Ö—Ä–∞–Ω–∏–ª–∏—â–∞**

üìå **–≠—Ç–∞–ø 1: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Staging**

1. –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ –∏—Å—Ç–æ—á–Ω–∏–∫—É –¥–∞–Ω–Ω—ã—Ö (OLTP)
2. –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ **–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ** (–∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –∏ –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏)
3. –ü–æ–º–µ—á–∞–µ–º —É–¥–∞–ª–µ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ (`deleted IS NOT NULL`)
4. –°–æ—Ö—Ä–∞–Ω—è–µ–º `LastUpdate` –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–≥—Ä—É–∑–∫–∏

üìå **–≠—Ç–∞–ø 2: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Core**

1. **–û–±–Ω–æ–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—á–Ω–æ—Å—Ç—å (SCD Type 2)**
    - –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å ‚Üí **—Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é**
    - –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞ ‚Üí **–ø–æ–º–µ—á–∞–µ–º `is_active = FALSE`**
2. **–î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏**
3. **–û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏ (–µ—Å–ª–∏ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –Ω–∏—á–µ–≥–æ, –∫—Ä–æ–º–µ `return_date`)**

üìå **–≠—Ç–∞–ø 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**

1. –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —Å–≤—è–∑–∏ (`JOIN` –∏–∑–º–µ—Ä–µ–Ω–∏–π –∏ —Ñ–∞–∫—Ç–æ–≤)
2. –í—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É—é —Å–≤–µ—Ä–∫—É —Å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º
3. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º –∏–Ω–¥–µ–∫—Å—ã –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ë–î

---

### **8.3. –ü–µ—Ä–µ–Ω–æ—Å —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –Ω–∞ –¥—Ä—É–≥—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö**

**–ó–∞–¥–∞—á–∞:**  
‚úÖ –í–∑—è—Ç—å –¥—Ä—É–≥–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥—Ä—É–≥—É—é OLTP-—Å–∏—Å—Ç–µ–º—É)  
‚úÖ –†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ **–Ω–∞ –¥—Ä—É–≥–æ–π –°–£–ë–î**

üìå **–í—ã–±–æ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–µ—Å—Ç–∞**

- PostgreSQL **(–æ—Å–Ω–æ–≤–Ω–∞—è –ë–î, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π —Å—Ç—Ä–æ–∏–ª–æ—Å—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)**
- MySQL **(–ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤)**
- Microsoft SQL Server **(–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ T-SQL –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π)**

---

### **8.4. –ê–¥–∞–ø—Ç–∞—Ü–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–¥ MySQL**

–ü—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å–µ –Ω–∞ **MySQL** –≤–æ–∑–Ω–∏–∫–ª–∏ –Ω—é–∞–Ω—Å—ã:  
‚ùå `TIMESTAMP` –≤ MySQL –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `9999-12-31` ‚Üí **–∑–∞–º–µ–Ω—è–µ–º –Ω–∞ `NULL`**  
‚ùå `WITH RECURSIVE` –¥–ª—è –¥–∞—Ç ‚Üí **–ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã**  
‚ùå `UPDATE FROM` ‚Üí MySQL **–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç**, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `JOIN`

üìå **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π `UPDATE` –¥–ª—è MySQL**

```sql
UPDATE core_rental c
JOIN staging_rental s ON c.rental_id = s.rental_id
SET c.is_active = FALSE, c.valid_to = NOW()
WHERE s.deleted IS NOT NULL;
```

üìå **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö**

```sql
INSERT INTO core_rental (rental_id, film_id, rental_date, return_date, is_active, valid_from, valid_to)
SELECT s.rental_id, s.film_id, s.rental_date, s.return_date, TRUE, NOW(), NULL
FROM staging_rental s
WHERE NOT EXISTS (
    SELECT 1 FROM core_rental c WHERE c.rental_id = s.rental_id
);
```

‚úÖ **–¢–µ–ø–µ—Ä—å –∫–æ–¥ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω –¥–ª—è MySQL!**

---

### **8.5. –ü–µ—Ä–µ–Ω–æ—Å —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –Ω–∞ SQL Server (T-SQL)**

–í **SQL Server** —Ç–∞–∫–∂–µ –≤–æ–∑–Ω–∏–∫–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è:  
‚ùå `LAST_VALUE()` **—Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ-–¥—Ä—É–≥–æ–º—É** ‚Üí **–∏—Å–ø–æ–ª—å–∑—É–µ–º `ROW_NUMBER()`**  
‚ùå `TIMESTAMP` –≤ SQL Server **–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ —Ç–∞–∫, –∫–∞–∫ –≤ PostgreSQL**

üìå **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π `UPDATE` –≤ SQL Server**

```sql
UPDATE c
SET c.is_active = 0, c.valid_to = GETDATE()
FROM core_rental c
INNER JOIN staging_rental s ON c.rental_id = s.rental_id
WHERE s.deleted IS NOT NULL;
```

üìå **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `ROW_NUMBER()` –¥–ª—è –∏—Å—Ç–æ—Ä–∏—á–Ω–æ—Å—Ç–∏**

```sql
WITH RentalHistory AS (
    SELECT rental_id, film_id, rental_date, return_date, is_active, valid_from, valid_to,
           ROW_NUMBER() OVER (PARTITION BY rental_id ORDER BY valid_from DESC) AS rn
    FROM core_rental
)
UPDATE core_rental
SET is_active = CASE WHEN rn = 1 THEN 1 ELSE 0 END
WHERE rental_id IN (SELECT rental_id FROM RentalHistory);
```

‚úÖ **–¢–µ–ø–µ—Ä—å –∫–æ–¥ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω –¥–ª—è SQL Server!**

---

### **8.6. –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**

üöÄ **–•—Ä–∞–Ω–∏–ª–∏—â–µ —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –Ω–∞ —Ç—Ä–∏ –°–£–ë–î:**  
‚úÖ PostgreSQL **(–∏—Å—Ö–æ–¥–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞)**  
‚úÖ MySQL **(–∞–¥–∞–ø—Ç–∞—Ü–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤)**  
‚úÖ SQL Server **(–¥–æ—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–¥ T-SQL)**

üìå **–ß—Ç–æ –º—ã —Å–¥–µ–ª–∞–ª–∏?**  
‚úî –ü–æ–ª–Ω–æ—Å—Ç—å—é **—Ä–∞–∑—Ä–∞–±–æ—Ç–∞–ª–∏ ETL-–ø—Ä–æ—Ü–µ—Å—Å—ã**  
‚úî –î–æ–±–∞–≤–∏–ª–∏ **–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É –∏ –∏—Å—Ç–æ—Ä–∏—á–Ω–æ—Å—Ç—å**  
‚úî –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–ª–∏ **–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**  
‚úî –ü—Ä–æ–≤–µ—Ä–∏–ª–∏ –ø–µ—Ä–µ–Ω–æ—Å–∏–º–æ—Å—Ç—å **–º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –°–£–ë–î**

---

### **–ó–∞–∫–ª—é—á–µ–Ω–∏–µ: –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–±–æ—Ç—ã**

üí° **–¢–µ–ø–µ—Ä—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤–æ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö!**  
üìå **–û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:**  
‚úÖ –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è **–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö**  
‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ **–∏—Å—Ç–æ—Ä–∏—á–Ω–æ—Å—Ç–∏ (SCD Type 2)**  
‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è **—É—Å–∫–æ—Ä–∏–ª–∞ —Ä–∞–±–æ—Ç—É –Ω–∞ 50%**  
‚úÖ –ì–∏–±–∫–æ—Å—Ç—å –¥–ª—è —Ä–∞–±–æ—Ç—ã **—Å —Ä–∞–∑–Ω—ã–º–∏ –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö**

---

### **–î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏**

üü¢ **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ–º—ã –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è:**

1. **–†–µ–ø–ª–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** ‚Üí –ö–∞–∫ –¥–µ–ª–∞—Ç—å `CDC (Change Data Capture)`
2. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è ETL-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤** (Apache Airflow, SQL Jobs)
3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è BI-—Å–∏—Å—Ç–µ–º (Power BI, Tableau, Looker)**
4. **–†–∞–±–æ—Ç–∞ —Å –æ–±–ª–∞—á–Ω—ã–º–∏ DWH (BigQuery, Snowflake, Redshift)**