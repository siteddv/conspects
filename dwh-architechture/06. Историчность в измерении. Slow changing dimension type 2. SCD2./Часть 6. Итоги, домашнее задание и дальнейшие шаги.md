## 6.1. Подведение итогов по реализации SCD2

- **Успешная историзация `dim_inventory`**  
  Преподаватель напоминает, что теперь в таблице `dim_inventory` сохраняется вся история изменений. Для каждого `inventory_id` может существовать несколько версий записей с разными периодами (`effective_date_from`, `effective_date_to`) и флагом `is_active`.  

- **Решение проблемы «затирания» данных**  
  Благодаря SCD2, любая прошлое состояние объекта (компакт-диск) остаётся в базе: вместо простой перезаписи мы «закрываем» старую запись и «открываем» новую.  
  Это гарантирует, что аналитику по периодам можно строить корректно, не смешивая факты до и после изменений.

- **Отчёты**  
  В отчётности (особенно при работе с факт-таблицами, такими как `fact_rental` или `fact_payment`) легко учесть, какой фильм числился за диском в нужную дату.  
  Использование `is_active = true` быстро даёт текущие версии, а использование дат (`effective_date_from`, `effective_date_to`) позволяет восстанавливать картину на прошлые моменты времени.

## 6.2. Домашнее задание

1. **Аналогичная реализация SCD2 для `dim_staff`**  
   - Нужно повторить логику, аналогичную `dim_inventory`, но уже для таблицы сотрудников (`staff`).  
   - Сотрудники могут менять имя, фамилию, отдел или магазин, поэтому при изменении одного из атрибутов в источнике тоже нужно:
     - «Закрывать» старую строку в `dim_staff`.  
     - Добавлять новую, актуальную версию.  
   - Поля `effective_date_from`, `effective_date_to` и `is_active` должны быть добавлены в структуру `dim_staff`.

2. **Переписать процедуры загрузки**  
   - У учётных процедур (которые загружают данные из `staging.staff` в `dim_staff`) должен появиться тот же принцип:  
     - Обрабатывать «удалённые» (или уволенных) сотрудников.  
     - Вставлять новых.  
     - Закрывать и открывать записи при изменениях (SCD2).

3. **Проверить и протестировать**  
   - Нужно сделать тестовые изменения в источнике (операционной базе) — поменять, например, фамилию сотрудника, удалить кого-то, добавить нового.  
   - Убедиться, что всё корректно отображается в хранилище, как с дисками.

## 6.3. Дополнительные варианты SCD

Преподаватель кратко напоминает, что кроме SCD2 существуют и другие варианты:
- **SCD Type 0 (No Change)**: данные в измерении не меняются вообще, подходит крайне редко.  
- **SCD Type 1 (Overwrite)**: затираем старое значение новым, история не хранится.  
- **SCD Type 3 (Add Column)**: создаём дополнительное поле для «предыдущего» значения, но храним всего одну или две версии.  
- **SCD Type 4 (Mini-dimension)**: отдельное мини-измерение для атрибутов, которые часто меняются.  

В нашем случае SCD2 наиболее удобен, так как нужно хранить все изменения во времени.

## 6.4. Дальнейшие шаги в развитии DWH

1. **Инкрементальная загрузка фактов**  
   - Когда механизмы SCD2 внедрены в измерениях, можно безопасно обрабатывать фактические данные (rental, payment) инкрементальным способом.  
   - При загрузке фактов важно правильно сопоставлять дату сделки (проката, платежа) с актуальной версией измерения.

2. **Производительность и объёмы**  
   - По мере роста числа версий (для объектов, часто меняющих свои свойства) таблица может разрастаться. Нужно контролировать индексы, возможно, делать партиционирование по датам.  
   - Для отказа от «исторических» данных, которые более не нужны (например, очень старая история), могут предусматривать архивирование.

3. **Аналитические сценарии**  
   - С полным набором исторических данных аналитики могут задавать вопросы о том, как изменялись продажи, выручка или другие показатели при смене фильмов, сотрудников или других атрибутов.  
   - Это даёт гибкие возможности для глубокой аналитики и ретроспективного анализа.

## 6.5. Заключение

- **Преподаватель подчёркивает ценность SCD2**:  
  Без этого механизма построить корректный отчёт, учитывающий прежние состояния, очень сложно или невозможно.  
- **Дальнейшая практика**  
  Домашняя задача по `dim_staff` — лучший способ закрепить понимание. Аналогичный подход легко расширяется на любые измерения, которые действительно меняются со временем.  
- **Резюме**  
  Весь урок продемонстрировал, как добавить историчность в одно из ключевых измерений (`dim_inventory`). Аналогично можно делать для других справочников. Дальше — настройка факт-таблиц и полноценные отчёты на исторических данных.

---
