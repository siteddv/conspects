## 2.1. Зачем нужна историчность в хранилище данных

1. **Отсутствие истории в операционных базах**  
   - В большинстве прикладных систем (источниках) изменения в записях происходят путём простой перезаписи — старые данные затираются новыми.  
   - С точки зрения оперативной деятельности так удобнее и быстрее: «зачем хранить старое, если оно уже не актуально?».

2. **Проблемы при аналитике**  
   - Без сохранения прежних состояний невозможно понять, как именно менялись характеристики объектов (товаров, фильмов и т.д.) за определённый промежуток времени.  
   - При анализе доходов, количества продаж, рейтинга и т.д. может потребоваться учёт того, *каким* был атрибут в конкретный день, неделю, месяц.

3. **Роль историчности в DWH**  
   - Хранилище данных (DWH) проектируется так, чтобы ответы на вопросы о прошлых состояниях можно было получить в любой момент.  
   - Пример: если в прошлом году DVD-диск содержал фильм №1, а в этом — фильм №2, отчёты должны разделять периоды проката двух разных фильмов.

## 2.2. Пример с фильмами на компакт-дисках

1. **Исходные таблицы**  
   - **Таблица `inventory`** (в источнике) содержит записи о компакт-дисках, их идентификаторах (`inventory_id`) и номерах фильмов (`film_id`).  
   - **Таблица `film`** (в источнике) описывает сами фильмы: заголовок (title), рейтинг (rating) и т.п.  
   - В хранилище создаётся измерение `dim_inventory`, куда переносят информацию о дисках, а измерение `dim_film` (или поля в `dim_inventory`, если мы джойним их) тоже может содержать сводные данные.

2. **Сценарий «Перезапись»**  
   - Допустим, в таблице источника (операционной базе) у `inventory_id = 1` изначально стоял `film_id = 1` (Фильм A).  
   - Спустя время этот же компакт-диск переписали, и теперь `film_id = 2` (Фильм B).  
   - В операционной БД это выглядит как одно обновление: поле `film_id` в строке с `inventory_id = 1` просто изменяется с «1» на «2».

3. **Почему нужна историчность в DWH**  
   - Если в хранилище тоже просто «переписать» `film_id` с 1 на 2, то при построении отчёта за прошлый период (когда шли прокаты Фильма A) не будет видно, что диск когда-то принадлежал Фильму A.  
   - Аналитика по суммам проката фильмов будет некорректной: весь прокат окажется привязан к Фильму B, даже когда физически на диске был записан Фильм A.  
   - **Решение**: использовать *Slow Changing Dimensions*, где каждая смена атрибута (например, `film_id`) порождает *новую запись* в измерении с отдельным периодом действия.

## 2.3. Общий принцип SCD2 (упомянут кратко в видео)

1. **Добавление версионности**  
   - Вместо того чтобы хранить одну-единственную запись на `inventory_id`, в DWH будут **две** (или больше при множественных изменениях):  
     - Строка №1: компакт-диск с фильмом A, действовала «с такого-то момента» по «такой-то момент».  
     - Строка №2: тот же `inventory_id`, но уже фильм B, актуально «с момента изменения» и пока не появится новая замена.
2. **Использование временных полей**  
   - `effective_date_from` (или аналогичное название) — дата, начиная с которой строка считается активной.  
   - `effective_date_to` — дата, по которую строка была актуальной.  
   - При изменении старую версию «закрывают» (в `effective_date_to` ставят дату изменения), а новую строку «открывают» (в `effective_date_from` — ту же дату или время изменения, `effective_date_to` = «9999-12-31» или большая константа).
3. **Дополнительные возможности**  
   - Поле `is_active` может упростить отбор текущих версий (где `is_active = true`); иначе придётся сравнивать даты.  
   - Если нужно хранить не только сам факт фильма, но и подробности (название, рейтинг), иногда выносят это в отдельное измерение `dim_film` или совместно обновляют поля внутри `dim_inventory`.

## 2.4. Смысл для бизнеса: корректная отчётность

1. **Анализ по конкретному фильму**  
   - Сколько денег принёс Фильм A на всех носителях (компакт-дисках)?  
   - Без хранения истории можно ошибочно приписать выручку другому фильму, если диск перезаписали.  
   - SCD2 позволяет зафиксировать: «до 10.08.2022 диск №1 был Фильмом A, после — Фильмом B».
2. **Аудит изменений**  
   - Возможность задним числом проверить, почему в некоторый день изменилась статистика: «А, в этот день поменяли запись в источнике, и мы добавили новую версию в хранилище».  
   - В случае финансовых и управленческих отчётов это особенно важно.

## 2.5. Логический вывод из примера

- **Главная идея**: необходимо **не затирать** старую информацию, а **добавлять** новую строку в измерение всякий раз, когда в источнике меняется ключевой атрибут (например, `film_id`).
- **Подготовка к реализации**: в следующей части видео автор переходит к детальному описанию SCD, называя типы (0, 1, 2, 3, 4), и далее показывает, **как** конкретно внедряется SCD2 в таблицу `dim_inventory`.

---

### Краткий итог раздела
Во второй части преподаватель детально объясняет, почему важно хранить в DWH **историю изменений** (особенно в справочниках/измерениях). На примере «перезаписи» фильма на одном и том же диске показано, что без SCD2 анализ выручки или статистики по фильмам будет искажённым. Историчность решается введением нескольких версий записи для одного `inventory_id`, каждая из которых отражает состояние диска в свой временной интервал.  
