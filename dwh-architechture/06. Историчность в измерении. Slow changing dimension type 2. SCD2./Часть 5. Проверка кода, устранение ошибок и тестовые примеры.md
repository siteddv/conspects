## Шаги по тестированию и выявлению ошибок
1. **Перезагрузка слоёв (Full Load) для проверки**  
   - После внесения изменений в DDL (структуру таблиц) и DML (процедуры вставки/обновления) выполняется «полная» перезагрузка (`FULL LOAD`) из `staging` в `core`.
   - Важно отследить, не возникает ли ошибок нарушения уникальности, отсутствия колонок и т. п.

2. **Конфликты уникальности (constraint violation)**  
   - При реализации SCD2 **убирается** ограничение уникальности по `inventory_id`, так как теперь в `dim_inventory` на один `inventory_id` может быть несколько строк.
   - Если constraint остался, при добавлении «новой версии» записи будет ошибка «duplicate key value violates unique constraint».

3. **Проверка правильности полей “deleted” и “last_update”**  
   - Убедиться, что из `staging` действительно передаются корректные значения (не перепутаны названия колонок).  
   - Частая ошибка: попробовать взять `deleted` из `dim_inventory` вместо `staging` или забыть добавить поле `last_update` при вставке.

4. **Исправление некорректных ссылок/полей в скриптах**  
   - Если при выполнении скрипта возникает ошибка «column does not exist», надо проверить, что в `INSERT`, `UPDATE` чётко совпадают названия колонок между `staging` и `core`.
   - Синтаксис операций `ALTER TABLE` тоже может потребовать дополнительной точности (указать `SET NOT NULL` или изменить тип поля).

## Тестовые примеры для подтверждения функциональности
1. **Сценарий “Изменение фильма на диске”**  
   - В источнике: взять запись `inventory_id = 1` (например, фильм 3) и заменить на фильм 1.  
   - Запустить загрузку, проверить, что в `dim_inventory` теперь **две** строки с `inventory_id = 1`:  
     - Одна «закрыта» (старый фильм) с актуальностью до момента изменения.  
     - Другая «открыта» с новой датой начала.

2. **Сценарий “Добавление нового диска”**  
   - Добавить в `inventory` источника строку с новым `inventory_id`.  
   - После загрузки в `dim_inventory` должна появиться новая запись с `effective_date_from = 1900-01-01` (или другой «стартовой» датой) и `effective_date_to = 9999-12-31`, `is_active = true`.

3. **Сценарий “Удаление диска”**  
   - Пометить удалённым (заполнить `deleted`) запись в источнике.  
   - После загрузки в `dim_inventory`:  
     - Строка с `is_active = true` должна стать `false`,  
     - `effective_date_to` заполнится датой удаления.

4. **Проверка соответствия фактов**  
   - При загрузке фактов (`rental`, `payment`) убедиться, что они ссылаются на корректную «актуальную» версию в `dim_inventory` по логике дат (пример: `rental_date` между `effective_date_from` и `effective_date_to`).

## Итог раздела
- Основные проблемы, с которыми столкнулись: необходимость удаления уникального индекса по `inventory_id`, правильная ссылка на поля `deleted` и `last_update`, аккуратный синтаксис при `UPDATE` и `INSERT`.
- Тесты подтвердили, что теперь, при добавлении/изменении/удалении в источнике, **в “core” сохраняется вся история**.
