### 2.1 Потенциально изменяемые поля в таблице `film`

1. **Название фильма (`title`)**
    
    - Теоретически название может измениться, но это **маловероятно**. На практике бывает крайне редко (например, переименование фильма на международном рынке), но в реальном кино-прокате часто название уже закреплено.
    - Вопрос: стоит ли отражать переименование фильма как историческое событие? Если это важно для отчётов (например, хотят видеть статистику «до» и «после» смены названия), — то да. Если нет — можно игнорировать.
2. **Описание фильма (`description`)**
    
    - Может меняться (например, уточняется или дополняется), но для аналитики обычно не является критичным.
    - Часто это текстовое поле, и хранение «исторических» версий описания может быть избыточным.
3. **Год выпуска (`release_year`)**
    
    - Как правило, **не меняется**. Если всё-таки ошибочно завели год и потом исправили — это единичный случай, который можно либо учесть, либо нет.
4. **Рейтинг фильма (`rating`)**
    
    - Может меняться (например, пересмотр возрастного рейтинга), и в бизнес-логике проката (например, если есть ограничения по возрасту) это может влиять на аналитику.
    - Если компания анализирует, какие рейтинги более прибыльны, то историчность по этому полю важна.
5. **Поля, связанные с прокатом (`rental_duration`, `rental_rate`)**
    
    - **Критически важные** для бизнес-процессов.
    - Меняются чаще всего, так как магазин может пересмотреть условия аренды: увеличить срок, поднять/снизить цену.
    - Влияние на аналитику: важно понимать, сколько зарабатывали при старой ставке аренды и сколько при новой.
6. **Другие поля (длительность, актёрский состав, язык и т.д.)**
    
    - Некоторые (как длительность фильма) обычно не меняются.
    - Другие (например, язык) — может теоретически поменяться, если в таблице `film` ведут учёт локализованных версий. Но если не критично для бизнеса, можно не вести историчность.

---

### 2.2 Почему важна историчность по `film`

1. **Связь изменений фильма с фактами аренды**
    
    - Если в момент, когда арендуют фильм, у него были определённые условия (`rental_rate`, `rental_duration`), в отчёте хотелось бы увидеть именно те значения, что были актуальны на дату аренды.
    - Пример: если цена аренды повысилась с 0.99$ до 4.99$, это резко меняет финансовую статистику.
2. **Редкие, но ключевые изменения**
    
    - Название (если вдруг меняется) может повлиять на поиск или отчётность в разрезе названий.
    - Рейтинг (возрастной или иной) может влиять на то, кто фильм берёт в прокат, или иметь маркетинговое значение.
3. **Аналитический аспект**
    
    - Исторические отчёты (ретроспектива) — «Сколько мы зарабатывали на фильме до изменения цены?»
    - Сравнения эффективности проката после изменения условий (длительности, цены) → помогает решать, была ли корректной новая бизнес-стратегия.

---

### 2.3 Необходимость решать, какие поля версионировать

1. **Избыточность хранения**
    
    - Не все поля стоит вести с историей: это может привести к росту объёма хранилища без существенной пользы.
    - Нужно согласовать с бизнесом, какие изменения имеют смысл (например, изменение описания может не иметь значимой ценности).
2. **Приоритетные поля**
    
    - Обычно основное внимание — тарифы аренды, продолжительность аренды (`rental_rate`, `rental_duration`) и возможный возрастной рейтинг.
    - Поля вроде `title` и `rating` (если он влияет на бизнес-процессы) тоже можно учитывать.
3. **Гибкий подход**
    
    - В некоторых проектах достаточно просто **обновлять** несущественные поля (название, описание) без создания новой версии SCD.
    - Существенные же (рейтинг, цена аренды) вызывают появление новой строки SCD Type 2.

---

### 2.4 Сложности при реализации

1. **Фильмы без дисков**
    
    - В источнике могут существовать фильмы (в таблице `film`), по которым ещё нет ни одного компакт-диска (`inventory`).
    - Если эти фильмы меняются, нужно ли нам что-то «историть» в `dim_inventory`? Пока у нас нет `inventory_id`, записей в `dim_inventory` просто нет.
    - Решение: либо игнорировать изменения, пока нет диска, либо вести отдельное измерение `dim_film`. Но в текущем проекте выбрана de-normalized модель, где всё складывается в `dim_inventory`.
2. **Мульти-связи**
    
    - Теоретически на одном `inventory_id` может быть несколько фильмов последовательно (перезапись диска). Нужно учитывать все смены, плюс параллельные изменения в самих фильмах.
3. **Редкие, но возможные коллизии**
    
    - Если название фильма меняется и в тот же день на диске сменили сам фильм, в исторической таблице сложнее понять порядок, если нет точных временных меток.
    - Нужно договариваться или обрабатывать данные с достаточной детализацией времени (`timestamp`), а не только дат.

---

### 2.5 Итоговое понимание обоснованности историчности по `film`

- **Главная мысль**: изменения в полях, которые влияют на аналитику (прокат, доход, классификацию), требуют фиксации в историческом виде.
- **Возможно**, некоторые поля вроде названия или описания можно просто обновлять «в одной строке» без создания новой версии (зависит от требований бизнеса).
- Однако в **учебном примере** (и часто на реальном проекте) обычно решают вести полноценную историчность по тем полям, которые уже «втащили» из `film` в `dim_inventory`.

> **Резюме Часть 2**:
> 
> - Определяем, **какие поля действительно важны** и требуют SCD Type 2 (рейтинг, `rental_rate`, `rental_duration` и т.д.).
> - Учитываем бизнес-требования: не всё подряд нужно историть.
> - Признаём, что модель «звезда» с «расширенным» `dim_inventory` усложняется, раз нужно отражать и смену фильма на диске, и изменения самого фильма.
> - Это подводит к вопросам, **как** именно писать SQL, чтобы вытягивать изменения в `film` и аккуратно вносить новые версии строк в DWH.