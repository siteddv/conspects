#### **3.1 Создание схемы Core-слоя**

- **В Core-слое создаем 4 таблицы**:
    
    1. **Измерение сотрудников (`dim_staff`)**
    2. **Измерение фильмов и дисков (`dim_inventory`)**
    3. **Факт платежей (`fact_payment`)**
    4. **Факт аренды (`fact_rental`)**
- **Как связаны измерения и факты?**
    
    - `fact_payment` ссылается на:
        - **`dim_inventory`** (информация о фильмах и дисках)
        - **`dim_staff`** (информация о сотрудниках)
    - `fact_rental` ссылается на:
        - **`dim_inventory`**
        - **`dim_staff`**
- **Используется схема "Звезда"**:
    
    - Факты связаны с измерениями через **суррогатные ключи**.
    - **Пример:** `fact_payment` → `dim_staff` (по `staff_pk`).

---

#### **3.2 Таблица измерений `dim_inventory`**

- **Описание структуры**:
    
    - `inventory_pk` – **суррогатный ключ**.
    - `inventory_id` – **идентификатор из источника**.
    - `film_id` – **идентификатор фильма**.
    - `title` – **название фильма**.
    - `rental_duration` – **продолжительность аренды**.
    - `rental_rate` – **ставка аренды**.
    - `rating` – **рейтинг фильма**.
- **Процесс наполнения**:
    
    1. Удаляем данные (`DELETE FROM core.dim_inventory`).
    2. Загружаем из **`staging.inventory`**.
    3. Соединяем с **`staging.film`**.
    4. Заполняем `dim_inventory`.
- **Проверка данных**:
    
    - **Количество строк в `dim_inventory` = 4 584**.
    - **Совпадает с `staging.inventory`**.

---

#### **3.3 Таблица измерений `dim_staff`**

- **Описание структуры**:
    
    - `staff_pk` – **суррогатный ключ**.
    - `staff_id` – **идентификатор сотрудника из источника**.
    - `first_name` – **имя сотрудника**.
    - `last_name` – **фамилия сотрудника**.
    - `store_address` – **адрес магазина**.
    - `store_city` – **город магазина**.
    - `district` – **регион**.
- **Процесс наполнения**:
    
    1. **Удаляем старые данные** (`DELETE FROM core.dim_staff`).
    2. **Соединяем таблицы**:
        - `staging.staff` → получаем сотрудников.
        - `staging.store` → получаем магазины.
        - `staging.address` → получаем адреса.
        - `staging.city` → получаем города.
    3. **Заполняем `dim_staff`**.
- **Проверка данных**:
    
    - **Число строк = 2 (два сотрудника в базе)**.
    - **Совпадает с `staging.staff`**.

---

#### **3.4 Таблица фактов `fact_payment`**

- **Описание структуры**:
    
    - `payment_pk` – **суррогатный ключ**.
    - `payment_id` – **идентификатор платежа**.
    - `amount` – **сумма платежа**.
    - `payment_date` – **дата платежа**.
    - `inventory_fk` – **ссылка на `dim_inventory`**.
    - `staff_fk` – **ссылка на `dim_staff`**.
- **Процесс наполнения**:
    
    1. **Удаляем старые данные** (`DELETE FROM core.fact_payment`).
    2. **Соединяем таблицы**:
        - `staging.payment` → платежи.
        - `staging.rental` → аренды.
        - `core.dim_inventory` → диски.
        - `core.dim_staff` → сотрудники.
    3. **Группируем данные** по `inventory_fk`, `staff_fk` и `payment_date`.
    4. **Заполняем `fact_payment`**.
- **Проверка данных**:
    
    - **Число строк = 14 596**.
    - **Совпадает с `staging.payment`**.

---

#### **3.5 Таблица фактов `fact_rental`**

- **Описание структуры**:
    
    - `rental_pk` – **суррогатный ключ**.
    - `inventory_fk` – **ссылка на `dim_inventory`**.
    - `staff_fk` – **ссылка на `dim_staff`**.
    - `rental_date` – **дата аренды**.
    - `return_date` – **дата возврата**.
    - `amount` – **стоимость аренды**.
    - `count` – **количество операций**.
- **Задание для участников**:
    
    - Самостоятельно написать SQL-запрос для загрузки данных.
    - Проверить корректность работы запроса.

---

### **Выводы по этой части**

✅ **Созданы и заполнены основные измерения (`dim_inventory`, `dim_staff`)**.  
✅ **Создана и загружена таблица `fact_payment`**.  
✅ **Задание: реализовать загрузку `fact_rental`**.