–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è **Staging, ODS –∏ Reference —Å–ª–æ–µ–≤** —Ç–µ–ø–µ—Ä—å –∑–∞–π–º–µ–º—Å—è **Integration –∏ DDS-—Å–ª–æ—è–º–∏**.

- **Integration Layer** ‚Äì –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ, –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∏ —Ä–∞—Å—á–µ—Ç—ã.
- **DDS (Detailed Data Store)** ‚Äì –æ—Å–Ω–æ–≤–Ω–æ–π —Å–ª–æ–π **–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö**.

---

## **üîπ 1. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ Integration-—Å–ª–æ—è (Integration Layer)**

### **üìå –ß—Ç–æ —Ç–∞–∫–æ–µ Integration Layer?**

- –≠—Ç–æ —Å–ª–æ–π, –≥–¥–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ **—Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤** –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –∏ –ø—Ä–æ—Ö–æ–¥—è—Ç **—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏**.
- –ó–¥–µ—Å—å —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è **–Ω–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏** (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞, —Å–∫–∏–¥–∫–∏, –ø—Ä–∏–±—ã–ª—å).
- –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ **–∞–∫—Ç—É–∞–ª—å–Ω–æ–º –≤–∏–¥–µ**, –±–µ–∑ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

### **üìå –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º—ã Integration Layer**

```sql
CREATE SCHEMA integration;
```

‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–æ–∑–¥–∞–Ω **–Ω–æ–≤—ã–π —Å–ª–æ–π**, –≥–¥–µ –±—É–¥—É—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è –¥–∞–Ω–Ω—ã–µ.

---

### **üìå –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –≤ Integration Layer**

–í —ç—Ç–æ–º —Å–ª–æ–µ –¥–∞–Ω–Ω—ã–µ —É–∂–µ **—Å–≤—è–∑–∞–Ω—ã –º–µ–∂–¥—É —Å–æ–±–æ–π** –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç **–≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è**.

#### **–ü—Ä–∏–º–µ—Ä: –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ —Ñ–∏–ª—å–º–∞—Ö –∏ –∞—Ä–µ–Ω–¥–µ**

```sql
CREATE TABLE integration.film_rental AS
SELECT 
    r.rental_id, 
    f.film_id, 
    f.title, 
    f.rental_rate, 
    r.rental_date, 
    r.return_date
FROM ods.rental r
JOIN ods.inventory i ON r.inventory_id = i.inventory_id
JOIN ods.film f ON i.film_id = f.film_id
WITH NO DATA;
```

- **–¢–∞–±–ª–∏—Ü–∞ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç —Ñ–∏–ª—å–º—ã –∏ –∏—Ö –∞—Ä–µ–Ω–¥—ã.**
- **–î–æ–±–∞–≤–ª–µ–Ω—ã —Ü–µ–Ω—ã –∏ –¥–∞—Ç—ã –∞—Ä–µ–Ω–¥—ã.**

‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–µ–ø–µ—Ä—å –µ—Å—Ç—å –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –≥–æ—Ç–æ–≤—ã–µ –¥–ª—è –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏.

---

### **üìå –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ Integration Layer**

–ö–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ **ODS-—Å–ª–æ—è** –Ω—É–∂–Ω–æ **–ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å Integration Layer**.

```sql
CREATE OR REPLACE FUNCTION integration.load_film_rental()
RETURNS void AS $$
BEGIN
    DELETE FROM integration.film_rental;
    INSERT INTO integration.film_rental
    SELECT 
        r.rental_id, 
        f.film_id, 
        f.title, 
        f.rental_rate, 
        r.rental_date, 
        r.return_date
    FROM ods.rental r
    JOIN ods.inventory i ON r.inventory_id = i.inventory_id
    JOIN ods.film f ON i.film_id = f.film_id;
END;
$$ LANGUAGE plpgsql;
```

‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –î–∞–Ω–Ω—ã–µ –∏–∑ ODS **–∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ Integration Layer**.

---

### **üìå –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ ETL-–ø—Ä–æ—Ü–µ—Å—Å–∞**

–î–æ–±–∞–≤–ª—è–µ–º **–≤—ã–∑–æ–≤ Integration Layer** –≤ –æ–±—â—É—é –ø—Ä–æ—Ü–µ–¥—É—Ä—É **`full_etl()`**:

```sql
CREATE OR REPLACE FUNCTION full_etl()
RETURNS void AS $$
BEGIN
    -- –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ Staging
    PERFORM staging.load_film();
    PERFORM staging.load_rental();

    -- –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ ODS
    PERFORM ods.load_film();
    PERFORM ods.load_rental();

    -- –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—Ä—Ä–æ–≥–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏
    PERFORM ref.sync_film_keys();

    -- –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ Integration Layer
    PERFORM integration.load_film_rental();
END;
$$ LANGUAGE plpgsql;
```

–¢–µ–ø–µ—Ä—å **–≤—Å—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π**:

```sql
SELECT full_etl();
```

‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç:** **–í–µ—Å—å ETL –æ–±–Ω–æ–≤–ª—è–µ—Ç –≤—Å–µ —Å–ª–æ–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!** üöÄ

---

## **üîπ 2. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ DDS (Detailed Data Store ‚Äì –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)**

### **üìå –ß—Ç–æ —Ç–∞–∫–æ–µ DDS?**

- –≠—Ç–æ **–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ**, –≥–¥–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è **–≤—Å—è –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π**.
- –ï—Å–ª–∏ –≤ ODS —Ö—Ä–∞–Ω—è—Ç—Å—è **—Ç–æ–ª—å–∫–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**, —Ç–æ –≤ DDS **–≤—Å—è –∏—Å—Ç–æ—Ä–∏—è**.
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è **–∞–Ω–∞–ª–∏—Ç–∏–∫–∏, —Ç—Ä–µ–Ω–¥–æ–≤, –ø—Ä–æ–≥–Ω–æ–∑–æ–≤**.

---

### **üìå –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º—ã DDS**

```sql
CREATE SCHEMA dds;
```

‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–æ–∑–¥–∞–Ω —Å–ª–æ–π **–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è**.

---

### **üìå –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –≤ DDS**

–í DDS –≤–∞–∂–Ω–æ **—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é** –∏–∑–º–µ–Ω–µ–Ω–∏–π.

#### **–ü—Ä–∏–º–µ—Ä: –•—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∞—Ä–µ–Ω–¥—ã —Ñ–∏–ª—å–º–æ–≤**

```sql
CREATE TABLE dds.film_rental_history (
    rental_sk SERIAL PRIMARY KEY,
    rental_id INTEGER,
    film_id INTEGER,
    title TEXT,
    rental_rate NUMERIC(5,2),
    rental_date TIMESTAMP,
    return_date TIMESTAMP,
    valid_from TIMESTAMP DEFAULT NOW(),
    valid_to TIMESTAMP,
    is_active BOOLEAN DEFAULT TRUE
);
```

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ?**

- **`valid_from` / `valid_to`** ‚Äì —Ñ–∏–∫—Å–∏—Ä—É—é—Ç **–ø–µ—Ä–∏–æ–¥ –¥–µ–π—Å—Ç–≤–∏—è –∑–∞–ø–∏—Å–∏**.
- **`is_active`** ‚Äì —Ñ–ª–∞–≥, –∞–∫—Ç—É–∞–ª—å–Ω–∞ –ª–∏ –∑–∞–ø–∏—Å—å —Å–µ–π—á–∞—Å.

‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ **–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é**.

---

### **üìå –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ DDS**

**–î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ**.

```sql
CREATE OR REPLACE FUNCTION dds.load_film_rental_history()
RETURNS void AS $$
BEGIN
    -- –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
    UPDATE dds.film_rental_history
    SET valid_to = NOW(), is_active = FALSE
    WHERE rental_id IN (SELECT rental_id FROM integration.film_rental)
    AND is_active = TRUE;

    -- –í—Å—Ç–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏
    INSERT INTO dds.film_rental_history (rental_id, film_id, title, rental_rate, rental_date, return_date)
    SELECT rental_id, film_id, title, rental_rate, rental_date, return_date
    FROM integration.film_rental;
END;
$$ LANGUAGE plpgsql;
```

‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç:** DDS **—Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è** –≤ –∏—Å—Ç–æ—Ä–∏–∏.

---

### **üìå –í–∫–ª—é—á–∞–µ–º DDS –≤ –ø–æ–ª–Ω—ã–π ETL**

–î–æ–±–∞–≤–ª—è–µ–º –≤—ã–∑–æ–≤ –≤ `full_etl()`:

```sql
CREATE OR REPLACE FUNCTION full_etl()
RETURNS void AS $$
BEGIN
    -- Staging
    PERFORM staging.load_film();
    PERFORM staging.load_rental();

    -- ODS
    PERFORM ods.load_film();
    PERFORM ods.load_rental();

    -- Reference Layer
    PERFORM ref.sync_film_keys();

    -- Integration Layer
    PERFORM integration.load_film_rental();

    -- DDS Layer (–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ)
    PERFORM dds.load_film_rental_history();
END;
$$ LANGUAGE plpgsql;
```

–¢–µ–ø–µ—Ä—å **–≤—Å—è –∏—Å—Ç–æ—Ä–∏—è —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è** –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ ETL! üöÄ

---

## **üîπ 3. –ò—Ç–æ–≥–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã**

–ú—ã —Å–æ–∑–¥–∞–ª–∏ **–ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ –ò–Ω–º–∞–Ω—É**, –≤–∫–ª—é—á–∞—é—â–µ–µ:

‚úÖ **Staging Layer** ‚Äì –∑–∞–≥—Ä—É–∂–∞–µ—Ç **—Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ** –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.  
‚úÖ **ODS Layer** ‚Äì **–∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ** –¥–∞–Ω–Ω—ã—Ö.  
‚úÖ **Reference Layer** ‚Äì **—É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤**.  
‚úÖ **Integration Layer** ‚Äì **—Ä–∞—Å—á–µ—Ç—ã –∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**.  
‚úÖ **DDS (Detailed Data Store)** ‚Äì **–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ**.  
‚úÖ **–ü–æ–ª–Ω—ã–π ETL** ‚Äì **–æ–±–Ω–æ–≤–ª—è–µ—Ç –≤—Å–µ —Å–ª–æ–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!**

---

## **üîπ 4. –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)**

1. **–°–æ–∑–¥–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –≤ DDS** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `customer_history`).
2. **–î–æ–±–∞–≤–∏—Ç—å –≤ Integration Layer –Ω–æ–≤—ã–µ —Ä–∞—Å—á–µ—Ç—ã** (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫).
3. **–ó–∞–ø—É—Å—Ç–∏—Ç—å ETL –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π**.