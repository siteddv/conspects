# **–°–æ–∑–¥–∞–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –¥–∞–Ω–Ω—ã—Ö ‚Äì –û—Å–Ω–æ–≤—ã Data Vault**

## **–ß–∞—Å—Ç—å 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ä–µ–¥—ã –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**

### **üìå –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã:**

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ä–µ–¥—ã.
- –°–æ–∑–¥–∞–Ω–∏–µ **–Ω–æ–≤–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** –≤ PostgreSQL.
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ **–±–∞–∑–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞**.
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π PostgreSQL –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–Ω–µ—à–Ω–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

---

## **üéØ –®–∞–≥ 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–∞**

–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã:  
‚úÖ –í–µ–¥—É—â–∏–π –≤–∫–ª—é—á–∞–µ—Ç **–¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é —ç–∫—Ä–∞–Ω–∞**.  
‚úÖ –£—á–∞—Å—Ç–Ω–∏–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç, —á—Ç–æ **—ç–∫—Ä–∞–Ω –≤–∏–¥–µ–Ω**.  
‚ùå –£ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –≤–æ–∑–Ω–∏–∫–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º, **—Ä–µ—à–µ–Ω–∏–µ:**

- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å **—Ç–µ–ª–µ—Ñ–æ–Ω–∞** (–µ—Å–ª–∏ —ç–∫—Ä–∞–Ω –Ω–µ –≤–∏–¥–µ–Ω –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ).
- –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –≤—Å—Ç—Ä–µ—á–µ.

---

## **üõ†Ô∏è –®–∞–≥ 2. –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Data Vault**

–í PostgreSQL —Å–æ–∑–¥–∞–µ–º **–Ω–æ–≤—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö** –¥–ª—è Data Vault.

üìå **–î–µ–π—Å—Ç–≤–∏—è –≤ PgAdmin:**

1. –û—Ç–∫—Ä—ã–≤–∞–µ–º **PgAdmin**.
2. –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É **PostgreSQL**.
3. –í —Ä–∞–∑–¥–µ–ª–µ **Databases** ‚Üí **Create Database**.
4. **–ó–∞–ø–æ–ª–Ω—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
    - **–ù–∞–∑–≤–∞–Ω–∏–µ**: `dwh_data_vault`
    - **–í–ª–∞–¥–µ–ª–µ—Ü**: `postgres`
    - **–®–∞–±–ª–æ–Ω –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**: `template0`
    - **–ö–æ–¥–∏—Ä–æ–≤–∫–∞**: `UTF-8`
    - **–ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∏–º–µ–Ω**: `default`
5. **–°–æ–∑–¥–∞–µ–º –±–∞–∑—É.**
6. –û—Ç–∫—Ä—ã–≤–∞–µ–º **–Ω–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ** —Å —ç—Ç–æ–π –±–∞–∑–æ–π.

üîπ **SQL-–∫–æ–º–∞–Ω–¥–∞ —Å–æ–∑–¥–∞–Ω–∏—è –±–∞–∑—ã (–µ—Å–ª–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å):**

```sql
CREATE DATABASE dwh_data_vault
OWNER postgres
ENCODING 'UTF8'
TEMPLATE template0;
```

---

## **üîó –®–∞–≥ 3. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞**

üìå **–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ?**

- **Data Vault** —Å—Ç—Ä–æ–∏—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ **—Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤**.
- –ù–∞–º –Ω—É–∂–Ω–æ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å –¥–∞–Ω–Ω—ã–µ** –∏–∑ –≤–Ω–µ—à–Ω–µ–π –±–∞–∑—ã.
- –ò—Å–ø–æ–ª—å–∑—É–µ–º **—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ PostgreSQL –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏**.

üîπ **–°–æ–∑–¥–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (—á–µ—Ä–µ–∑ Foreign Data Wrapper - FDW)**

1. **–ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –≤ PostgreSQL:**

```sql
SELECT * FROM pg_available_extensions;
```

2. **–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ `postgres_fdw` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏:**

```sql
CREATE EXTENSION IF NOT EXISTS postgres_fdw;
```

1. **–°–æ–∑–¥–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É –∏—Å—Ç–æ—á–Ω–∏–∫–∞:**

```sql
CREATE SERVER source_db
FOREIGN DATA WRAPPER postgres_fdw
OPTIONS (host 'localhost', dbname 'source_database', port '5432');
```

üìå **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:**

- `source_db` ‚Äì –Ω–∞–∑–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞.
- `postgres_fdw` ‚Äì —Ç–∏–ø –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –≤–Ω–µ—à–Ω–∏–º PostgreSQL-–±–∞–∑–∞–º.
- `host` ‚Äì IP-–∞–¥—Ä–µ—Å –∏–ª–∏ –∏–º—è —Å–µ—Ä–≤–µ—Ä–∞ (–∑–¥–µ—Å—å `localhost`).
- `dbname` ‚Äì –∏–º—è —É–¥–∞–ª–µ–Ω–Ω–æ–π –±–∞–∑—ã.
- `port` ‚Äì —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç PostgreSQL (5432).

2. **–ù–∞—Å—Ç—Ä–æ–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:**

```sql
CREATE USER MAPPING FOR postgres
SERVER source_db
OPTIONS (user 'postgres', password 'mypassword');
```

3. **–°–æ–∑–¥–∞–µ–º —Å—Ö–µ–º—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–Ω–µ—à–Ω–∏—Ö —Ç–∞–±–ª–∏—Ü:**

```sql
CREATE SCHEMA film_src;
```

4. **–ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ç–∞–±–ª–∏—Ü—ã –∏–∑ –±–∞–∑—ã –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤ `film_src`:**

```sql
IMPORT FOREIGN SCHEMA public
FROM SERVER source_db
INTO film_src;
```

üí° **–¢–µ–ø–µ—Ä—å –≤ —Å—Ö–µ–º–µ `film_src` –ø–æ—è–≤–∏–ª–∏—Å—å –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∏–∑ –±–∞–∑—ã –∏—Å—Ç–æ—á–Ω–∏–∫–∞.**  
–ú–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

```sql
SELECT * FROM film_src.actor;
```

---

## **‚úÖ –ò—Ç–æ–≥ 2-–π —á–∞—Å—Ç–∏:**

‚úî **–°–æ–∑–¥–∞–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö `dwh_data_vault`.**  
‚úî **–ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —á–µ—Ä–µ–∑ FDW.**  
‚úî **–°–æ–∑–¥–∞–Ω–∞ —Å—Ö–µ–º–∞ `film_src` —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞.**