### **1. Введение и цели занятия** _(00:19 - 01:14)_

- Это второе занятие по моделированию хранилища данных (DWH) по методологии Инмона.
- В рамках занятия будут рассмотрены **слои Integration и DDS**.
- Задача:
    - Создать **Integration слой** (интеграция данных с источников).
    - Реализовать **DDS (Detailed Data Store)** – слой, хранящий историчность.
- Следующее занятие будет посвящено:
    - Примерам витрин данных.
    - Ответам на вопросы.
    - Обзору методологии **Data Vault** и **Anchor Modeling**.

---

### **2. Обсуждение домашнего задания и уточнение данных из источников** _(01:14 - 04:49)_

- Ответы на вопросы участников по **домашнему заданию**:
    - Нужно ли брать все данные из источника или только необходимые?
    - Пароли в данных брать **не нужно**.
    - Инкрементальная загрузка данных:
        - Какие таблицы загружаются инкрементально?
        - В примере — только таблица **Payment**.

---

### **3. Обзор слоев хранилища данных** _(04:49 - 06:41)_

**Хранилище данных разделено на несколько слоев:**

1. **Staging (Промежуточный слой)**
    
    - Загружаются **сырые данные** из источников.
    - Данные загружаются в том виде, **в каком они есть в источнике** (без изменений).
2. **ODS (Operational Data Store, Операционный слой)**
    
    - Хранит данные из источников **с минимальными изменениями**.
    - Данные поступают **из разных источников**, но без значительных преобразований.
3. **Reference (Справочный слой)**
    
    - Присваивает **суррогатные идентификаторы** данным из разных источников.
    - Уникализирует и стандартизирует справочники.
4. **Integration (Интеграционный слой)**
    
    - **Объединяет** данные из разных источников.
    - Подставляет суррогатные идентификаторы.
    - Производит **первичные вычисления** и нормализацию данных.
5. **DDS (Detailed Data Store, Слой детализированных данных)**
    
    - Хранит **историчность** данных.
    - Содержит **все изменения**, которые произошли в данных со временем.
    - Используется для **отчетности** с учетом временных изменений.

---

### **4. Интеграция данных: переход от ODS к Integration** _(06:41 - 10:59)_

- **Что происходит на этапе интеграции?**
    - Данные из **ODS** поступают в **Integration слой**.
    - Присваиваются **суррогатные идентификаторы**.
    - Выполняются **некоторые вычисления**.
- **Пример приведения данных к 3NF (третьей нормальной форме)**:
    - В ODS **адрес** может храниться в одном текстовом поле.
    - В Integration адрес **разбивается** на отдельные поля:
        - **Город, страна, улица, дом, квартира.**
    - Это делается для возможности построения **отчетов по разрезам** (по странам, регионам и т. д.).
- **Важный нюанс**:
    - **Дату не нормализуем** (не выделяем в отдельную таблицу).
    - Решение по нормализации даты принимается на этапе **витрин данных**, когда определяется нужная **гранулярность**.

---

### **5. Вопросы по третьей нормальной форме** _(10:59 - 19:46)_

**Основной вопрос:** **Нужно ли каждой строке давать уникальный идентификатор?**

- Участники обсуждают, всегда ли нужно иметь **идентификатор строки**, если у нее уже есть **первичный ключ** из источника.
- Разбирается **пример таблицы действий** в **Яндекс Метрике**:
    - Действия пользователя (клики, скроллы) фиксируются в логах.
    - Нужно ли давать каждой записи **свой уникальный идентификатор**?
- Вывод:
    - Если строку можно **однозначно идентифицировать** без дополнительного ID — уникальный идентификатор **не обязателен**.
    - Но если данные поступают **инкрементально** и их нужно отслеживать по изменениям — **уникальный ключ обязателен**.

---

### **6. Интересная дискуссия о бизнес-правилах и роли разработчиков DWH** _(19:46 - 24:01)_

- **Как разработчики определяют, какие поля загружать в хранилище?**
- **Ответственность** за принятие решений по структуре данных:
    - В идеале этим занимается **бизнес-аналитик**.
    - Но часто **разработчики** принимают такие решения самостоятельно.
- **Что делать, если клиент хочет построить отчет, но не знает, какие данные ему нужны?**
    - Разработчики **должны предлагать решения**, но согласовывать их с бизнесом.
- **Важность документирования решений**:
    - Какие данные загружаются?
    - Какие поля **не попадают в хранилище**?
    - Почему было принято то или иное решение?

---

### **Выводы первой части**

6. **Создана архитектура хранилища данных, включающая 5 слоев.**
7. **Определена роль каждого слоя:**
    - **Staging** – сырые данные.
    - **ODS** – минимальные изменения.
    - **Reference** – присвоение ID.
    - **Integration** – унификация и 3NF.
    - **DDS** – историчность.
8. **Обсуждена важность нормализации данных.**
9. **Разработчики должны учитывать бизнес-логики при выборе данных для отчетности.**
10. **Документирование всех решений по данным – ключ к успешной работе DWH.**