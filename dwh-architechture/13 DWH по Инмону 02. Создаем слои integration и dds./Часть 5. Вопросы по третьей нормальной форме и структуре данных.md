### **üìú –ü–æ–¥—Ä–æ–±–Ω—ã–π –∫–æ–Ω—Å–ø–µ–∫—Ç: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ–¥—É—Ä –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤ Integration**

üìÖ **–î–∞—Ç–∞ –∑–∞–Ω—è—Ç–∏—è:** 20 –Ω–æ—è–±—Ä—è 2022 –≥–æ–¥–∞  
üéì **–¢–µ–º–∞:** _–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Å–ª–æ–π Integration_  
üë®‚Äçüè´ **–õ–µ–∫—Ç–æ—Ä:** (–ò–º—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è –Ω–µ —É–∫–∞–∑–∞–Ω–æ)

---

## **üîπ –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ–¥—É—Ä –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤ Integration**

üìå –í —ç—Ç–æ–π —á–∞—Å—Ç–∏ –∑–∞–Ω—è—Ç–∏—è —Ä–∞–∑–±–∏—Ä–∞–µ—Ç—Å—è:  
‚úî **–ö–∞–∫ –∑–∞–≥—Ä—É–∂–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ Integration** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.  
‚úî **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∏ –ø–æ–ª–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞**.  
‚úî **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü**.  
‚úî **–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä ETL –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö**.

---

### **üìå 1. –ü–æ–¥—Ö–æ–¥—ã –∫ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö**

üîπ –í Integration –¥–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç—É–ø–∞—é—Ç –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.  
üîπ –ó–∞–≥—Ä—É–∂–∞—Ç—å –∏—Ö –º–æ–∂–Ω–æ **–¥–≤—É–º—è —Å–ø–æ—Å–æ–±–∞–º–∏**:

#### **1.1 –ü–æ–ª–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (Full Load)**

üìå –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö:  
‚úî –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ **–∑–∞–Ω–æ–≤–æ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è** –≤ Integration.  
‚úî –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è **–Ω–µ–±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü**, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤.  
‚úî –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–ø—Ä–∏ –ø–µ—Ä–≤–∏—á–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö**.

üìå **–ú–∏–Ω—É—Å—ã –ø–æ–ª–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**  
‚ùå **–í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞** –Ω–∞ —Å–∏—Å—Ç–µ–º—É (–≤—Å—ë –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è).  
‚ùå **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π**, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –∏–∑–º–µ–Ω—è–ª–∏—Å—å.

#### **1.2 –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (Incremental Load)**

üìå –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –∏ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏**:  
‚úî –ü–æ–∑–≤–æ–ª—è–µ—Ç **–º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É**.  
‚úî –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ **–º–µ—Ç–∫—É –≤—Ä–µ–º–µ–Ω–∏ (`last_update`) –∏–ª–∏ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**.  
‚úî –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–∫–∞–∑—ã).

üìå **–ö–∞–∫ –ø–æ–Ω—è—Ç—å, –∫–∞–∫–∏–µ –∑–∞–ø–∏—Å–∏ –æ–±–Ω–æ–≤–∏–ª–∏—Å—å?**

1. **–ü–æ –¥–∞—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (`last_update`)** ‚Äì –µ—Å–ª–∏ —É –∑–∞–ø–∏—Å–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è `last_update`, –µ—ë –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å.
2. **–ß–µ—Ä–µ–∑ —Ö–µ—à-—Ñ—É–Ω–∫—Ü–∏–∏** ‚Äì –µ—Å–ª–∏ —É –∑–∞–ø–∏—Å–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è —Ö–µ—à, –∑–Ω–∞—á–∏—Ç, –¥–∞–Ω–Ω—ã–µ –ø–æ–º–µ–Ω—è–ª–∏—Å—å.

üìå **–ü—Ä–∏–º–µ—Ä: –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å —É—á—ë—Ç–æ–º `last_update`**

```sql
SELECT * FROM source.orders 
WHERE last_update > (SELECT MAX(last_update) FROM integration.orders);
```

---

### **üìå 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü**

üìå **–ó–∞—á–µ–º –Ω—É–∂–Ω—ã –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã?**  
‚úî –ü–æ–∑–≤–æ–ª—è—é—Ç **–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –≤—Å—Ç–∞–≤–∫–æ–π –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Ç–∞–±–ª–∏—Ü—É**.  
‚úî –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è **–ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∏ –æ—à–∏–±–æ–∫**.  
‚úî –ü–æ–∑–≤–æ–ª—è—é—Ç **—Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –∏ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ**.

üìå **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã?**  
1Ô∏è‚É£ **–°–æ–∑–¥–∞—ë—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞**:

```sql
CREATE TEMP TABLE tmp_orders AS 
SELECT * FROM source.orders WHERE last_update > (SELECT MAX(last_update) FROM integration.orders);
```

2Ô∏è‚É£ **–û–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏**:

```sql
UPDATE integration.orders AS tgt
SET amount = src.amount, status = src.status, last_update = src.last_update
FROM tmp_orders AS src
WHERE tgt.order_id = src.order_id;
```

3Ô∏è‚É£ **–î–æ–±–∞–≤–ª—è—é—Ç—Å—è –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏**:

```sql
INSERT INTO integration.orders (order_id, customer_id, amount, status, last_update)
SELECT order_id, customer_id, amount, status, last_update
FROM tmp_orders
ON CONFLICT (order_id) DO NOTHING;
```

4Ô∏è‚É£ **–£–¥–∞–ª—è–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞**:

```sql
DROP TABLE tmp_orders;
```

üìå **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü:**  
‚úî –£–º–µ–Ω—å—à–∞—é—Ç –Ω–∞–≥—Ä—É–∑–∫—É –∑–∞ —Å—á—ë—Ç **–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö**.  
‚úî –ü–æ–∑–≤–æ–ª—è—é—Ç **–∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç–æ–≤** –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö.  
‚úî –û–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç **–±—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π**.

---

### **üìå 3. –ü–æ–ª–Ω—ã–π —Ä–∞–∑–±–æ—Ä –ø—Ä–æ—Ü–µ–¥—É—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö**

üìå **–≠—Ç–∞–ø—ã –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ Integration:**  
1Ô∏è‚É£ **–û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –µ—Å—Ç—å).**  
2Ô∏è‚É£ **–°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã (`CREATE TEMP TABLE`).**  
3Ô∏è‚É£ **–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤—ã—Ö –∏ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π.**  
4Ô∏è‚É£ **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö (`UPDATE`).**  
5Ô∏è‚É£ **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π (`INSERT`).**  
6Ô∏è‚É£ **–û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü (`DROP TABLE`).**

üìå **–ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ `integration.orders`**

```sql
CREATE OR REPLACE PROCEDURE load_orders_to_integration()
LANGUAGE plpgsql
AS $$
BEGIN
    -- –®–∞–≥ 1: –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
    DROP TABLE IF EXISTS tmp_orders;
    
    -- –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
    CREATE TEMP TABLE tmp_orders AS 
    SELECT * FROM source.orders 
    WHERE last_update > (SELECT COALESCE(MAX(last_update), '1900-01-01') FROM integration.orders);
    
    -- –®–∞–≥ 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π
    UPDATE integration.orders AS tgt
    SET amount = src.amount, status = src.status, last_update = src.last_update
    FROM tmp_orders AS src
    WHERE tgt.order_id = src.order_id;
    
    -- –®–∞–≥ 4: –í—Å—Ç–∞–≤–∫–∞ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π
    INSERT INTO integration.orders (order_id, customer_id, amount, status, last_update)
    SELECT order_id, customer_id, amount, status, last_update
    FROM tmp_orders
    ON CONFLICT (order_id) DO NOTHING;
    
    -- –®–∞–≥ 5: –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
    DROP TABLE tmp_orders;
END;
$$;
```

üìå **–ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ—Ü–µ–¥—É—Ä—É?**

```sql
CALL load_orders_to_integration();
```

---

### **üìå 4. –ò—Ç–æ–≥–∏ —á–∞—Å—Ç–∏**

üéØ **–ì–ª–∞–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã:**  
‚úî –î–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ Integration –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã**.  
‚úî –†–∞–∑–ª–∏—á–∞—é—Ç **–ø–æ–ª–Ω—É—é –∏ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É**.  
‚úî –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ **–æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**.  
‚úî –í ETL-–ø—Ä–æ—Ü–µ–¥—É—Ä–∞—Ö –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è **`UPDATE`, `INSERT` –∏ `ON CONFLICT`**.  
‚úî –í—Å–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è **—á–µ—Ä–µ–∑ —Ö—Ä–∞–Ω–∏–º—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏.

üìå **–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:**  
**–†–∞–∑–±–æ—Ä –∏—Å—Ç–æ—Ä–∏—á–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ DDS! üöÄ**