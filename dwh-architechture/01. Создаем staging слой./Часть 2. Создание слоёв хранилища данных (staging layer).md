 ### **2.1. Введение в практическую часть курса**

- В первой части объяснялась **теория хранилищ данных** и их структура.
- Теперь начнётся **практическая реализация**, начиная с **слоя Staging**.
- **Как будет построено обучение?**
    - **Минимум теории, максимум практики**.
    - Сначала создаётся **простейшая версия хранилища**, затем она **дорабатывается**.
    - Позже будут изучаться **разные схемы моделирования данных** (например, **Data Vault**).

### **2.2. Цели слоя Staging**

- **Слой Staging** — это **промежуточное хранилище сырых данных**, загруженных из источников.
- **Зачем нужен этот слой?**
    - **Изолирует основное хранилище от источников** (чтобы не загружать их лишними запросами).
    - **Сохраняет сырые данные** без изменений.
    - **Позволяет анализировать данные перед их преобразованием**.
    - **Упрощает обработку данных в основном слое (Core Layer)**.

---

### **2.3. Варианты загрузки данных в Staging Layer**

#### **2.3.1. Первоначальная загрузка**

- **При первом запуске хранилища** нужно загрузить **все** данные из источников.
- **Процесс**:
    1. Взять **всю таблицу** из источника.
    2. Перенести её в слой Staging.
    3. В дальнейшем обновлять только **изменённые записи**.

#### **2.3.2. Инкрементальная загрузка данных**

- Вместо того, чтобы **загружать все данные каждый раз**, можно загружать **только изменения**.
- Это **значительно снижает нагрузку на систему**.
- **Варианты инкрементальной загрузки**:
    - **Новые записи** (например, добавленные за последние 24 часа).
    - **Изменённые записи** (например, если клиент обновил свой адрес).
    - **Удалённые записи** (например, если товар убрали из каталога).

#### **2.3.3. Полная перезагрузка данных**

- Иногда проще **перезагружать всю таблицу заново**.
- **Когда это оправдано?**
    - Если таблица **небольшая** (например, до 1 миллиона строк).
    - Если сложно **определить изменённые записи**.
    - Если проще **стереть и загрузить заново, чем искать изменения**.

**⚠️ Важно:**

- В этом курсе **сначала будет загружаться вся таблица**, а затем будет реализована **инкрементальная загрузка**.

---

### **2.4. Создание базы данных для хранилища**

#### **2.4.1. Разделение нагрузки**

- В реальной системе **операционные базы данных** и **хранилище данных** находятся **на разных серверах**.
- В этом курсе будет использоваться **один сервер**, но подключение будет настроено так, **как будто это разные сервера**.

#### **2.4.2. Создание базы данных для DWH**

- В PostgreSQL создаётся **отдельная база данных** для хранилища данных.
- **Шаги**:
    1. Открываем **PostgreSQL**.
    2. Создаём **новое соединение** для базы данных **DWH**.
    3. Даём имя базе, например **dw_film**.

#### **2.4.3. Создание схемы Staging**

- Внутри базы данных DWH создаётся **схема Staging**.
    
- **Зачем использовать схему?**
    
    - В одной базе данных можно хранить **разные слои хранилища**.
    - **Слои можно изолировать** друг от друга.
    - Например:
        - **staging** — для временного хранения данных.
        - **core** — для основного хранилища.
        - **marts** — для витрин данных.
- **SQL-запрос для создания схемы**: