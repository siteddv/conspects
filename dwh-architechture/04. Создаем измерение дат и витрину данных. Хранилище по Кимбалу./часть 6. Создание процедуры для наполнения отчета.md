### **1. –ó–∞—á–µ–º –Ω—É–∂–Ω–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –¥–ª—è –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞?**

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã `report.sales_date` –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –æ—Ç—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**.  
–î–ª—è —ç—Ç–æ–≥–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ **–Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞**, –∫–æ—Ç–æ—Ä–∞—è:

- –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ.
- –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø—Ä–æ–¥–∞–∂–∏ –ø–æ –¥–Ω—è–º.
- –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

---

### **2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö**

–ü–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –∫–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:

- **–î–∞—Ç–∞ (`date_id`)** —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ `DATE`, —á—Ç–æ —É—Å–∫–æ—Ä—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É.
- **–î–∞–Ω–Ω—ã–µ –∞–≥—Ä–µ–≥–∏—Ä—É—é—Ç—Å—è –∑–∞—Ä–∞–Ω–µ–µ** –≤ `sales_date`, —á—Ç–æ–±—ã –æ—Ç—á–µ—Ç—ã –∑–∞–≥—Ä—É–∂–∞–ª–∏—Å—å –±—ã—Å—Ç—Ä–µ–µ.
- **–í—Å–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –¥–µ–ª–∞—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞**, –∞ –Ω–µ –Ω–∞ –ª–µ—Ç—É –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ.

---

### **3. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã `report.calc_sales_date()`**

```sql
CREATE OR REPLACE PROCEDURE report.calc_sales_date()
LANGUAGE SQL AS $$
BEGIN
    -- –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    DELETE FROM report.sales_date;

    -- –í—Å—Ç–∞–≤–∫–∞ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    INSERT INTO report.sales_date (date_title, date_sort, total_sales)
    SELECT 
        CONCAT(d.day_of_month, ' ', d.month_name, ' ', d.year) AS date_title,  -- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞
        d.date_id AS date_sort,  -- –î–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
        SUM(p.amount) AS total_sales  -- –û–±—â–∞—è —Å—É–º–º–∞ –ø—Ä–æ–¥–∞–∂ –∑–∞ –¥–µ–Ω—å
    FROM core.fact_payment p
    JOIN core.dim_date d ON d.date_id = p.payment_date_id
    GROUP BY d.date_id, d.day_of_month, d.month_name, d.year
    ORDER BY d.date_id;
END $$;
```

---

### **4. –†–∞–∑–±–æ—Ä –∫–æ–¥–∞**

üîπ **–û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö**

```sql
DELETE FROM report.sales_date;
```

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ.

üîπ **–í—Å—Ç–∞–≤–∫–∞ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**

```sql
INSERT INTO report.sales_date (...)
SELECT 
    CONCAT(d.day_of_month, ' ', d.month_name, ' ', d.year),  
    d.date_id,
    SUM(p.amount) 
FROM core.fact_payment p
JOIN core.dim_date d ON d.date_id = p.payment_date_id
GROUP BY d.date_id, d.day_of_month, d.month_name, d.year
ORDER BY d.date_id;
```

üìå –ó–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã (`1 —Å–µ–Ω—Ç—è–±—Ä—è 2022`).
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–¥–∞–∂ –ø–æ `date_id`.
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ.

---

### **5. –ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã**

–ü—Ä–æ—Ü–µ–¥—É—Ä—É `calc_sales_date` –º–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é:

```sql
CALL report.calc_sales_date();
```

–ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ –æ–±—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (`full_load`).

---

### **6. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –ø—Ä–æ—Ü–µ–¥—É—Ä—É `full_load`**

–ß—Ç–æ–±—ã –æ—Ç—á–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–ª—Å—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:

```sql
CREATE OR REPLACE PROCEDURE full_load()
LANGUAGE SQL AS $$
BEGIN
    -- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Å—Ç–µ–π–¥–∂–∏–Ω–≥
    CALL load_staging();

    -- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ core
    CALL load_core();

    -- –ü–µ—Ä–µ—Å—á–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ report
    CALL report.calc_sales_date();
END $$;
```

–¢–µ–ø–µ—Ä—å **–ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏** –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `calc_sales_date()`, –∏ –¥–∞–Ω–Ω—ã–µ –≤ –æ—Ç—á–µ—Ç–∞—Ö –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã.

---

### **7. –ò—Ç–æ–≥–∏**

‚úÖ **–°–æ–∑–¥–∞–Ω–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ `calc_sales_date()`**, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø—Ä–æ–¥–∞–∂–∏ –ø–æ –¥–Ω—è–º.  
‚úÖ **–ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –≤–∫–ª—é—á–µ–Ω–∞ –≤ `full_load()`**, —á—Ç–æ–±—ã –æ—Ç—á–µ—Ç—ã –æ–±–Ω–æ–≤–ª—è–ª–∏—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.  
‚úÖ **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∑–∞—Ä–∞–Ω–µ–µ**, —Å–Ω–∏–∂–∞—è –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ BI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã.  
‚úÖ **–¢–µ–ø–µ—Ä—å –æ—Ç—á–µ—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ**, —Ç–∞–∫ –∫–∞–∫ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –ø—Ä–µ–¥—Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã.