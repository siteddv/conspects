### **1. Назначение таблицы измерения дат**

Таблица **`dim_date`** необходима для хранения различных представлений дат, которые часто используются в отчетах.  
Она позволяет:

- Преобразовывать даты в нужный формат (например, `1 сентября 2022` вместо `2022-09-01`).
- Оптимизировать агрегацию данных (например, группировка по кварталам, неделям, годам).
- Исключить необходимость вычислений в каждом отчете (все значения уже предрассчитаны).

Таблица `dim_date` создается в схеме **`core`**, поскольку является одним из ключевых измерений.

---

### **2. Формирование последовательности дат**

В таблицу `dim_date` добавляются все даты за определенный период (например, с 1 января 2007 по 31 декабря 2022).  
Создается последовательность дат, которая:

- Начинается с 1 января 2007 года (первый зафиксированный платеж в системе).
- Охватывает 16 лет (до 2022 года, чтобы покрыть весь период работы данных).
- Заполняется автоматически с помощью генерации последовательности в PostgreSQL.

Пример SQL-запроса для генерации дат:

```sql
SELECT generate_series('2007-01-01'::date, '2022-12-31'::date, '1 day'::interval) AS date_actual;
```

---

### **3. Создание таблицы `dim_date`**

Таблица содержит следующие ключевые поля:

- `date_id` (первичный ключ) – уникальный идентификатор в формате `YYYYMMDD` (например, `20220901`).
- `date_actual` – фактическая дата (`DATE`).
- `day_of_month` – номер дня в месяце (`1-31`).
- `day_of_week` – номер дня недели (`1-7`, где 1 = понедельник).
- `week_of_year` – номер недели (`1-52`).
- `month` – номер месяца (`1-12`).
- `month_name` – название месяца (`Сентябрь`).
- `quarter` – номер квартала (`1-4`).
- `year` – год (`2022`).
- `fiscal_week` – фискальная неделя (если требуется для отчетности).

Создание таблицы:

```sql
CREATE TABLE core.dim_date (
    date_id INT PRIMARY KEY,
    date_actual DATE NOT NULL,
    day_of_month INT NOT NULL,
    day_of_week INT NOT NULL,
    week_of_year INT NOT NULL,
    month INT NOT NULL,
    month_name TEXT NOT NULL,
    quarter INT NOT NULL,
    year INT NOT NULL
);
```

---

### **4. Создание индексов для ускорения работы**

Для быстрого поиска дат добавляется индекс по `date_actual`:

```sql
CREATE INDEX idx_dim_date_actual ON core.dim_date (date_actual);
```

Это ускоряет соединение таблицы фактов с `dim_date` по полю `date_actual`.

---

### **5. Оптимизация хранения и представления дат**

- Вместо хранения `DATE`-формата в связующих таблицах используется **целочисленный идентификатор (`date_id`)**, что сокращает размер данных.
- Названия месяцев и дней недели хранятся в текстовом формате для удобства формирования отчетов.
- Все вычисления с датами производятся **один раз при загрузке данных**, а не в каждом SQL-запросе.