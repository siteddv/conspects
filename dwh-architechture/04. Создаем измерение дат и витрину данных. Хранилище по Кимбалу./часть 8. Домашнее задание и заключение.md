### **1. Домашнее задание**

Для закрепления материала студентам предложено выполнить следующее задание:

#### **1.1. Повторить создание таблицы измерения дат (`dim_date`) и подключение к таблицам фактов**

- Создать таблицу `core.dim_date`, если она еще не была создана.
- Наполнить ее данными, используя генерацию последовательности дат.
- Обновить таблицы фактов (`fact_payment`, `fact_rental`), заменив `DATE`-поля на `date_id`.
- Обновить процедуры загрузки данных, чтобы они использовали `date_id` вместо `DATE`.

#### **1.2. Создать собственный отчет "Продажи по фильмам"**

- Создать таблицу `report.sales_movies` с двумя колонками:
    - `movie_title` – название фильма.
    - `total_sales` – сумма продаж по этому фильму.
- Написать процедуру `calc_sales_movies()`, которая:
    - Группирует данные из `fact_payment` по фильмам.
    - Вычисляет сумму продаж для каждого фильма.
    - Сортирует по убыванию суммы продаж.

Пример SQL-запроса для агрегирования данных:

```sql
SELECT 
    m.title AS movie_title, 
    SUM(p.amount) AS total_sales
FROM core.fact_payment p
JOIN core.dim_inventory i ON p.inventory_id = i.inventory_id
JOIN core.dim_movie m ON i.movie_id = m.movie_id
GROUP BY m.title
ORDER BY total_sales DESC;
```

#### **1.3. Обновить процедуру `full_load()`**

- Добавить вызов `calc_sales_movies()` в процедуру `full_load()`, чтобы отчет обновлялся автоматически.

#### **1.4. Создать визуализацию "Топ-10 фильмов по продажам"**

- Экспортировать данные из `report.sales_movies` в Google Sheets.
- Построить **столбчатую диаграмму**, отображающую топ-10 фильмов по сумме продаж.

---

### **2. Заключение**

На занятии были пройдены ключевые аспекты построения хранилища данных: ✅ **Создано измерение дат `dim_date`**, обеспечивающее удобное хранение и форматирование дат.  
✅ **Обновлены таблицы фактов**, теперь они используют `date_id`, что ускоряет запросы.  
✅ **Создан слой витрин (`report`)**, содержащий предрассчитанные данные для отчетов.  
✅ **Разработан отчет "Продажи по датам"**, который демонстрирует динамику продаж.  
✅ **Построена визуализация в Google Sheets**, которая помогает анализировать данные.  
✅ **Домашнее задание закрепляет навык работы с `report`**, предлагая создать отчет по фильмам.