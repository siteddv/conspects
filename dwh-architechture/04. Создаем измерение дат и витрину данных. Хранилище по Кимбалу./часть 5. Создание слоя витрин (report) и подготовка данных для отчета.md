### **1. –ß—Ç–æ —Ç–∞–∫–æ–µ —Å–ª–æ–π –≤–∏—Ç—Ä–∏–Ω (`report`)?**

–°–ª–æ–π –≤–∏—Ç—Ä–∏–Ω (`report`) ‚Äì —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è **–±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–µ–¥—Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤**.  
–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç `core`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, `report` —É–∂–µ **—Å–æ–¥–µ—Ä–∂–∏—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è**, –≥–æ—Ç–æ–≤—ã–µ –∫ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏.

### **2. –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º—ã `report`**

–î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–∏—Ç—Ä–∏–Ω —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–∞—è —Å—Ö–µ–º–∞:

```sql
CREATE SCHEMA report;
```

–í—Å–µ –æ—Ç—á–µ—Ç–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –±—É–¥—É—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –∏–º–µ–Ω–Ω–æ –∑–¥–µ—Å—å.

---

### **3. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –æ—Ç—á–µ—Ç–∞ `sales_date`**

**–ó–∞–¥–∞—á–∞:** —Å–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç **"–ü—Ä–æ–¥–∞–∂–∏ –ø–æ –¥–∞—Ç–∞–º"** (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥–∞–∂ –≤ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å).  
–î–ª—è —ç—Ç–æ–≥–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞ `sales_date`:

```sql
CREATE TABLE report.sales_date (
    date_title VARCHAR(20) NOT NULL,  -- –î–∞—Ç–∞ –≤ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "1 —Å–µ–Ω—Ç—è–±—Ä—è 2022")
    date_sort INT NOT NULL,           -- –î–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (date_id –∏–∑ `dim_date`)
    total_sales NUMERIC(7,2) NOT NULL -- –°—É–º–º–∞ –ø—Ä–æ–¥–∞–∂ –∑–∞ –¥–µ–Ω—å
);
```

üìå **–ó–∞—á–µ–º —Ç—Ä–∏ —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—è –¥–ª—è –¥–∞—Ç—ã?**

- `date_title` ‚Äì —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ (–¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –æ—Ç—á–µ—Ç–∞—Ö).
- `date_sort` ‚Äì –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–∞—Ç—ã (`date_id`), —á—Ç–æ–±—ã –ª–µ–≥–∫–æ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å.
- `total_sales` ‚Äì —Å—É–º–º–∞ –≤—Å–µ—Ö –ø—Ä–æ–¥–∞–∂ –∑–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å.

---

### **4. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã `calc_sales_date`**

–ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –±–µ—Ä–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ **`fact_payment`**, –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –∏—Ö –ø–æ –¥–Ω—è–º –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ `report.sales_date`.

```sql
CREATE OR REPLACE PROCEDURE report.calc_sales_date()
LANGUAGE SQL AS $$
    DELETE FROM report.sales_date;

    INSERT INTO report.sales_date (date_title, date_sort, total_sales)
    SELECT 
        CONCAT(d.day_of_month, ' ', d.month_name, ' ', d.year),  -- –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É
        d.date_id,
        SUM(p.amount) AS total_sales
    FROM core.fact_payment p
    JOIN core.dim_date d ON d.date_id = p.payment_date_id
    GROUP BY d.date_id, d.day_of_month, d.month_name, d.year
    ORDER BY d.date_id;
$$;
```

üîπ **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?**

1. –û—á–∏—â–∞–µ–º `sales_date`, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ.
2. –í—ã–±–∏—Ä–∞–µ–º **–¥–∞—Ç—É –∏–∑ `dim_date`** (`1 —Å–µ–Ω—Ç—è–±—Ä—è 2022`).
3. –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ `date_id` –∏ —Å—É–º–º–∏—Ä—É–µ–º `amount` (—Å—É–º–º–∞ –ø—Ä–æ–¥–∞–∂).
4. –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ `report.sales_date`.

---

### **5. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç—á–µ—Ç–∞**

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ü–µ–¥—É—Ä—ã `calc_sales_date`, –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è **–∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞**:

```sql
CALL report.calc_sales_date();
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Ç–∞–±–ª–∏—Ü–∞ `sales_date` —É–∂–µ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ BI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö.

---

### **6. –ò—Ç–æ–≥–∏**

‚úÖ –°–æ–∑–¥–∞–Ω **—Å–ª–æ–π –≤–∏—Ç—Ä–∏–Ω `report`**, –∫–æ—Ç–æ—Ä—ã–π —Ö—Ä–∞–Ω–∏—Ç –ø—Ä–µ–¥—Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.  
‚úÖ **–î–∞—Ç—ã —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é—Ç—Å—è –∑–∞—Ä–∞–Ω–µ–µ** ‚Üí SQL-–∑–∞–ø—Ä–æ—Å—ã –≤ BI-–æ—Ç—á–µ—Ç–∞—Ö —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –ø—Ä–æ—â–µ.  
‚úÖ **–ü—Ä–æ—Ü–µ–¥—É—Ä–∞ `calc_sales_date` –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –ø—Ä–æ–¥–∞–∂–∏** –ø–æ –¥–Ω—è–º –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `sales_date`.  
‚úÖ **–û—Ç—á–µ—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –±—ã—Å—Ç—Ä–æ**, —Ç–∞–∫ –∫–∞–∫ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –ø—Ä–µ–¥—Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã.