–ü–æ—Å–ª–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è —Ç–µ–æ—Ä–∏–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ **–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏**. –í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ **—à–∞–≥ –∑–∞ —à–∞–≥–æ–º –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö** —Å —É—á—ë—Ç–æ–º –Ω–æ–≤—ã—Ö, –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö –∏ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π.

---

### **üîπ –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã `inventory` –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–µ**

1Ô∏è‚É£ –ó–∞–ø—Ä–æ—Å –Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã `inventory`:

```sql
SELECT * FROM public.inventory LIMIT 10;
```

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è:**

- `inventory_id` ‚Äì —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏.
- `film_id` ‚Äì –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ñ–∏–ª—å–º–∞.
- `store_id` ‚Äì –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –º–∞–≥–∞–∑–∏–Ω–∞.
- `last_update` ‚Äì –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏.

2Ô∏è‚É£ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–ª—è `last_update` –¥–ª—è –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏**

- –ß—Ç–æ–±—ã **–∑–∞–≥—Ä—É–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏**, –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–µ, —Ñ–∏–∫—Å–∏—Ä—É—é—â–µ–µ –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (`last_update`).
- –ï—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç, –ø—Ä–∏–¥—ë—Ç—Å—è **–ª–∏–±–æ –¥–æ–±–∞–≤–∏—Ç—å –µ–≥–æ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏—Å—Ç–æ—á–Ω–∏–∫–∞**, –ª–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–¥—Ä—É–≥–∏–µ –º–µ—Ç–æ–¥—ã** (–Ω–∞–ø—Ä–∏–º–µ—Ä, CDC).
- –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∑–∞–ø–∏—Å–∏, –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –ø–æ—Å–ª–µ 6 –∞–≤–≥—É—Å—Ç–∞ 2022 –≥–æ–¥–∞:
    
    ```sql
    SELECT * FROM public.inventory WHERE last_update > '2022-08-06';
    ```
    
- –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ, –∑–Ω–∞—á–∏—Ç, –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤–æ–∑–º–æ–∂–Ω–∞.

---

### **üîπ –ü—Ä–æ–±–ª–µ–º–∞ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–µ–π –∏ —Ä–µ—à–µ–Ω–∏–µ —Å `deleted_at`**

1Ô∏è‚É£ **–ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–µ —É–¥–∞–ª—è—é—Ç –¥–∞–Ω–Ω—ã–µ?**

- –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å –ø—Ä–æ—Å—Ç–æ –∏—Å—á–µ–∑–∞–µ—Ç –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞, **—Ö—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–µ —É–∑–Ω–∞–µ—Ç –æ–± —ç—Ç–æ–º** –∏ –∑–∞–ø–∏—Å—å –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
- –†–µ—à–µ–Ω–∏–µ: **–≤–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –ø–æ–º–µ—á–∞—Ç—å –∑–∞–ø–∏—Å–∏ —Å `deleted_at`**, –¥–æ–±–∞–≤–∏–≤ –ø–æ–ª–µ –≤ —Ç–∞–±–ª–∏—Ü—É `inventory`.

2Ô∏è‚É£ **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è `deleted_at` –≤ —Ç–∞–±–ª–∏—Ü—É `inventory`**

- –î–æ–±–∞–≤–ª—è–µ–º –≤ —Ç–∞–±–ª–∏—Ü—É –∏—Å—Ç–æ—á–Ω–∏–∫:
    
    ```sql
    ALTER TABLE public.inventory ADD COLUMN deleted_at TIMESTAMP NULL;
    ```
    
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–Ω–æ **–ø—É—Å—Ç–æ–µ (`NULL`)**, –µ—Å–ª–∏ –∑–∞–ø–∏—Å—å –∞–∫—Ç–∏–≤–Ω–∞.
- –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —É–¥–∞–ª–µ–Ω–∞, –≤ –Ω–µ—ë **–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤—Ä–µ–º—è —É–¥–∞–ª–µ–Ω–∏—è**.
- –¢–µ–ø–µ—Ä—å –∑–∞–ø—Ä–æ—Å –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:
    
    ```sql
    SELECT * FROM public.inventory WHERE deleted_at IS NOT NULL;
    ```
    
- –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, **–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å—è—Ö –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è, –∞ –Ω–µ –∏—Å—á–µ–∑–∞—Ç—å**.

---

### **üîπ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `last_update` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π**

1Ô∏è‚É£ **–ó–∞—á–µ–º –Ω—É–∂–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `last_update`?**

- –í –Ω–µ–π –±—É–¥–µ—Ç **—Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö**, —á—Ç–æ–±—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤—ã–±–∏—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –∏ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏.
- –ö–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –º—ã **–±—É–¥–µ–º –æ–±–Ω–æ–≤–ª—è—Ç—å —ç—Ç—É —Ç–∞–±–ª–∏—Ü—É**.

2Ô∏è‚É£ **–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `last_update`**

```sql
CREATE TABLE staging.last_update (
    table_name VARCHAR(50) NOT NULL PRIMARY KEY,
    last_update TIMESTAMP NOT NULL
);
```

- –í –Ω–µ–π —Ö—Ä–∞–Ω—è—Ç—Å—è **–Ω–∞–∑–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü –∏ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–≥—Ä—É–∑–∫–∏**.
- –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å —Ç—É–¥–∞ **–¥–∞—Ç—É –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∞–±–ª–∏—Ü—ã `inventory`**.

3Ô∏è‚É£ **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ `last_update` –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏**

- –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ `staging.inventory` –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É `last_update`:
    
    ```sql
    INSERT INTO staging.last_update (table_name, last_update)
    VALUES ('inventory', CURRENT_TIMESTAMP)
    ON CONFLICT (table_name)
    DO UPDATE SET last_update = CURRENT_TIMESTAMP;
    ```
    
- –ï—Å–ª–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ —É–∂–µ –µ—Å—Ç—å –∑–∞–ø–∏—Å—å –¥–ª—è `inventory`, **–æ–±–Ω–æ–≤–ª—è–µ–º `last_update`**.

---

### **üîπ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å —É—á—ë—Ç–æ–º `last_update` –∏ `deleted_at`**

1Ô∏è‚É£ **–í—ã–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –∏–ª–∏ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏**

```sql
SELECT * FROM public.inventory 
WHERE last_update > (SELECT last_update FROM staging.last_update WHERE table_name = 'inventory');
```

- –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç **–∑–∞–≥—Ä—É–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–∏, –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–≥—Ä—É–∑–∫–∏**.

2Ô∏è‚É£ **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —É–¥–∞–ª—ë–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏**

- –ó–∞–ø—Ä–æ—Å –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏:
    
    ```sql
    SELECT * FROM public.inventory 
    WHERE deleted_at IS NOT NULL AND deleted_at > (SELECT last_update FROM staging.last_update WHERE table_name = 'inventory');
    ```
    
- –£–¥–∞–ª—è–µ–º —ç—Ç–∏ –∑–∞–ø–∏—Å–∏ –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞.

3Ô∏è‚É£ **–§–∏–Ω–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∑–∫–∏**

```sql
-- –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤—ã–µ –∏ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏
INSERT INTO staging.inventory 
SELECT * FROM public.inventory 
WHERE last_update > (SELECT last_update FROM staging.last_update WHERE table_name = 'inventory');

-- –£–¥–∞–ª—è–µ–º –∑–∞–ø–∏—Å–∏, –ø–æ–º–µ—á–µ–Ω–Ω—ã–µ –∫–∞–∫ —É–¥–∞–ª—ë–Ω–Ω—ã–µ
DELETE FROM warehouse.inventory
WHERE inventory_id IN (
    SELECT inventory_id FROM staging.inventory WHERE deleted_at IS NOT NULL
);

-- –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç–∫—É –≤—Ä–µ–º–µ–Ω–∏ –≤ `last_update`
INSERT INTO staging.last_update (table_name, last_update)
VALUES ('inventory', CURRENT_TIMESTAMP)
ON CONFLICT (table_name) DO UPDATE SET last_update = CURRENT_TIMESTAMP;
```

- **–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º** —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –∏–ª–∏ –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏.
- **–ü–æ—Ç–æ–º —É–¥–∞–ª—è–µ–º** —Ç–µ, —á—Ç–æ –±—ã–ª–∏ –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ `deleted_at`.
- **–í –∫–æ–Ω—Ü–µ –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É `last_update`**.

---

### **‚úÖ –ò—Ç–æ–≥: –ß—Ç–æ –º—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏?**

‚úî –î–æ–±–∞–≤–∏–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É **–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏** –≤ —Ç–∞–±–ª–∏—Ü—É `inventory`.  
‚úî –ò—Å–ø–æ–ª—å–∑—É–µ–º **–ø–æ–ª–µ `last_update`**, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.  
‚úî –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º **—É–¥–∞–ª—ë–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏** —Å `deleted_at`.  
‚úî –ò—Å–ø–æ–ª—å–∑—É–µ–º **—Ç–∞–±–ª–∏—Ü—É `last_update`** –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–≥—Ä—É–∑–∫–∏.