–ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ—Ç **–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö** –∏ –º–µ—Ç–æ–¥–∞—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö (`TEMP`) –∏ `UNLOGGED` —Ç–∞–±–ª–∏—Ü**.

---

## **üîπ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö (Slowly Changing Dimensions, SCD)**

üìå **–ü—Ä–æ–±–ª–µ–º–∞:**

- –í —Ç–µ–∫—É—â–µ–π –º–æ–¥–µ–ª–∏ **–∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è**.
- –ù–æ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ **—Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π**, –ø—Ä–æ—Å—Ç–æ–π `UPDATE` **—Å—Ç–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è**.

üìå **–†–µ—à–µ–Ω–∏–µ:**  
–í–Ω–µ–¥—Ä–µ–Ω–∏–µ **–º–æ–¥–µ–ª–∏ Slowly Changing Dimensions (SCD)** ‚Äì —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–ø–æ—Å–æ–±–æ–≤ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.

### **–¢–∏–ø—ã SCD (Slowly Changing Dimensions)**

|–¢–∏–ø|–û–ø–∏—Å–∞–Ω–∏–µ|–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ|
|---|---|---|
|**SCD Type 0**|–ù–µ –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ, –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.|–†–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è|
|**SCD Type 1**|–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏ **–ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º –µ—ë** (–Ω–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏).|–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ DWH|
|**SCD Type 2**|–°–æ—Ö—Ä–∞–Ω—è–µ–º **—Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ –∑–∞–ø–∏—Å–µ–π** –∏ –ø–æ–º–µ—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—É—é.|–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –µ—Å–ª–∏ –≤–∞–∂–Ω–∞ –∏—Å—Ç–æ—Ä–∏—è|
|**SCD Type 3**|–°–æ—Ö—Ä–∞–Ω—è–µ–º **—Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ**, –¥–æ–±–∞–≤–ª—è—è –∫–æ–ª–æ–Ω–∫—É `previous_value`.|–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π|
|**SCD Type 4**|–ò—Å–ø–æ–ª—å–∑—É–µ–º **–¥–≤–µ —Ç–∞–±–ª–∏—Ü—ã**: –æ–¥–Ω—É –¥–ª—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –≤—Ç–æ—Ä—É—é ‚Äì –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏.|–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–∞—Ö –¥–∞–Ω–Ω—ã—Ö|

---

## **üîç –†–µ–∞–ª–∏–∑–∞—Ü–∏—è SCD Type 2 –≤ `Core`-—Å–ª–æ–µ**

### **–î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—è –¥–ª—è –∏—Å—Ç–æ—Ä–∏—á–Ω–æ—Å—Ç–∏:**

```sql
ALTER TABLE core.inventory
ADD COLUMN valid_from TIMESTAMP,
ADD COLUMN valid_to TIMESTAMP DEFAULT NULL,
ADD COLUMN is_current BOOLEAN DEFAULT TRUE;
```

üìå **–ß—Ç–æ –æ–∑–Ω–∞—á–∞—é—Ç –Ω–æ–≤—ã–µ –ø–æ–ª—è?**

- `valid_from` ‚Äì **–¥–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –¥–µ–π—Å—Ç–≤–∏—è –∑–∞–ø–∏—Å–∏**.
- `valid_to` ‚Äì **–¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è –∑–∞–ø–∏—Å–∏** (NULL = –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å).
- `is_current` ‚Äì **—Ñ–ª–∞–≥ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏** (`TRUE` = –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å).

---

### **–û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ü–µ–¥—É—Ä—É –∑–∞–≥—Ä—É–∑–∫–∏ –≤ `Core`, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π**

üìå **–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ `inventory` —Ç–µ–ø–µ—Ä—å –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º –∏—Ö, –∞ —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é**:

```sql
UPDATE core.inventory
SET valid_to = CURRENT_TIMESTAMP, is_current = FALSE
WHERE inventory_id IN (
    SELECT inventory_id FROM staging.inventory
) AND is_current = TRUE;

INSERT INTO core.inventory (inventory_id, film_id, store_id, last_update, valid_from, is_current)
SELECT inventory_id, film_id, store_id, last_update, CURRENT_TIMESTAMP, TRUE
FROM staging.inventory;
```

üîπ **–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å?**

- **–°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è –∑–∞–ø–∏—Å–∏** –ø–æ–ª—É—á–∞–µ—Ç `valid_to = CURRENT_TIMESTAMP` –∏ `is_current = FALSE`.
- **–ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –≤—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è**, –Ω–∞—á–∏–Ω–∞—è —Å —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.

‚úÖ –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ **–æ—Ç—Å–ª–µ–¥–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π –∑–∞–ø–∏—Å–µ–π –≤ `inventory`**!

---

## **üîπ –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ `UNLOGGED` —Ç–∞–±–ª–∏—Ü—ã –≤ PostgreSQL**

### **üü¢ –í—Ä–µ–º–µ–Ω–Ω—ã–µ (`TEMP`) —Ç–∞–±–ª–∏—Ü—ã**

- –°–æ–∑–¥–∞—é—Ç—Å—è **–≤—Ä–µ–º–µ–Ω–Ω–æ** –≤ —Ä–∞–º–∫–∞—Ö **—Å–µ—Å—Å–∏–∏ –∏–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**.
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è **—Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**.

üìå **–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `TEMP` —Ç–∞–±–ª–∏—Ü—ã:**

```sql
CREATE TEMP TABLE temp_inventory AS 
SELECT * FROM staging.inventory;
```

‚úî **–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –∏ —Å–ª–æ–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π**.

---

### **üü† `UNLOGGED` —Ç–∞–±–ª–∏—Ü—ã**

- **–ù–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –∂—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –∏—Ö **–±—ã—Å—Ç—Ä–µ–µ**.
- **–ú–∏–Ω—É—Å** ‚Äì –ø—Ä–∏ —Å–±–æ–µ —Å–µ—Ä–≤–µ—Ä–∞ **–¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å —É—Ç–µ—Ä—è–Ω—ã**.

üìå **–°–æ–∑–¥–∞–Ω–∏–µ `UNLOGGED` —Ç–∞–±–ª–∏—Ü—ã:**

```sql
CREATE UNLOGGED TABLE fast_inventory AS 
SELECT * FROM staging.inventory;
```

‚úî **–ü–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö**.

---

## **‚úÖ –ò—Ç–æ–≥: —á—Ç–æ –Ω–æ–≤–æ–≥–æ —É–∑–Ω–∞–ª–∏?**

‚úî **–î–æ–±–∞–≤–∏–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É –∏—Å—Ç–æ—Ä–∏—á–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö (SCD Type 2)**.  
‚úî **–†–∞–∑–æ–±—Ä–∞–ª–∏ —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É `TEMP` –∏ `UNLOGGED` —Ç–∞–±–ª–∏—Ü–∞–º–∏**.  
‚úî **–ù–∞—É—á–∏–ª–∏—Å—å —É–ø—Ä–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–º–∏ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**.

üìå **–ó–∞–∫–ª—é—á–µ–Ω–∏–µ:**  
–ú—ã **–∑–∞–≤–µ—Ä—à–∏–ª–∏ —Ä–∞–∑–±–æ—Ä —Ç–µ–º—ã –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏**, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–∏ –µ—ë –∏ –¥–æ–±–∞–≤–∏–ª–∏ **—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π**. üöÄ