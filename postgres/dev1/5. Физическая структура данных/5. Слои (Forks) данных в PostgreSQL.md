### **üìå –ü–æ–¥—Ä–æ–±–Ω—ã–π –∫–æ–Ω—Å–ø–µ–∫—Ç –ø—è—Ç–æ–π —á–∞—Å—Ç–∏: –°–ª–æ–∏ (Forks) –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL**

---

## **5Ô∏è‚É£ –°–ª–æ–∏ (Forks) –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL**

–¢–µ–ø–µ—Ä—å —Ä–∞–∑–±–µ—Ä—ë–º **–º–µ—Ö–∞–Ω–∏–∑–º —Å–ª–æ—ë–≤ (forks) —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL**:

- –ß—Ç–æ —Ç–∞–∫–æ–µ **forks** –∏ –∑–∞—á–µ–º –æ–Ω–∏ –Ω—É–∂–Ω—ã?
- –ö–∞–∫–∏–µ **–≤–∏–¥—ã —Å–ª–æ—ë–≤** —Å—É—â–µ—Å—Ç–≤—É—é—Ç?
- –ö–∞–∫ PostgreSQL **–æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** —Å –∏—Ö –ø–æ–º–æ—â—å—é?

---

### **üîπ –ß—Ç–æ —Ç–∞–∫–æ–µ Forks –≤ PostgreSQL?**

**Fork (–°–ª–æ–π) ‚Äì —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å (—Ñ–∞–π–ª), —Å–æ–¥–µ—Ä–∂–∞—â–∞—è –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –∏–ª–∏ –∏–Ω–¥–µ–∫—Å–∞**.

–ö–∞–∂–¥—ã–π –æ–±—ä–µ–∫—Ç (—Ç–∞–±–ª–∏—Ü–∞ –∏–ª–∏ –∏–Ω–¥–µ–∫—Å) –≤ PostgreSQL **–º–æ–∂–µ—Ç —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤**, –∫–æ—Ç–æ—Ä—ã–µ —Ö—Ä–∞–Ω—è—Ç:

- **–æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** (Main fork),
- **–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Å—Ç—Ä–æ–∫** (Visibility Map fork),
- **–∫–∞—Ä—Ç—ã —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞** (Free Space Map fork).

üí° **–ü—Ä–∏–º–µ—Ä —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã `orders` –≤ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ:**

```
/pgdata/base/16384/
‚îú‚îÄ‚îÄ 32768          # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª —Ç–∞–±–ª–∏—Ü—ã (Main Fork)
‚îú‚îÄ‚îÄ 32768_fsm      # –ö–∞—Ä—Ç–∞ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ (Free Space Map)
‚îú‚îÄ‚îÄ 32768_vm       # –ö–∞—Ä—Ç–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Å—Ç—Ä–æ–∫ (Visibility Map)
```

---

### **üîπ –í–∏–¥—ã Forks –≤ PostgreSQL**

|Fork (–°–ª–æ–π)|–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ|
|---|---|
|**Main fork**|–û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –∏–ª–∏ –∏–Ω–¥–µ–∫—Å–∞|
|**Free Space Map (FSM)**|–ö–∞—Ä—Ç–∞ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞|
|**Visibility Map (VM)**|–ö–∞—Ä—Ç–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Å—Ç—Ä–æ–∫|
|**INIT fork** (—Ç–æ–ª—å–∫–æ –¥–ª—è –∏–Ω–¥–µ–∫—Å–æ–≤)|–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏|

---

### **üîπ 1. Main fork ‚Äì –û—Å–Ω–æ–≤–Ω–æ–π —Å–ª–æ–π –¥–∞–Ω–Ω—ã—Ö**

**–•—Ä–∞–Ω–∏—Ç –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∞–±–ª–∏—Ü–µ** (—Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–æ–∫–∏).

üìå **–ì–ª–∞–≤–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:

- –ö–∞–∂–¥–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∏–ª–∏ –∏–Ω–¥–µ–∫—Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏–º–µ–µ—Ç —ç—Ç–æ—Ç —Ñ–∞–π–ª.
- –•—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ **—Å—Ç—Ä–∞–Ω–∏—Ü –ø–æ 8 KB**.
- –ï—Å–ª–∏ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç **1 –ì–ë**, PostgreSQL —Å–æ–∑–¥–∞—ë—Ç —Ñ–∞–π–ª—ã `.1`, `.2`, `.3` –∏ —Ç. –¥.

üí° **–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü—ã –≤ Main Fork?**

```sql
SELECT pg_relation_size('orders', 'main');
```

---

### **üîπ 2. Free Space Map (FSM) ‚Äì –ö–∞—Ä—Ç–∞ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞**

**–ü–æ–∑–≤–æ–ª—è–µ—Ç PostgreSQL –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ –≤ —Ç–∞–±–ª–∏—Ü–µ**.

üìå **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?**

- –ö–æ–≥–¥–∞ —Å—Ç—Ä–æ–∫–∞ —É–¥–∞–ª—è–µ—Ç—Å—è, –µ—ë –º–µ—Å—Ç–æ –æ—Å—Ç–∞—ë—Ç—Å—è **–∑–∞–Ω—è—Ç—ã–º** (–¥–æ `VACUUM`).
- FSM —Ö—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–º, –∫–∞–∫–∏–µ **—Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–º–µ—é—Ç —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ**.
- –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç PostgreSQL –±—ã—Å—Ç—Ä–µ–µ –Ω–∞—Ö–æ–¥–∏—Ç—å **–∫—É–¥–∞ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏**, –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—è –∫–∞–∂–¥—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ä—É—á–Ω—É—é.

üí° **–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä FSM-—Ñ–∞–π–ª–∞?**

```sql
SELECT pg_relation_size('orders', 'fsm');
```

---

### **üîπ 3. Visibility Map (VM) ‚Äì –ö–∞—Ä—Ç–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Å—Ç—Ä–æ–∫**

**–ü–æ–º–æ–≥–∞–µ—Ç —É—Å–∫–æ—Ä–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ —á—Ç–µ–Ω–∏—è –∏ `VACUUM`**.

üìå **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?**

- VM —Ö—Ä–∞–Ω–∏—Ç **—Ñ–ª–∞–≥–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü**, —É–∫–∞–∑—ã–≤–∞—è, –µ—Å—Ç—å –ª–∏ –≤ –Ω–∏—Ö **—É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Å—Ç—Ä–æ–∫–∏**.
- –ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–º–µ—á–µ–Ω–∞ –∫–∞–∫ **"—á–∏—Å—Ç–∞—è"**, `VACUUM` –µ—ë **–ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç**.
- –≠—Ç–æ **—É—Å–∫–æ—Ä—è–µ—Ç `VACUUM`**, –ø–æ—Å–∫–æ–ª—å–∫—É PostgreSQL –Ω–µ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –≤–µ—Å—å —Ñ–∞–π–ª.

üí° **–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä VM-—Ñ–∞–π–ª–∞?**

```sql
SELECT pg_relation_size('orders', 'vm');
```

---

### **üîπ 4. INIT Fork (–¢–æ–ª—å–∫–æ –¥–ª—è –∏–Ω–¥–µ–∫—Å–æ–≤)**

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è PostgreSQL **—Ç–æ–ª—å–∫–æ –¥–ª—è –∏–Ω–¥–µ–∫—Å–æ–≤**.

üìå **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ INIT Fork**:

- –ü–æ–º–æ–≥–∞–µ—Ç –±—ã—Å—Ç—Ä–æ **–ø–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã** –ø—Ä–∏ —Å–±–æ–µ –∏–ª–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏.
- –°–æ–¥–µ—Ä–∂–∏—Ç **–Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞**, —á—Ç–æ–±—ã —É—Å–∫–æ—Ä–∏—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ.

---

### **üîπ –ö–∞–∫ –Ω–∞–π—Ç–∏ –≤—Å–µ Forks —Ç–∞–±–ª–∏—Ü—ã?**

–í PostgreSQL –º–æ–∂–Ω–æ –∑–∞–ø—Ä–æ—Å–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—Å–µ—Ö —Å–ª–æ—è—Ö (forks) —Ç–∞–±–ª–∏—Ü—ã —Å –ø–æ–º–æ—â—å—é:

```sql
SELECT pg_relation_size('orders', 'main') AS main_fork,
       pg_relation_size('orders', 'fsm') AS fsm_fork,
       pg_relation_size('orders', 'vm') AS vm_fork;
```

---

### **üîπ –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã Forks**

üí° **–°—Ü–µ–Ω–∞—Ä–∏–π:**

1. –°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—É –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–µ—ë –¥–∞–Ω–Ω—ã–µ:
    
    ```sql
    CREATE TABLE orders (id SERIAL, details TEXT);
    INSERT INTO orders (details) SELECT 'order_' || generate_series(1, 100000);
    ```
    
2. –ü—Ä–æ–≤–µ—Ä—è–µ–º **—Ä–∞–∑–º–µ—Ä—ã —Ä–∞–∑–Ω—ã—Ö —Å–ª–æ—ë–≤**:
    
    ```sql
    SELECT pg_relation_size('orders', 'main') AS main,
           pg_relation_size('orders', 'fsm') AS fsm,
           pg_relation_size('orders', 'vm') AS vm;
    ```
    
3. **–£–¥–∞–ª—è–µ–º 50% —Å—Ç—Ä–æ–∫ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ FSM**:
    
    ```sql
    DELETE FROM orders WHERE id % 2 = 0;
    ```
    
4. **–ó–∞–ø—É—Å–∫–∞–µ–º `VACUUM` –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º Visibility Map**:
    
    ```sql
    VACUUM ANALYZE orders;
    ```
    

---

### **üîπ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ –ø—è—Ç–æ–π —á–∞—Å—Ç–∏**

- PostgreSQL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Å–ª–æ–∏ (Forks)** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞–º–∏ —Ç–∞–±–ª–∏—Ü.
- **Main fork** ‚Äì –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª —Ç–∞–±–ª–∏—Ü—ã.
- **FSM (Free Space Map)** ‚Äì —Ö—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ **—Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö**.
- **VM (Visibility Map)** ‚Äì –ø–æ–º–æ–≥–∞–µ—Ç `VACUUM` –±—ã—Å—Ç—Ä–µ–µ –Ω–∞—Ö–æ–¥–∏—Ç—å **—É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Å—Ç—Ä–æ–∫–∏**.
- **INIT Fork** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –∏–Ω–¥–µ–∫—Å–∞—Ö –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.

---

## 5Ô∏è‚É£.3 –ü–æ—á–µ–º—É Forks –≤–∞–∂–Ω—ã?

- **FSM —É—Å–∫–æ—Ä—è–µ—Ç –≤—Å—Ç–∞–≤–∫—É –Ω–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫**.
- **VM –ø–æ–º–æ–≥–∞–µ—Ç `VACUUM` –±—ã—Å—Ç—Ä–µ–µ –æ—á–∏—â–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É**.
- **INIT Fork —É—Å–∫–æ—Ä—è–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤**.

---

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ **—à–µ—Å—Ç–æ–π —á–∞—Å—Ç–∏** ‚Äì **TOAST: —Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL**! üöÄ
