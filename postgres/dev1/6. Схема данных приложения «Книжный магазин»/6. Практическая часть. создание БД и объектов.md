### **–ü–æ–¥—Ä–æ–±–Ω—ã–π –∫–æ–Ω—Å–ø–µ–∫—Ç –≤–∏–¥–µ–æ (–ß–∞—Å—Ç—å 6: –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å ‚Äì —Å–æ–∑–¥–∞–Ω–∏–µ –ë–î –∏ API)**

---

## **1. –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è**

–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –æ–±—ä—è—Å–Ω—è–µ—Ç, —á—Ç–æ —Ç–µ–ø–µ—Ä—å —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –Ω—É–∂–Ω–æ **—Å–æ–∑–¥–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ API**, —á—Ç–æ–±—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç–∞—Ç—å.

‚úÖ **–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å**:

1. –°–æ–∑–¥–∞—Ç—å **—Å—Ö–µ–º—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**.
2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –µ—ë –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.
3. –°–æ–∑–¥–∞—Ç—å **–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏ —Ñ—É–Ω–∫—Ü–∏–∏ API**.
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

---

## **2. –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ —Å—Ö–µ–º—ã**

üìå **–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö `bookstore`**

```sql
CREATE DATABASE bookstore;
```

üìå **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ**

```sql
\c bookstore
```

üìå **–°–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º—ã `bookstore` –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—É—Ç–∏ –ø–æ–∏—Å–∫–∞**

```sql
CREATE SCHEMA bookstore;
SET search_path TO bookstore;
```

---

## **3. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü**

üìå **–¢–∞–±–ª–∏—Ü–∞ –∫–Ω–∏–≥**

```sql
CREATE TABLE books (
    book_id SERIAL PRIMARY KEY,
    title TEXT NOT NULL
);
```

üìå **–¢–∞–±–ª–∏—Ü–∞ –∞–≤—Ç–æ—Ä–æ–≤**

```sql
CREATE TABLE authors (
    author_id SERIAL PRIMARY KEY,
    last_name TEXT NOT NULL,
    first_name TEXT NOT NULL,
    middle_name TEXT
);
```

üìå **–¢–∞–±–ª–∏—Ü–∞ –∞–≤—Ç–æ—Ä—Å—Ç–≤–∞ (—Å–≤—è–∑—å –º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º)**

```sql
CREATE TABLE authorship (
    book_id INTEGER NOT NULL REFERENCES books(book_id) ON DELETE CASCADE,
    author_id INTEGER NOT NULL REFERENCES authors(author_id) ON DELETE CASCADE,
    author_order INTEGER NOT NULL,
    PRIMARY KEY (book_id, author_id)
);
```

üìå **–¢–∞–±–ª–∏—Ü–∞ –æ–ø–µ—Ä–∞—Ü–∏–π (—Å–∫–ª–∞–¥—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)**

```sql
CREATE TABLE operations (
    operation_id SERIAL PRIMARY KEY,
    book_id INTEGER NOT NULL REFERENCES books(book_id) ON DELETE CASCADE,
    quantity_change INTEGER NOT NULL,
    operation_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

---

## **4. –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏**

üìå **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–æ–≤**

```sql
INSERT INTO authors (last_name, first_name, middle_name) VALUES
('–¢–æ–ª—Å—Ç–æ–π', '–õ–µ–≤', '–ù–∏–∫–æ–ª–∞–µ–≤–∏—á'),
('–î–æ—Å—Ç–æ–µ–≤—Å–∫–∏–π', '–§—ë–¥–æ—Ä', '–ú–∏—Ö–∞–π–ª–æ–≤–∏—á'),
('–ü—É—à–∫–∏–Ω', '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä', '–°–µ—Ä–≥–µ–µ–≤–∏—á');
```

üìå **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–∏–≥**

```sql
INSERT INTO books (title) VALUES 
('–í–æ–π–Ω–∞ –∏ –º–∏—Ä'),
('–ü—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–µ –∏ –Ω–∞–∫–∞–∑–∞–Ω–∏–µ'),
('–ï–≤–≥–µ–Ω–∏–π –û–Ω–µ–≥–∏–Ω');
```

üìå **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑–µ–π –∞–≤—Ç–æ—Ä–æ–≤ —Å –∫–Ω–∏–≥–∞–º–∏**

```sql
INSERT INTO authorship (book_id, author_id, author_order) VALUES
(1, 1, 1),
(2, 2, 1),
(3, 3, 1);
```

üìå **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–∫–ª–∞–¥—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ –∫–Ω–∏–≥)**

```sql
INSERT INTO operations (book_id, quantity_change) VALUES
(1, 10), -- 10 —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ "–í–æ–π–Ω—ã –∏ –º–∏—Ä–∞"
(2, 5),  -- 5 —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ "–ü—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏—è –∏ –Ω–∞–∫–∞–∑–∞–Ω–∏—è"
(3, 7);  -- 7 —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ "–ï–≤–≥–µ–Ω–∏—è –û–Ω–µ–≥–∏–Ω–∞"
```

---

## **5. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π (Views) –¥–ª—è API**

üìå **–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∞–≤—Ç–æ—Ä–æ–≤**

```sql
CREATE VIEW author_list AS
SELECT author_id, last_name || ' ' || first_name || COALESCE(' ' || middle_name, '') AS full_name
FROM authors;
```

üìå **–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞ –∫–Ω–∏–≥**

```sql
CREATE VIEW book_catalog AS
SELECT b.book_id, b.title, COUNT(a.author_id) AS author_count
FROM books b
LEFT JOIN authorship a ON b.book_id = a.book_id
GROUP BY b.book_id;
```

üìå **–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π**

```sql
CREATE VIEW operation_log AS
SELECT o.operation_id, b.title, o.quantity_change, o.operation_date
FROM operations o
JOIN books b ON o.book_id = b.book_id;
```

---

## **6. –°–æ–∑–¥–∞–Ω–∏–µ API-—Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**

üìå **–§—É–Ω–∫—Ü–∏—è –ø–æ–∫—É–ø–∫–∏ –∫–Ω–∏–≥–∏ (—Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞–ª–∏—á–∏—è –Ω–∞ —Å–∫–ª–∞–¥–µ)**

```sql
CREATE FUNCTION buy_book_safe(book_id INTEGER) RETURNS TEXT AS $$
DECLARE stock_count INTEGER;
BEGIN
  SELECT COALESCE(SUM(quantity_change), 0) INTO stock_count 
  FROM operations WHERE book_id = buy_book_safe.book_id;
  
  IF stock_count <= 0 THEN
    RETURN '–û—à–∏–±–∫–∞: –∫–Ω–∏–≥–∏ –Ω–µ—Ç –Ω–∞ —Å–∫–ª–∞–¥–µ!';
  END IF;

  INSERT INTO operations (book_id, quantity_change) VALUES (book_id, -1);
  RETURN '–ü–æ–∫—É–ø–∫–∞ —É—Å–ø–µ—à–Ω–∞!';
END;
$$ LANGUAGE plpgsql;
```

üìå **–§—É–Ω–∫—Ü–∏—è –∑–∞–∫–∞–∑–∞ –Ω–æ–≤–æ–π –ø–∞—Ä—Ç–∏–∏ –∫–Ω–∏–≥**

```sql
CREATE FUNCTION order_books(book_id INTEGER, quantity INTEGER) RETURNS VOID AS $$
BEGIN
  INSERT INTO operations (book_id, quantity_change) VALUES (book_id, quantity);
END;
$$ LANGUAGE plpgsql;
```

---

## **7. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã API**

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ API-—Ñ—É–Ω–∫—Ü–∏–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Ö —Ä–∞–±–æ—Ç—É.

üìå **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π**

```sql
SELECT * FROM author_list;
SELECT * FROM book_catalog;
SELECT * FROM operation_log;
```

üìå **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∫—É–ø–∫–∏ –∫–Ω–∏–≥–∏**

```sql
SELECT buy_book_safe(1);
```

üìå **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–∫–∞–∑–∞ –∫–Ω–∏–≥ –Ω–∞ —Å–∫–ª–∞–¥**

```sql
SELECT order_books(2, 5);
```

‚úÖ **–ï—Å–ª–∏ –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫, –∑–Ω–∞—á–∏—Ç –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ API —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!**

---

## **8. –ò—Ç–æ–≥–∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è**

- –°–æ–∑–¥–∞–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö **bookstore**.
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ **–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å—Ö–µ–º–∞** (–∫–Ω–∏–≥–∏, –∞–≤—Ç–æ—Ä—ã, –æ–ø–µ—Ä–∞—Ü–∏–∏, –∞–≤—Ç–æ—Ä—Å—Ç–≤–æ).
- –°–æ–∑–¥–∞–Ω—ã **–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è** –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º.
- –ù–∞–ø–∏—Å–∞–Ω—ã **—Ñ—É–Ω–∫—Ü–∏–∏ API** –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –∏ –∑–∞–∫–∞–∑–∞ –∫–Ω–∏–≥.
- –ü—Ä–æ–≤–µ–¥–µ–Ω–∞ **–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã** —á–µ—Ä–µ–∑ SQL-–∑–∞–ø—Ä–æ—Å—ã.

üìå –¢–µ–ø–µ—Ä—å –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ **–¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å**!

---

### **‚è≠ –ó–∞–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å: –ò—Ç–æ–≥–∏ –∫—É—Ä—Å–∞ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**

–ï—Å–ª–∏ –≤—Å—ë –æ–∫, –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ—Ç–≤–µ—Ç–µ —Ä–∞–∑–±–µ—Ä—ë–º **–æ—Å–Ω–æ–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã –ø–æ –∫—É—Ä—Å—É, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –∏ –¥–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏**. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏, –∏ —è –ø—Ä–æ–¥–æ–ª–∂—É.