### **–ü–æ–¥—Ä–æ–±–Ω—ã–π –∫–æ–Ω—Å–ø–µ–∫—Ç –≤–∏–¥–µ–æ (–ß–∞—Å—Ç—å 5: –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º)**

---

## **1. –í–≤–µ–¥–µ–Ω–∏–µ –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞**

–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –æ–±—ä—è—Å–Ω—è–µ—Ç, –∫–∞–∫ **—Å–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —á–∞—Å—Ç—å—é (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º)**.  
–°—É—â–µ—Å—Ç–≤—É—é—Ç **–¥–≤–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–∞** –∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è:

### **üîπ –ü–æ–¥—Ö–æ–¥ 1: –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ —Ç–∞–±–ª–∏—Ü–∞–º**

- –ö–ª–∏–µ–Ω—Ç—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ **—Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ** –¥–µ–ª–∞–µ—Ç SQL-–∑–∞–ø—Ä–æ—Å—ã –∫ —Ç–∞–±–ª–∏—Ü–∞–º.
- –ù–∞–ø—Ä–∏–º–µ—Ä:
    
    ```sql
    SELECT * FROM books WHERE title ILIKE '%–≤–æ–π–Ω–∞%';
    ```
    
- **–ü–ª—é—Å—ã**:
    - –ì–∏–±–∫–æ—Å—Ç—å –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ (–º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –ª—é–±—ã–µ –∑–∞–ø—Ä–æ—Å—ã).
- **–ú–∏–Ω—É—Å—ã**:
    - –ö–ª–∏–µ–Ω—Ç **–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã** (–ª—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ).
    - **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏** –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞.

---

### **üîπ –ü–æ–¥—Ö–æ–¥ 2: API –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**

- –ö–ª–∏–µ–Ω—Ç **–Ω–µ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ —Ç–∞–±–ª–∏—Ü–∞–º –Ω–∞–ø—Ä—è–º—É—é**, –∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (views), —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã**.
- –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç **—Å–∫—Ä—ã—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –±–∞–∑—ã** –∏ –∑–∞—â–∏—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ.
- –ù–∞–ø—Ä–∏–º–µ—Ä, –≤–º–µ—Å—Ç–æ –∑–∞–ø—Ä–æ—Å–∞ –∫ —Ç–∞–±–ª–∏—Ü–µ –∫–Ω–∏–≥ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏:
    
    ```sql
    SELECT * FROM get_catalog();
    ```
    
- **–ü–ª—é—Å—ã**:
    - –ì–∏–±–∫–æ—Å—Ç—å –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞ (–º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–∞–∑—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è API).
    - –ú–æ–∂–Ω–æ **–æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞** –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
    - –£–ª—É—á—à–µ–Ω–∏–µ **–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** (—Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã).
- **–ú–∏–Ω—É—Å—ã**:
    - –¢—Ä–µ–±—É–µ—Ç—Å—è **–ø–∏—Å–∞—Ç—å API –≤—Ä—É—á–Ω—É—é** (—Ñ—É–Ω–∫—Ü–∏–∏, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è).

üìå **–í—ã–≤–æ–¥**: –í —ç—Ç–æ–º –∫—É—Ä—Å–µ **–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥** ‚Äì **–≤ –º–∞–≥–∞–∑–∏–Ω–µ API —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏–∏, –≤ –∞–¥–º–∏–Ω–∫–µ API —á–µ—Ä–µ–∑ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è**.

---

## **2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π (Views) –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞**

–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –æ–±—ä—è—Å–Ω—è–µ—Ç, –∫–∞–∫ **–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (views) –ø–æ–∑–≤–æ–ª—è—é—Ç –∫–ª–∏–µ–Ω—Ç—É –ø–æ–ª—É—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–∞–±–ª–∏—Ü–∞–º**.

üìå **–ü—Ä–æ—Å—Ç–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∞–≤—Ç–æ—Ä–æ–≤**:

```sql
CREATE VIEW author_list AS
SELECT author_id, last_name || ' ' || first_name || COALESCE(' ' || middle_name, '') AS full_name
FROM authors;
```

–¢–µ–ø–µ—Ä—å –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –ø—Ä–æ—Å—Ç–æ –¥–µ–ª–∞—Ç—å:

```sql
SELECT * FROM author_list;
```

üìå **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç**:

- –í–º–µ—Å—Ç–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã—á–∏—Å–ª—è–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü–µ, –æ–Ω–∏ **–≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏**.
- **COALESCE()** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, —á—Ç–æ–±—ã **–∏–∑–±–µ–∂–∞—Ç—å NULL** (–µ—Å–ª–∏ —É –∞–≤—Ç–æ—Ä–∞ –Ω–µ—Ç –æ—Ç—á–µ—Å—Ç–≤–∞).

üìå **–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã**:

|author_id|full_name|
|---|---|
|1|–¢–æ–ª—Å—Ç–æ–π –õ–µ–≤ –ù–∏–∫–æ–ª–∞–µ–≤–∏—á|
|2|–î–æ—Å—Ç–æ–µ–≤—Å–∫–∏–π –§—ë–¥–æ—Ä –ú–∏—Ö–∞–π–ª–æ–≤–∏—á|

---

## **3. –û–±–Ω–æ–≤–ª—è–µ–º—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (WITH INSTEAD OF TRIGGER)**

–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è **–æ–±–Ω–æ–≤–ª—è–µ–º—ã–º–∏** —Å –ø–æ–º–æ—â—å—é —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤.

üìå **–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –∫–∞—Ç–∞–ª–æ–≥–∞ –∫–Ω–∏–≥**:

```sql
CREATE VIEW book_catalog AS
SELECT b.book_id, b.title, COUNT(a.author_id) AS author_count
FROM books b
LEFT JOIN authorship a ON b.book_id = a.book_id
GROUP BY b.book_id;
```

- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–Ω–∏–≥ –∏ **–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–≤—Ç–æ—Ä–æ–≤** —É –∫–∞–∂–¥–æ–π.
- **–ù–æ –µ–≥–æ –Ω–µ–ª—å–∑—è –æ–±–Ω–æ–≤–ª—è—Ç—å –Ω–∞–ø—Ä—è–º—É—é**, –ø–æ—ç—Ç–æ–º—É –Ω—É–∂–µ–Ω —Ç—Ä–∏–≥–≥–µ—Ä.

üìå **–°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ**:

```sql
CREATE FUNCTION update_book_catalog() RETURNS TRIGGER AS $$
BEGIN
  UPDATE books SET title = NEW.title WHERE book_id = OLD.book_id;
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_update_book_catalog
INSTEAD OF UPDATE ON book_catalog
FOR EACH ROW EXECUTE FUNCTION update_book_catalog();
```

‚úÖ –¢–µ–ø–µ—Ä—å –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å:

```sql
UPDATE book_catalog SET title = '–ù–æ–≤–∞—è –∫–Ω–∏–≥–∞' WHERE book_id = 1;
```

–∏ –±–∞–∑–∞ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç** —Ç–∞–±–ª–∏—Ü—É `books`.

---

## **4. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–π API –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**

### üîπ **–§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –∫–Ω–∏–≥–∏**

```sql
CREATE FUNCTION buy_book(book_id INTEGER) RETURNS VOID AS $$
BEGIN
  INSERT INTO operations (book_id, quantity_change) VALUES (book_id, -1);
END;
$$ LANGUAGE plpgsql;
```

üìå **–ü—Ä–∏–º–µ—Ä –≤—ã–∑–æ–≤–∞**:

```sql
SELECT buy_book(1);
```

üî¥ **–ü—Ä–æ–±–ª–µ–º–∞**: –ï—Å–ª–∏ –Ω–∞ —Å–∫–ª–∞–¥–µ 0 –∫–Ω–∏–≥, –ø–æ–∫—É–ø–∫–∞ **–≤—Å—ë —Ä–∞–≤–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç!**  
‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π**:

```sql
CREATE FUNCTION buy_book_safe(book_id INTEGER) RETURNS TEXT AS $$
DECLARE stock_count INTEGER;
BEGIN
  SELECT COALESCE(SUM(quantity_change), 0) INTO stock_count FROM operations WHERE book_id = book_id;
  
  IF stock_count <= 0 THEN
    RETURN '–û—à–∏–±–∫–∞: –∫–Ω–∏–≥–∏ –Ω–µ—Ç –Ω–∞ —Å–∫–ª–∞–¥–µ!';
  END IF;

  INSERT INTO operations (book_id, quantity_change) VALUES (book_id, -1);
  RETURN '–ü–æ–∫—É–ø–∫–∞ —É—Å–ø–µ—à–Ω–∞!';
END;
$$ LANGUAGE plpgsql;
```

üìå **–¢–µ–ø–µ—Ä—å –ø–æ–∫—É–ø–∫–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–Ω–∏–≥–∏ –µ—Å—Ç—å –≤ –Ω–∞–ª–∏—á–∏–∏**.

---

## **5. –ì–∏–±—Ä–∏–¥–Ω—ã–π API: —Ñ—É–Ω–∫—Ü–∏–∏ + –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è**

–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –æ–±—ä—è—Å–Ω—è–µ—Ç, —á—Ç–æ **API –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–∑–Ω—ã–º –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —á–∞—Å—Ç–µ–π —Å–∏—Å—Ç–µ–º—ã**:

|–ß–∞—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã|API|–ü—Ä–∏–º–µ—Ä|
|---|---|---|
|**–ú–∞–≥–∞–∑–∏–Ω**|–§—É–Ω–∫—Ü–∏–∏|`SELECT buy_book(1);`|
|**–ê–¥–º–∏–Ω–∫–∞**|–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è|`SELECT * FROM book_catalog;`|
|**–ö–∞—Ç–∞–ª–æ–≥ –∑–∞–∫—É–ø–æ–∫**|–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è + —Ç—Ä–∏–≥–≥–µ—Ä|`UPDATE book_catalog SET title = '–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ' WHERE book_id = 1;`|

üìå **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ç–∞–∫–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞**:

- –ú–∞–≥–∞–∑–∏–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Å—Ç—Ä–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** (–ø–æ–∫—É–ø–∫–∞ —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é).
- –ê–¥–º–∏–Ω–∫–∞ **–≤–∏–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ —É–¥–æ–±–Ω–æ–π —Ñ–æ—Ä–º–µ** (—á–µ—Ä–µ–∑ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è).
- –í –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ **–∏–∑–º–µ–Ω—è—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –ª–æ–≥–∏–∫—É**, –Ω–µ —Ç—Ä–æ–≥–∞—è –∫–ª–∏–µ–Ω—Ç—Å–∫—É—é —á–∞—Å—Ç—å.

---

### **‚è≠ –°–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å: –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å ‚Äì —Å–æ–∑–¥–∞–Ω–∏–µ –ë–î –∏ API**

–ï—Å–ª–∏ –≤—Å—ë –æ–∫, –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ—Ç–≤–µ—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–æ —Ä–∞–∑–±–µ—Ä—ë–º —à–µ—Å—Ç—É—é —á–∞—Å—Ç—å: **–ö–∞–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –±–∞–∑—ã, –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—é –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ä–∞–±–æ—Ç—ã API**. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏, –∏ —è –ø—Ä–æ–¥–æ–ª–∂—É.