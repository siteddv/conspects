### **–ö–æ–Ω—Å–ø–µ–∫—Ç: –ü—Ä–∏–º–µ—Ä SQL-–∏–Ω—ä–µ–∫—Ü–∏–∏ –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ—ë**

#### **1. –ß—Ç–æ —Ç–∞–∫–æ–µ SQL-–∏–Ω—ä–µ–∫—Ü–∏—è?**

SQL-–∏–Ω—ä–µ–∫—Ü–∏—è ‚Äî —ç—Ç–æ —É—è–∑–≤–∏–º–æ—Å—Ç—å, –≤–æ–∑–Ω–∏–∫–∞—é—â–∞—è, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—Å—Ç–∞–≤–∏—Ç—å –≤ SQL-–∑–∞–ø—Ä–æ—Å –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π –∫–æ–¥. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:

- –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º, –∫ –∫–æ—Ç–æ—Ä—ã–º —É –Ω–µ–≥–æ –Ω–µ—Ç –ø—Ä–∞–≤.
- –ò–∑–º–µ–Ω–∏—Ç—å, —É–¥–∞–ª–∏—Ç—å –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ.
- –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–µ SQL-–∫–æ–º–∞–Ω–¥—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `DROP TABLE`).

---

### **2. –ü—Ä–∏–º–µ—Ä SQL-–∏–Ω—ä–µ–∫—Ü–∏–∏**

#### **‚ùå –ü–ª–æ—Ö–æ–π –∫–æ–¥ (—É—è–∑–≤–∏–º—ã–π)**

```sql
CREATE FUNCTION get_user_info(username TEXT) RETURNS SETOF users AS $$
DECLARE
    query TEXT;
BEGIN
    query := 'SELECT * FROM users WHERE name = ''' || username || '''';
    RETURN QUERY EXECUTE query;
END;
$$ LANGUAGE plpgsql;
```

üìå **–ß—Ç–æ –∑–¥–µ—Å—å –Ω–µ —Ç–∞–∫?**

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è —Å—Ç—Ä–æ–∫ (`'|| username ||'`), —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–Ω–µ–¥—Ä–∏—Ç—å SQL-–∫–æ–¥.

üîπ **–ö–∞–∫ –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É—è–∑–≤–∏–º–æ—Å—Ç—å?**  
–î–æ–ø—É—Å—Ç–∏–º, –≤—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é —Ç–∞–∫:

```sql
SELECT * FROM get_user_info('Oleg''; DELETE FROM users; --');
```

**–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π SQL-–∑–∞–ø—Ä–æ—Å —Å—Ç–∞–Ω–µ—Ç —Ç–∞–∫–∏–º:**

```sql
SELECT * FROM users WHERE name = 'Oleg'; DELETE FROM users; --'
```

üí• **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `users` —É–¥–∞–ª–µ–Ω—ã!

---

### **3. –ö–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å—Å—è –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π?**

‚úÖ **–ú–µ—Ç–æ–¥ 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `USING` (–õ–£–ß–®–ò–ô –í–ê–†–ò–ê–ù–¢)**

```sql
CREATE FUNCTION get_user_info(username TEXT) RETURNS SETOF users AS $$
DECLARE
    query TEXT;
BEGIN
    query := 'SELECT * FROM users WHERE name = $1';
    RETURN QUERY EXECUTE query USING username;
END;
$$ LANGUAGE plpgsql;
```

üîπ **–ü–æ—á–µ–º—É —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ?**

- `USING` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—è SQL-–∏–Ω—ä–µ–∫—Ü–∏–∏.
- –ó–Ω–∞—á–µ–Ω–∏–µ `username` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç SQL-–∑–∞–ø—Ä–æ—Å–∞.

---

‚úÖ **–ú–µ—Ç–æ–¥ 2: –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫ —Å `quote_literal()`**

–ï—Å–ª–∏ –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `USING`, –ø—Ä–∏–º–µ–Ω—è—é—Ç `quote_literal()`:

```sql
CREATE FUNCTION get_user_info(username TEXT) RETURNS SETOF users AS $$
DECLARE
    query TEXT;
BEGIN
    query := 'SELECT * FROM users WHERE name = ' || quote_literal(username);
    RETURN QUERY EXECUTE query;
END;
$$ LANGUAGE plpgsql;
```

üîπ **–ö–∞–∫ —ç—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç?**

- `quote_literal('Oleg''; DELETE FROM users; --')` –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç —Å—Ç—Ä–æ–∫—É –≤ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç:
    
    ```sql
    'Oleg''; DELETE FROM users; --'
    ```
    
    –≠—Ç–æ **–Ω–µ —Ä–∞–∑–æ—Ä–≤—ë—Ç SQL-–∑–∞–ø—Ä–æ—Å** –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ `DELETE`.

---

‚úÖ **–ú–µ—Ç–æ–¥ 3: –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–º—ë–Ω —Ç–∞–±–ª–∏—Ü –∏ —Å—Ç–æ–ª–±—Ü–æ–≤ —Å `quote_ident()`**

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è—Ç—å –∏–º—è —Ç–∞–±–ª–∏—Ü—ã –∏–ª–∏ —Å—Ç–æ–ª–±—Ü–∞:

```sql
EXECUTE 'SELECT * FROM ' || quote_ident(table_name);
```

üîπ **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç `quote_ident()`?**

- `quote_ident('users; DROP TABLE users;')` **–Ω–µ –ø–æ–∑–≤–æ–ª–∏—Ç** –≤—ã–ø–æ–ª–Ω–∏—Ç—å SQL-–∏–Ω—ä–µ–∫—Ü–∏—é.
- –í–º–µ—Å—Ç–æ `users; DROP TABLE users;` –ø–æ–ª—É—á–∏—Ç—Å—è **–Ω–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è —Ç–∞–±–ª–∏—Ü—ã**, –∞ –Ω–µ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π –∫–æ–¥.

---

‚úÖ **–ú–µ—Ç–æ–¥ 4: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `FORMAT()`**

–§—É–Ω–∫—Ü–∏—è `FORMAT()` –¥–µ–ª–∞–µ—Ç –∫–æ–¥ **–±–µ–∑–æ–ø–∞—Å–Ω—ã–º –∏ —á–∏—Ç–∞–µ–º—ã–º**:

```sql
EXECUTE FORMAT('SELECT * FROM %I WHERE name = %L', table_name, username);
```

üîπ **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?**

- `%I` (`quote_ident()`) ‚Äî –∑–∞—â–∏—â–∞–µ—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã (—Ç–∞–±–ª–∏—Ü—ã, —Å—Ç–æ–ª–±—Ü—ã).
- `%L` (`quote_literal()`) ‚Äî –∑–∞—â–∏—â–∞–µ—Ç —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.

---

### **4. –ò—Ç–æ–≥: –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞—â–∏—Ç–∏—Ç—å—Å—è?**

|–ü—Ä–æ–±–ª–µ–º–∞|–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚ùå|–ü—Ä–∞–≤–∏–ª—å–Ω–æ ‚úÖ|
|---|---|---|
|**–ü–µ—Ä–µ–¥–∞—á–∞ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö**|–ö–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è —Å—Ç—Ä–æ–∫|`USING` –∏–ª–∏ `quote_literal()`|
|**–ü–µ—Ä–µ–¥–∞—á–∞ –∏–º—ë–Ω —Ç–∞–±–ª–∏—Ü**|–ü—Ä–æ—Å—Ç–∞—è –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è|`quote_ident()` –∏–ª–∏ `%I` –≤ `FORMAT()`|
|**–û–±—â–∏–π –º–µ—Ç–æ–¥ –∑–∞—â–∏—Ç—ã**|`'||

‚ö†Ô∏è **–õ—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç –∑–∞—â–∏—Ç—ã ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `USING`.**  
–ï—Å–ª–∏ –Ω–µ–ª—å–∑—è ‚Äî –ø—Ä–∏–º–µ–Ω—è–π `quote_ident()`, `quote_literal()` –∏–ª–∏ `FORMAT()`.

---

### **–í—ã–≤–æ–¥**

‚úÖ **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—é —Å—Ç—Ä–æ–∫ –¥–ª—è SQL-–∫–æ–º–∞–Ω–¥!**  
‚úÖ **–í—Å–µ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è–π `USING`, `quote_ident()`, `quote_literal()` –∏–ª–∏ `FORMAT()`.**  
‚úÖ **–¢–∞–∫ —Ç—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–∫–ª—é—á–∏—à—å SQL-–∏–Ω—ä–µ–∫—Ü–∏–∏.**

---

üëâ **–°–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å: –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–∞–Ω–¥.** –ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å?