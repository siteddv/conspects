### **–ö–æ–Ω—Å–ø–µ–∫—Ç: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö SQL-–∫–æ–º–∞–Ω–¥**

#### **1. –û—Å–Ω–æ–≤–Ω—ã–µ —É–≥—Ä–æ–∑—ã –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö SQL-–∫–æ–º–∞–Ω–¥**

–ì–ª–∞–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ SQL ‚Äî —ç—Ç–æ **SQL-–∏–Ω—ä–µ–∫—Ü–∏–∏**.  
–ï—Å–ª–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å SQL-–∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ –ø—Ä–æ—Å—Ç—É—é –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—é —Å—Ç—Ä–æ–∫, –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç –≤—Å—Ç–∞–≤–∏—Ç—å –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π SQL-–∫–æ–¥.

‚ùå **–ü—Ä–∏–º–µ—Ä —É—è–∑–≤–∏–º–æ–≥–æ –∫–æ–¥–∞:**

```sql
CREATE FUNCTION get_user_info(user_name TEXT) RETURNS SETOF users AS $$
DECLARE
    query TEXT;
BEGIN
    query := 'SELECT * FROM users WHERE name = ''' || user_name || '''';
    RETURN QUERY EXECUTE query;
END;
$$ LANGUAGE plpgsql;
```

–ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞—Ç—å –≤ `user_name` —Å–ª–µ–¥—É—é—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:

```sql
'Oleg' OR '1' = '1'
```

–¢–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π SQL-–∑–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç —Ç–∞–∫–∏–º:

```sql
SELECT * FROM users WHERE name = 'Oleg' OR '1' = '1';
```

–≠—Ç–æ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ —Ç–æ–º—É, —á—Ç–æ **–≤–µ—Ä–Ω—É—Ç—Å—è –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏**, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

---

#### **2. –ú–µ—Ç–æ–¥—ã –∑–∞—â–∏—Ç—ã –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π**

‚úÖ **1) –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —á–µ—Ä–µ–∑ `USING`**  
**–õ—É—á—à–∏–π —Å–ø–æ—Å–æ–± –∑–∞—â–∏—Ç—ã** ‚Äî –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ `USING`, –∞ –Ω–µ –∫–æ–Ω–∫–∞—Ç–µ–Ω–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –≤—Ä—É—á–Ω—É—é.

‚úî **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç:**

```sql
CREATE FUNCTION get_user_info(user_name TEXT) RETURNS SETOF users AS $$
DECLARE
    query TEXT;
BEGIN
    query := 'SELECT * FROM users WHERE name = $1';
    RETURN QUERY EXECUTE query USING user_name;
END;
$$ LANGUAGE plpgsql;
```

üîπ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ**:

- –ó–Ω–∞—á–µ–Ω–∏–µ `user_name` –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ, **–∏ SQL-–∏–Ω—ä–µ–∫—Ü–∏—è –±—É–¥–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞**.

---

‚úÖ **2) –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ —Å `quote_ident()`**  
–ï—Å–ª–∏ –≤ SQL-–∑–∞–ø—Ä–æ—Å–µ –Ω—É–∂–Ω–æ –ø–æ–¥—Å—Ç–∞–≤–ª—è—Ç—å **–∏–º—è —Ç–∞–±–ª–∏—Ü—ã –∏–ª–∏ —Å—Ç–æ–ª–±—Ü–∞**, —ç—Ç–æ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å —á–µ—Ä–µ–∑ `quote_ident()`, –∞ –Ω–µ —á–µ—Ä–µ–∑ –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—é.

‚ùå **–ü–ª–æ—Ö–æ (—É—è–∑–≤–∏–º–æ):**

```sql
EXECUTE 'SELECT * FROM ' || table_name;
```

‚úî **–•–æ—Ä–æ—à–æ (–±–µ–∑–æ–ø–∞—Å–Ω–æ):**

```sql
EXECUTE 'SELECT * FROM ' || quote_ident(table_name);
```

üîπ **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç `quote_ident()`?**

- –ï—Å–ª–∏ `table_name = 'users'`, —Ç–æ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è `users`.
- –ï—Å–ª–∏ `table_name = 'users; DROP TABLE users;'`, —Ç–æ —ç—Ç–æ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ –æ—à–∏–±–∫–µ, –Ω–æ SQL-–∏–Ω—ä–µ–∫—Ü–∏—è –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç.

---

‚úÖ **3) –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π —Å `quote_literal()`**  
–ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, **–µ–≥–æ —Ç–æ–∂–µ –Ω—É–∂–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å**, –µ—Å–ª–∏ –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `USING`.

‚ùå **–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ:**

```sql
EXECUTE 'INSERT INTO logs (message) VALUES (' || log_text || ')';
```

‚úî **–ë–µ–∑–æ–ø–∞—Å–Ω–æ:**

```sql
EXECUTE 'INSERT INTO logs (message) VALUES (' || quote_literal(log_text) || ')';
```

üîπ **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `quote_literal()`?**

- –ï—Å–ª–∏ `log_text = 'Hello'`, —Ç–æ SQL-–∑–∞–ø—Ä–æ—Å –æ—Å—Ç–∞–Ω–µ—Ç—Å—è `VALUES ('Hello')`.
- –ï—Å–ª–∏ `log_text = 'Hello'); DROP TABLE logs; --'`, —Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç `VALUES ('Hello''); DROP TABLE logs; --')`, –∏ SQL-–∏–Ω—ä–µ–∫—Ü–∏—è –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç.

---

‚úÖ **4) –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `FORMAT()` –≤–º–µ—Å—Ç–æ –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–∏**  
–§—É–Ω–∫—Ü–∏—è `FORMAT()` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.

‚úî **–ü—Ä–∏–º–µ—Ä –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```sql
EXECUTE FORMAT('SELECT * FROM %I WHERE id = %L', table_name, user_id);
```

–ì–¥–µ:

- `%I` (`quote_ident`) ‚Äî –¥–ª—è –∏–º—ë–Ω —Ç–∞–±–ª–∏—Ü –∏ —Å—Ç–æ–ª–±—Ü–æ–≤.
- `%L` (`quote_literal`) ‚Äî –¥–ª—è —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π.

üîπ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:**

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –Ω–µ–ª—å–∑—è —Å–ª—É—á–∞–π–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∑–∞—â–∏—Ç—É.

---

### **3. –ò—Ç–æ–≥: –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞—â–∏—Ç–∏—Ç—å—Å—è?**

|–ó–∞–¥–∞—á–∞|–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚ùå|–ü—Ä–∞–≤–∏–ª—å–Ω–æ ‚úÖ|
|---|---|---|
|**–ü–µ—Ä–µ–¥–∞—á–∞ –∑–Ω–∞—á–µ–Ω–∏–π –≤ `WHERE`**|–ö–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è —Å—Ç—Ä–æ–∫|`EXECUTE ... USING`|
|**–ü–µ—Ä–µ–¥–∞—á–∞ –∏–º–µ–Ω —Ç–∞–±–ª–∏—Ü/—Å—Ç–æ–ª–±—Ü–æ–≤**|–ü—Ä–æ—Å—Ç–∞—è –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è|`quote_ident()` –∏–ª–∏ `%I` –≤ `FORMAT()`|
|**–ü–µ—Ä–µ–¥–∞—á–∞ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π**|–ü—Ä—è–º–æ–µ –ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ|`quote_literal()` –∏–ª–∏ `%L` –≤ `FORMAT()`|

---

### **–í—ã–≤–æ–¥**

‚ö†Ô∏è **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ—Å—Ç—É—é –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—é —Å—Ç—Ä–æ–∫ –≤ SQL!**  
‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `USING`, `quote_ident()`, `quote_literal()`, `FORMAT()`.  
‚úÖ –≠—Ç–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞—â–∏—Ç–∏—Ç –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π –∏ —Å–¥–µ–ª–∞–µ—Ç –∫–æ–¥ –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º.

---

üëâ **–°–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å: –°–ø–æ—Å–æ–±—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–∞–Ω–¥.** –ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å?