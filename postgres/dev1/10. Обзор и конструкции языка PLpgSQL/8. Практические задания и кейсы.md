# **–ö–æ–Ω—Å–ø–µ–∫—Ç –≤–∏–¥–µ–æ: –ß–∞—Å—Ç—å 7 ‚Äì –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è –∏ –∫–µ–π—Å—ã –≤ PL/pgSQL**

–í —ç—Ç–æ–π —á–∞—Å—Ç–∏ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è **–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è PL/pgSQL**:

1. **–û–±—Ä–µ–∑–∫–∞ –¥–ª–∏–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º `...`**
2. **–û–±—Ä–µ–∑–∫–∞ —Å—Ç—Ä–æ–∫–∏ –ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Å–ª–æ–≤—É –ø–µ—Ä–µ–¥ –ª–∏–º–∏—Ç–æ–º**
3. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –∑–∞–¥–∞–Ω–Ω–æ–π –¥–ª–∏–Ω—ã**
4. **–°–∏–º—É–ª—è—Ü–∏—è –∏–≥—Ä—ã ¬´–ù–∞–ø–µ—Ä—Å—Ç–∫–∏¬ª (–∞–Ω–∞–ª–∏–∑ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π)**

---

## **7.1. –û–±—Ä–µ–∑–∫–∞ —Å—Ç—Ä–æ–∫–∏ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º `...`**

### **–ó–∞–¥–∞—á–∞:**

–ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –¥–ª–∏–Ω–Ω–µ–µ 45 —Å–∏–º–≤–æ–ª–æ–≤, **–æ–±—Ä–µ–∑–∞—Ç—å –µ–µ** –∏ –¥–æ–±–∞–≤–∏—Ç—å `...` –≤ –∫–æ–Ω—Ü–µ.

### **–†–µ—à–µ–Ω–∏–µ:**

```sql
CREATE FUNCTION truncate_text(input_text TEXT, max_length INTEGER)
RETURNS TEXT AS $$
BEGIN
  -- –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –∫–æ—Ä–æ—á–µ –ª–∏–º–∏—Ç–∞, –ø—Ä–æ—Å—Ç–æ –≤–µ—Ä–Ω—É—Ç—å –µ–µ
  IF length(input_text) <= max_length THEN
    RETURN input_text;
  END IF;

  -- –û–±—Ä–µ–∑–∞—Ç—å —Å—Ç—Ä–æ–∫—É –∏ –¥–æ–±–∞–≤–∏—Ç—å "..."
  RETURN substring(input_text FROM 1 FOR max_length - 3) || '...';
END $$ LANGUAGE plpgsql;
```

### **–¢–µ—Å—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é:**

```sql
SELECT truncate_text('–û—á–µ–Ω—å –¥–ª–∏–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏, –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è', 45);
```

‚úÖ **–í—ã—Ö–æ–¥:**

```
–û—á–µ–Ω—å –¥–ª–∏–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏, –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ –ø–æ–º–µ...
```

üöÄ **–í—ã–≤–æ–¥:**  
–§—É–Ω–∫—Ü–∏—è **–ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–ª–∏–Ω—É —Å—Ç—Ä–æ–∫–∏** –∏ **–æ–±—Ä–µ–∑–∞–µ—Ç –µ–µ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ**.

---

## **7.2. –û–±—Ä–µ–∑–∫–∞ —Å—Ç—Ä–æ–∫–∏ –ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Å–ª–æ–≤—É –ø–µ—Ä–µ–¥ –ª–∏–º–∏—Ç–æ–º**

### **–ó–∞–¥–∞—á–∞:**

–ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –¥–ª–∏–Ω–Ω–µ–µ 45 —Å–∏–º–≤–æ–ª–æ–≤, **–æ–±—Ä–µ–∑–∞—Ç—å –µ–µ –ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –ø–æ–ª–Ω–æ–º—É —Å–ª–æ–≤—É** –∏ –¥–æ–±–∞–≤–∏—Ç—å `...`.

### **–†–µ—à–µ–Ω–∏–µ:**

```sql
CREATE FUNCTION smart_truncate_text(input_text TEXT, max_length INTEGER)
RETURNS TEXT AS $$
DECLARE
  truncated TEXT;
BEGIN
  -- –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –∫–æ—Ä–æ—á–µ –ª–∏–º–∏—Ç–∞, –ø—Ä–æ—Å—Ç–æ –≤–µ—Ä–Ω—É—Ç—å –µ–µ
  IF length(input_text) <= max_length THEN
    RETURN input_text;
  END IF;

  -- –ù–∞–π—Ç–∏ –±–ª–∏–∂–∞–π—à–∏–π –ø—Ä–æ–±–µ–ª –ø–µ—Ä–µ–¥ max_length –∏ –æ–±—Ä–µ–∑–∞—Ç—å —Å—Ç—Ä–æ–∫—É
  truncated := substring(input_text FROM 1 FOR max_length);
  truncated := substring(truncated FROM 1 FOR length(truncated) - position(' ' IN reverse(truncated)));

  RETURN truncated || '...';
END $$ LANGUAGE plpgsql;
```

### **–¢–µ—Å—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é:**

```sql
SELECT smart_truncate_text('–û—á–µ–Ω—å –¥–ª–∏–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏, –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è', 45);
```

‚úÖ **–í—ã—Ö–æ–¥:**

```
–û—á–µ–Ω—å –¥–ª–∏–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏, –∫–æ—Ç–æ—Ä–æ–µ...
```

üöÄ **–í—ã–≤–æ–¥:**  
–§—É–Ω–∫—Ü–∏—è **–Ω–µ —Ä–∞–∑—Ä–µ–∑–∞–µ—Ç —Å–ª–æ–≤–æ –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ**, –∞ **–∏—â–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø—Ä–æ–±–µ–ª –ø–µ—Ä–µ–¥ –ª–∏–º–∏—Ç–æ–º**.

---

## **7.3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –∑–∞–¥–∞–Ω–Ω–æ–π –¥–ª–∏–Ω—ã**

### **–ó–∞–¥–∞—á–∞:**

–°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è **–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫—É** –¥–ª–∏–Ω—ã `n`, —Å–æ—Å—Ç–æ—è—â—É—é –∏–∑ —Å–ª—É—á–∞–π–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤.

### **–†–µ—à–µ–Ω–∏–µ:**

```sql
CREATE FUNCTION generate_random_string(length INTEGER)
RETURNS TEXT AS $$
DECLARE
  chars TEXT := 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
  result TEXT := '';
  i INTEGER;
BEGIN
  FOR i IN 1..length LOOP
    result := result || substring(chars FROM floor(random() * length(chars) + 1) FOR 1);
  END LOOP;
  
  RETURN result;
END $$ LANGUAGE plpgsql;
```

### **–¢–µ—Å—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é:**

```sql
SELECT generate_random_string(10);
```

‚úÖ **–í—ã—Ö–æ–¥ (–ø—Ä–∏–º–µ—Ä):**

```
A1bC9xZ0kQ
```

üöÄ **–í—ã–≤–æ–¥:**  
–§—É–Ω–∫—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **`random()`** –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–ª—É—á–∞–π–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ –∏ **–∫–æ–Ω—Å—Ç—Ä—É–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫—É**.

---

## **7.4. –°–∏–º—É–ª—è—Ü–∏—è –∏–≥—Ä—ã ¬´–ù–∞–ø–µ—Ä—Å—Ç–∫–∏¬ª (–∞–Ω–∞–ª–∏–∑ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π)**

### **–û–ø–∏—Å–∞–Ω–∏–µ –∏–≥—Ä—ã:**

1. –ï—Å—Ç—å **3 –Ω–∞–ø–µ—Ä—Å—Ç–∫–∞**, –ø–æ–¥ –æ–¥–Ω–∏–º –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —à–∞—Ä–∏–∫.
2. –ò–≥—Ä–æ–∫ **–≤—ã–±–∏—Ä–∞–µ—Ç –æ–¥–∏–Ω** –∏–∑ –Ω–∞–ø–µ—Ä—Å—Ç–∫–æ–≤.
3. –í–µ–¥—É—â–∏–π **–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –æ–¥–∏–Ω –ø—É—Å—Ç–æ–π –Ω–∞–ø–µ—Ä—Å—Ç–æ–∫** –∏–∑ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –¥–≤—É—Ö.
4. –ò–≥—Ä–æ–∫—É –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç **—Å–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä** –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å —Å–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç.
5. –ù—É–∂–Ω–æ –≤—ã—è—Å–Ω–∏—Ç—å: **–∫–∞–∫–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–∞–µ—Ç –ª—É—á—à–∏–π —à–∞–Ω—Å –Ω–∞ –≤—ã–∏–≥—Ä—ã—à**.

---

### **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏–º—É–ª—è—Ü–∏–∏**

6. –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É **1000 —Ä–∞–∑**.
7. –°—á–∏—Ç–∞–µ–º **–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∏–≥—Ä—ã—à–µ–π**, –µ—Å–ª–∏ **–∏–≥—Ä–æ–∫ –º–µ–Ω—è–µ—Ç –≤—ã–±–æ—Ä**.
8. –°—á–∏—Ç–∞–µ–º **–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∏–≥—Ä—ã—à–µ–π**, –µ—Å–ª–∏ **–∏–≥—Ä–æ–∫ –æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–≤–æ–µ–º –≤—ã–±–æ—Ä–µ**.
9. –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

### **–†–µ—à–µ–Ω–∏–µ:**

```sql
CREATE FUNCTION monty_hall_simulation(trials INTEGER)
RETURNS TABLE (switch_wins INTEGER, stay_wins INTEGER) AS $$
DECLARE
  i INTEGER;
  correct_door INTEGER;
  chosen_door INTEGER;
  revealed_door INTEGER;
  final_choice INTEGER;
  switch_wins INTEGER := 0;
  stay_wins INTEGER := 0;
BEGIN
  FOR i IN 1..trials LOOP
    -- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –Ω–∞–ø–µ—Ä—Å—Ç–æ–∫ (1, 2 –∏–ª–∏ 3)
    correct_door := floor(random() * 3 + 1);

    -- –ò–≥—Ä–æ–∫ –≤—ã–±–∏—Ä–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π –Ω–∞–ø–µ—Ä—Å—Ç–æ–∫
    chosen_door := floor(random() * 3 + 1);

    -- –í–µ–¥—É—â–∏–π –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –æ–¥–∏–Ω –∏–∑ –ø—É—Å—Ç—ã—Ö –Ω–∞–ø–µ—Ä—Å—Ç–∫–æ–≤
    FOR revealed_door IN 1..3 LOOP
      IF revealed_door != chosen_door AND revealed_door != correct_door THEN
        EXIT;
      END IF;
    END LOOP;

    -- –ò–≥—Ä–æ–∫ –º–µ–Ω—è–µ—Ç –≤—ã–±–æ—Ä (–≤—ã–±–∏—Ä–∞–µ—Ç –æ—Å—Ç–∞–≤—à–∏–π—Å—è –Ω–∞–ø–µ—Ä—Å—Ç–æ–∫)
    FOR final_choice IN 1..3 LOOP
      IF final_choice != chosen_door AND final_choice != revealed_door THEN
        EXIT;
      END IF;
    END LOOP;

    -- –ü–æ–¥—Å—á–µ—Ç –ø–æ–±–µ–¥ –ø—Ä–∏ —Å–º–µ–Ω–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤—ã–±–æ—Ä–∞
    IF final_choice = correct_door THEN
      switch_wins := switch_wins + 1;
    END IF;
    
    IF chosen_door = correct_door THEN
      stay_wins := stay_wins + 1;
    END IF;
  END LOOP;

  RETURN QUERY SELECT switch_wins, stay_wins;
END $$ LANGUAGE plpgsql;
```

### **–ó–∞–ø—É—Å–∫–∞–µ–º —Å–∏–º—É–ª—è—Ü–∏—é 1000 —Ä–∞–∑:**

```sql
SELECT * FROM monty_hall_simulation(1000);
```

‚úÖ **–ü—Ä–∏–º–µ—Ä–Ω—ã–π –≤—ã—Ö–æ–¥ (–º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è):**

```
switch_wins | stay_wins
------------+-----------
       665  |    335
```

‚úÖ **–í—ã–≤–æ–¥:**

- –ï—Å–ª–∏ **–∏–≥—Ä–æ–∫ –º–µ–Ω—è–µ—Ç –≤—ã–±–æ—Ä** ‚Äì –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ–±–µ–¥—ã **~66%**.
- –ï—Å–ª–∏ **–∏–≥—Ä–æ–∫ –æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–≤–æ–µ–º –≤—ã–±–æ—Ä–µ** ‚Äì –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ–±–µ–¥—ã **~33%**.
- **–õ—É—á—à–µ –º–µ–Ω—è—Ç—å –≤—ã–±–æ—Ä!** üéØ

---

## **–í—ã–≤–æ–¥ –ø–æ —á–∞—Å—Ç–∏ 7**

- **–û–±—Ä–µ–∑–∫–∞ —Å—Ç—Ä–æ–∫ (`truncate_text`)** –ø–æ–∑–≤–æ–ª—è–µ—Ç **—Å–æ–∫—Ä–∞—â–∞—Ç—å —Ç–µ–∫—Å—Ç –∏ –¥–æ–±–∞–≤–ª—è—Ç—å `...`**.
- **–û–±—Ä–µ–∑–∫–∞ –ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Å–ª–æ–≤—É (`smart_truncate_text`)** –Ω–µ –æ–±—Ä—ã–≤–∞–µ—Ç —Å–ª–æ–≤–∞ –ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ.
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ (`generate_random_string`)** —É–¥–æ–±–Ω–∞ –¥–ª—è –ø–∞—Ä–æ–ª–µ–π.
- **–°–∏–º—É–ª—è—Ü–∏—è –∏–≥—Ä—ã ¬´–ù–∞–ø–µ—Ä—Å—Ç–∫–∏¬ª (`monty_hall_simulation`)** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ **–ª—É—á—à–µ –º–µ–Ω—è—Ç—å –≤—ã–±–æ—Ä**.

---

‚è≠ **–§–∏–Ω–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å** ‚Äì **–ó–∞–∫–ª—é—á–µ–Ω–∏–µ –∏ –∏—Ç–æ–≥–∏ –∏–∑—É—á–µ–Ω–∏—è PL/pgSQL**. –ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å? üöÄ