### **–ß–∞—Å—Ç—å 2: –ö–æ–º–∞–Ω–¥–∞ `ASSERT` –∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞**

---

## **2.1 –ß—Ç–æ —Ç–∞–∫–æ–µ `ASSERT`?**

`ASSERT` ‚Äî —ç—Ç–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –≤ PL/pgSQL, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–∞—è –¥–ª—è **–ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –ª–æ–≥–∏–∫–∏ –≤ –∫–æ–¥–µ**.

üìå **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `ASSERT`?**

- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ª–æ–≤–∏–µ **–≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**.
- –ï—Å–ª–∏ —É—Å–ª–æ–≤–∏–µ –ª–æ–∂–Ω–æ (`FALSE`), –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è –∏ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è **–æ—à–∏–±–∫–∞ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º**.
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è **–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π** –µ—â–µ –Ω–∞ —ç—Ç–∞–ø–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

üìå **–ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è?**  
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ **–≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö –∏ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞—Ö.  
‚úÖ –£–±–µ–∂–¥–µ–Ω–∏–µ, —á—Ç–æ **–∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –¥–æ–ø—É—Å—Ç–∏–º–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ**.  
‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å **–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏–π).

---

## **2.2 –°–∏–Ω—Ç–∞–∫—Å–∏—Å `ASSERT`**

```sql
ASSERT <—É—Å–ª–æ–≤–∏–µ>, '<—Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏>';
```

üìå **–ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**

```sql
CREATE OR REPLACE FUNCTION get_entrance(
    num_floors INT,   -- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç—Ç–∞–∂–µ–π
    apartments_per_floor INT,  -- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–≤–∞—Ä—Ç–∏—Ä –Ω–∞ —ç—Ç–∞–∂–µ
    apartment_number INT  -- –ù–æ–º–µ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã
) RETURNS INT AS $$
BEGIN
    -- –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã –±–æ–ª—å—à–µ 0
    ASSERT apartment_number > 0, '–û—à–∏–±–∫–∞: –Ω–æ–º–µ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å 0 –∏–ª–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º';
    
    -- –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç—Ç–∞–∂–µ–π –∏ –∫–≤–∞—Ä—Ç–∏—Ä –Ω–∞ —ç—Ç–∞–∂–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ
    ASSERT num_floors > 0, '–û—à–∏–±–∫–∞: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç—Ç–∞–∂–µ–π –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º';
    ASSERT apartments_per_floor > 0, '–û—à–∏–±–∫–∞: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–≤–∞—Ä—Ç–∏—Ä –Ω–∞ —ç—Ç–∞–∂–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º';

    -- –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ–¥—ä–µ–∑–¥–∞
    RETURN ((apartment_number - 1) / (num_floors * apartments_per_floor)) + 1;
END;
$$ LANGUAGE plpgsql;
```

‚úÖ –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞—Ç—å **–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã**, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ **–ø—Ä–µ—Ä–≤–µ—Ç—Å—è** —Å –æ—à–∏–±–∫–æ–π:

```
ERROR:  Assertion failed: –û—à–∏–±–∫–∞: –Ω–æ–º–µ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å 0 –∏–ª–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º
```

üìå **–ü—Ä–∏–º–µ—Ä 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**

```sql
DECLARE total_sales NUMERIC := 1000;
DECLARE discount NUMERIC := 1200;

ASSERT total_sales >= discount, '–û—à–∏–±–∫–∞: —Å–∫–∏–¥–∫–∞ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å —Å—É–º–º—É –ø—Ä–æ–¥–∞–∂–∏';
```

üõë **–ï—Å–ª–∏ `discount` –±–æ–ª—å—à–µ `total_sales`, –≤—ã–±—Ä–æ—Å–∏—Ç—Å—è –æ—à–∏–±–∫–∞.**

---

## **2.3 –ö–æ–≥–¥–∞ `ASSERT` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç?**

üî∏ `ASSERT` —Ä–∞–±–æ—Ç–∞–µ—Ç **—Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏**.  
üî∏ –û–Ω **–æ—Ç–∫–ª—é—á–µ–Ω –≤ production –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** (–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `debug_assertions = off`).  
üî∏ –ß—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å `ASSERT`, –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:

```sql
SET debug_assertions = on;
```

üî∏ **–†–µ—à–µ–Ω–∏–µ –¥–ª—è production:** –í–º–µ—Å—Ç–æ `ASSERT` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **—è–≤–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Å `RAISE EXCEPTION`**:

```sql
IF total_sales < discount THEN
    RAISE EXCEPTION '–û—à–∏–±–∫–∞: —Å–∫–∏–¥–∫–∞ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å —Å—É–º–º—É –ø—Ä–æ–¥–∞–∂–∏';
END IF;
```

---

## **2.4 –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏**

### **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `EXTRA_CHECKS` –∏ `EXTRA_ERRORS`**

- PostgreSQL –∏–º–µ–µ—Ç **–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** –∫–æ–Ω—Ç—Ä–æ–ª—è –æ—à–∏–±–æ–∫.
- –û–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç **–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—Ç—å –∏–ª–∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö**.

üìå **–ü—Ä–∏–º–µ—Ä 1: `EXTRA_CHECKS = on`**

```sql
SET extra_checks = on;
```

**–ß—Ç–æ —ç—Ç–æ –¥–∞–µ—Ç?**

- –°–µ—Ä–≤–µ—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç **—Å—Ç—Ä–æ–∂–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç–∏–ø–æ–≤**.
- –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫ –≤ —Å–ª–æ–∂–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏—è—Ö.

üìå **–ü—Ä–∏–º–µ—Ä 2: `EXTRA_ERRORS = on`**

```sql
SET extra_errors = on;
```

**–ß—Ç–æ —ç—Ç–æ –¥–∞–µ—Ç?**

- –ü–æ–∑–≤–æ–ª—è–µ—Ç **–ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**.
- –ù–∞–ø—Ä–∏–º–µ—Ä, **–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å** –∏–ª–∏ **–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ NULL —Ç–∞–º, –≥–¥–µ –µ–≥–æ –±—ã—Ç—å –Ω–µ –¥–æ–ª–∂–Ω–æ**.

---

## **2.5 –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π (`plpgsql_check`)**

–ï—Å–ª–∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ **–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã**, –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å **—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ `plpgsql_check`**.

### **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç `plpgsql_check`?**

‚úÖ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç PL/pgSQL-–∫–æ–¥ **–¥–æ –µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**.  
‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç **–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏** –∏ **–ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è** –≤ –∫–æ–¥–µ.  
‚úÖ –í—ã—è–≤–ª—è–µ—Ç **–ø—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é**.

üìå **–ö–∞–∫ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å?**

```sql
CREATE EXTENSION plpgsql_check;
```

üìå **–ü—Ä–∏–º–µ—Ä: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ –æ—à–∏–±–∫–∏**

```sql
SELECT plpgsql_check_function('get_entrance');
```

–ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω—ã –æ—à–∏–±–∫–∏, –æ–Ω–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å **–¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞**.

---

## **2.6 –ò—Ç–æ–≥**

- **`ASSERT`** –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –∏ –ª–æ–≥–∏–∫–∏ –≤–æ –≤—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.
- –û–Ω **—Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏**, –∞ –≤ production **–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç–∫–ª—é—á–µ–Ω**.
- –í production –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **`RAISE EXCEPTION`** –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫.
- **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (`EXTRA_CHECKS`, `EXTRA_ERRORS`)** –ø–æ–º–æ–≥–∞—é—Ç –≤—ã—è–≤–ª—è—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã.
- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ **`plpgsql_check`** –º–æ–∂–µ—Ç –ø—Ä–æ–≤–æ–¥–∏—Ç—å **–∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ –¥–æ –µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**.

---

üîú **–°–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å: –û—Ç–ª–∞–¥—á–∏–∫ `pldbgapi` –∏ –ø–æ—à–∞–≥–æ–≤—ã–π —Ä–∞–∑–±–æ—Ä –∫–æ–¥–∞ –≤ PostgreSQL.**

–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∏–ª–∏ –µ—Å—Ç—å –ø—Ä–∞–≤–∫–∏? üòä