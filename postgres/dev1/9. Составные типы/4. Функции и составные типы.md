### üîπ **–ü–µ—Ä–µ—Å–∫–∞–∑ —á–µ—Ç–≤—ë—Ä—Ç–æ–π –ª–æ–≥–∏—á–µ—Å–∫–æ–π —á–∞—Å—Ç–∏: –§—É–Ω–∫—Ü–∏–∏ –∏ —Å–æ—Å—Ç–∞–≤–Ω—ã–µ —Ç–∏–ø—ã** üîπ

---

### **1. –ü–µ—Ä–µ–¥–∞—á–∞ —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö —Ç–∏–ø–æ–≤ –≤ —Ñ—É–Ω–∫—Ü–∏–∏**

üìå **–§—É–Ω–∫—Ü–∏–∏ –≤ PostgreSQL –º–æ–≥—É—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Å–æ—Å—Ç–∞–≤–Ω—ã–µ —Ç–∏–ø—ã –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤.**  
üìå **–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Ü–µ–ª—ã–µ —Å—Ç—Ä–æ–∫–∏ —Ç–∞–±–ª–∏—Ü—ã –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ç–∏–ø—ã –≤ —Ñ—É–Ω–∫—Ü–∏—é.**

‚úÖ **–ü—Ä–∏–º–µ—Ä —Ñ—É–Ω–∫—Ü–∏–∏, –ø—Ä–∏–Ω–∏–º–∞—é—â–µ–π —Å–æ—Å—Ç–∞–≤–Ω–æ–π —Ç–∏–ø `currency`**:

```sql
CREATE FUNCTION get_currency_amount(curr currency)  
RETURNS NUMERIC AS $$  
BEGIN  
    RETURN curr.amount;  
END;  
$$ LANGUAGE plpgsql;
```

üîπ **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?**

- –§—É–Ω–∫—Ü–∏—è `get_currency_amount` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç `curr` **—Ç–∏–ø–∞ `currency`**.
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç** —Ç–æ–ª—å–∫–æ –ø–æ–ª–µ `amount`.

‚úÖ **–í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏**:

```sql
SELECT get_currency_amount(('100.50', 'USD')::currency);
```

–†–µ–∑—É–ª—å—Ç–∞—Ç:

```
100.50
```

üìå **–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Å–æ—Å—Ç–∞–≤–Ω—ã–µ —Ç–∏–ø—ã –≤ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∏—Ö –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏.**

---

### **2. –í–∑–∞–∏–º–æ–∑–∞–º–µ–Ω—è–µ–º—ã–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—ã –¥–æ—Å—Ç—É–ø–∞ –∫ –∞—Ç—Ä–∏–±—É—Ç–∞–º**

üìå **PostgreSQL –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–æ–ª—è–º —Å–æ—Å—Ç–∞–≤–Ω–æ–≥–æ —Ç–∏–ø–∞ –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö:**  
1Ô∏è‚É£ **–¢–æ—á–µ—á–Ω–∞—è –Ω–æ—Ç–∞—Ü–∏—è** (`composite_field.attribute`)  
2Ô∏è‚É£ **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞** (`attribute(composite_field)`)

‚úÖ **–ü—Ä–∏–º–µ—Ä**:

```sql
SELECT transaction_amount.amount FROM transactions;
```

–ê–Ω–∞–ª–æ–≥:

```sql
SELECT amount(transaction_amount) FROM transactions;
```

üìå **–ö–æ–≥–¥–∞ —ç—Ç–æ –ø–æ–ª–µ–∑–Ω–æ?**

- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å —É–¥–æ–±–µ–Ω –≤ SQL-—Ñ—É–Ω–∫—Ü–∏—è—Ö**.
- **–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏, –∏–º–∏—Ç–∏—Ä—É—é—â–∏–µ —Å—Ç–æ–ª–±—Ü—ã –≤ —Ç–∞–±–ª–∏—Ü–µ**.

‚úÖ **–ü—Ä–∏–º–µ—Ä —Ñ—É–Ω–∫—Ü–∏–∏, —Ä–∞–±–æ—Ç–∞—é—â–µ–π –∫–∞–∫ —Å—Ç–æ–ª–±–µ—Ü**:

```sql
CREATE FUNCTION seat_number(seat seats) RETURNS INT AS $$  
BEGIN  
    RETURN seat.seat_number;  
END;  
$$ LANGUAGE plpgsql;
```

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –µ—ë —Ç–∞–∫:

```sql
SELECT seat_number(seats.*) FROM seats;
```

–†–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫ –∂–µ, –∫–∞–∫ `seats.seat_number`.

---

### **3. –§—É–Ω–∫—Ü–∏–∏, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–µ —Å–æ—Å—Ç–∞–≤–Ω—ã–µ —Ç–∏–ø—ã**

üìå **–§—É–Ω–∫—Ü–∏–∏ –º–æ–≥—É—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Å–æ—Å—Ç–∞–≤–Ω—ã–µ —Ç–∏–ø—ã** (–∫–∞–∫ —Å—Ç—Ä–æ–∫–∏ —Ç–∞–±–ª–∏—Ü—ã).

‚úÖ **–ü—Ä–∏–º–µ—Ä —Ñ—É–Ω–∫—Ü–∏–∏, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–µ–π `currency`**:

```sql
CREATE FUNCTION make_currency(amount NUMERIC, code TEXT)  
RETURNS currency AS $$  
BEGIN  
    RETURN ROW(amount, code)::currency;  
END;  
$$ LANGUAGE plpgsql;
```

‚úÖ **–í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏**:

```sql
SELECT make_currency(250.00, 'USD');
```

–†–µ–∑—É–ª—å—Ç–∞—Ç:

```
(250.00, USD)
```

üìå **–ú–æ–∂–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Å–æ—Å—Ç–∞–≤–Ω—ã–µ —Ç–∏–ø—ã, –Ω–µ —Å–æ–∑–¥–∞–≤–∞—è `CREATE TYPE`**, –∏—Å–ø–æ–ª—å–∑—É—è `RETURNS RECORD`.

‚úÖ **–ü—Ä–∏–º–µ—Ä**:

```sql
CREATE FUNCTION get_transaction_details(acc TEXT)  
RETURNS RECORD AS $$  
DECLARE  
    result RECORD;  
BEGIN  
    SELECT * INTO result FROM transactions WHERE account_number = acc;  
    RETURN result;  
END;  
$$ LANGUAGE plpgsql;
```

üìå **–ù–æ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–æ–ª–±—Ü—ã!**

```sql
SELECT * FROM get_transaction_details('12345') AS (account_number TEXT, transaction_amount currency);
```

---

### **4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `RETURNS TABLE` –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π**

üìå **–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `RETURNS TABLE`, —á—Ç–æ–±—ã —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–ª–∞ —Ç–∞–±–ª–∏—Ü—É.**

‚úÖ **–ü—Ä–∏–º–µ—Ä**:

```sql
CREATE FUNCTION get_transactions(account TEXT)  
RETURNS TABLE(id SERIAL, amount NUMERIC, currency_code TEXT) AS $$  
BEGIN  
    RETURN QUERY  
    SELECT t.id, t.transaction_amount.amount, t.transaction_amount.currency_code  
    FROM transactions t  
    WHERE t.account_number = account;  
END;  
$$ LANGUAGE plpgsql;
```

‚úÖ **–í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏**:

```sql
SELECT * FROM get_transactions('12345');
```

üìå **–§—É–Ω–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç, –∫–∞–∫ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º**.

---

### **5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö —Ç–∏–ø–æ–≤ –≤ `FROM`**

üìå **–§—É–Ω–∫—Ü–∏–∏, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–µ —Å–æ—Å—Ç–∞–≤–Ω—ã–µ —Ç–∏–ø—ã, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ `FROM`.**

‚úÖ **–ü—Ä–∏–º–µ—Ä**:

```sql
SELECT * FROM make_currency(500, 'EUR') AS c(amount NUMERIC, currency_code TEXT);
```

üìå **–ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `RECORD`, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–æ–ª–±—Ü—ã —è–≤–Ω–æ!**

‚úÖ **–ü—Ä–∏–º–µ—Ä `RECORD`-—Ñ—É–Ω–∫—Ü–∏–∏ –≤ `FROM`**:

```sql
SELECT * FROM get_transaction_details('12345') AS (account_number TEXT, transaction_amount currency);
```

---

### **6. –§—É–Ω–∫—Ü–∏–∏, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ (—Ç–∞–±–ª–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏)**

üìå **–ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `RETURNS SETOF`**.

‚úÖ **–ü—Ä–∏–º–µ—Ä**:

```sql
CREATE FUNCTION get_all_transactions()  
RETURNS SETOF transactions AS $$  
BEGIN  
    RETURN QUERY SELECT * FROM transactions;  
END;  
$$ LANGUAGE plpgsql;
```

‚úÖ **–í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏**:

```sql
SELECT * FROM get_all_transactions();
```

üìå **–§—É–Ω–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ç–∞–±–ª–∏—Ü–∞ –≤ `FROM`**.

---

### **7. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Å —Ç–∞–±–ª–∏—á–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏**

üìå **PostgreSQL –º–æ–∂–µ—Ç —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å —Ç–∞–±–ª–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–∞—Ö, —á—Ç–æ –ø–æ–≤—ã—à–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.**  
üìå **–ù–æ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, –µ—Å–ª–∏:**

- –§—É–Ω–∫—Ü–∏—è **—Å—Ç–∞–±–∏–ª—å–Ω–∞—è** (`STABLE` –∏–ª–∏ `IMMUTABLE`).
- –§—É–Ω–∫—Ü–∏—è **–Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ**.
- –§—É–Ω–∫—Ü–∏—è **–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `STRICT`**.

‚úÖ **–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –ª–∏ PostgreSQL —Ñ—É–Ω–∫—Ü–∏—é –≤ –∑–∞–ø—Ä–æ—Å?**

```sql
EXPLAIN ANALYZE SELECT * FROM get_all_transactions() WHERE transaction_amount.amount > 100;
```

–ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è **—Ä–∞–∑–≤–µ—Ä–Ω—É–ª–∞—Å—å –≤ `SELECT`**, –∑–Ω–∞—á–∏—Ç, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç.

‚úÖ **–ö–∞–∫ —É–ª—É—á—à–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å?**  
1Ô∏è‚É£ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `IMMUTABLE` –≤–º–µ—Å—Ç–æ `VOLATILE`.

```sql
CREATE FUNCTION get_currency_amount(curr currency) RETURNS NUMERIC  
IMMUTABLE AS $$  
BEGIN  
    RETURN curr.amount;  
END;  
$$ LANGUAGE plpgsql;
```

2Ô∏è‚É£ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (`VIEW`) –≤–º–µ—Å—Ç–æ —Ñ—É–Ω–∫—Ü–∏–π, –µ—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ –Ω—É–∂–Ω—ã**.

---

### **8. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ –ø–æ —á–µ—Ç–≤—ë—Ä—Ç–æ–π —á–∞—Å—Ç–∏**

üìå **–û—Å–Ω–æ–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã:**

1. **–§—É–Ω–∫—Ü–∏–∏ –º–æ–≥—É—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Å–æ—Å—Ç–∞–≤–Ω—ã–µ —Ç–∏–ø—ã** –∏ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∏—Ö –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏.
2. **–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–µ —Å–æ—Å—Ç–∞–≤–Ω—ã–µ —Ç–∏–ø—ã (`RETURNS composite_type`)**.
3. **–§—É–Ω–∫—Ü–∏–∏ –º–æ–≥—É—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã** (`RETURNS TABLE` –∏–ª–∏ `RETURNS SETOF`).
4. **–§—É–Ω–∫—Ü–∏–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ `SELECT` –∏ `FROM`** (–∫–∞–∫ –æ–±—ã—á–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã –∏ —Ç–∞–±–ª–∏—Ü—ã).
5. **–¢–∞–±–ª–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –µ—Å–ª–∏ PostgreSQL –∏—Ö —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –≤ –∑–∞–ø—Ä–æ—Å—ã**.

---

üîπ **–ß—Ç–æ –¥–∞–ª—å—à–µ?**  
–°–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å –±—É–¥–µ—Ç –ø–æ—Å–≤—è—â–µ–Ω–∞ **—Ñ—É–Ω–∫—Ü–∏—è–º, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–º —Ç–∞–±–ª–∏—Ü—ã, –∏ –∏—Ö –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–º—É –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é**. üöÄ

–ó–∞–ø—Ä–æ—Å–∏ **—Å–ª–µ–¥—É—é—â—É—é —á–∞—Å—Ç—å**, –∏ —è –ø—Ä–æ–¥–æ–ª–∂—É! üòä