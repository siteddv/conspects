### –ü–æ–¥—Ä–æ–±–Ω—ã–π –∫–æ–Ω—Å–ø–µ–∫—Ç –ø–æ –∫—É—Ä—Å–æ—Ä–∞–º –≤ PL/pgSQL

–ö—É—Ä—Å–æ—Ä—ã ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤ PL/pgSQL, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç—Ä–æ—á–Ω–æ. –û–Ω–∏ –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω—ã –≤ —Å–∏—Ç—É–∞—Ü–∏—è—Ö, –∫–æ–≥–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏. –î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º –≤—Å–µ –∞—Å–ø–µ–∫—Ç—ã —Ä–∞–±–æ—Ç—ã —Å –∫—É—Ä—Å–æ—Ä–∞–º–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ.

---

### **1. –ß—Ç–æ —Ç–∞–∫–æ–µ –∫—É—Ä—Å–æ—Ä—ã –∏ –∑–∞—á–µ–º –æ–Ω–∏ –Ω—É–∂–Ω—ã?**

–ö—É—Ä—Å–æ—Ä—ã –≤ PL/pgSQL ‚Äî —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å—Ç—Ä–æ–∫–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ SQL-–∑–∞–ø—Ä–æ—Å–æ–º. –í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤–µ—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ —Å—Ä–∞–∑—É, –∫—É—Ä—Å–æ—Ä –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ –∑–∞ —Ä–∞–∑. –≠—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω–æ, –∫–æ–≥–¥–∞:

- –ù—É–∂–Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –±–æ–ª—å—à–æ–π –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —á–∞—Å—Ç–∏.
- –¢—Ä–µ–±—É–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏, –∫–æ—Ç–æ—Ä—É—é —Å–ª–æ–∂–Ω–æ –≤—ã—Ä–∞–∑–∏—Ç—å –≤ –æ–¥–Ω–æ–º SQL-–∑–∞–ø—Ä–æ—Å–µ.
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–¥–∞—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∫–æ–π –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é.

–ö—É—Ä—Å–æ—Ä—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –∏—Ö —É–¥–æ–±–Ω—ã–º–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö –∏ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞—Ö. –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–ª–∏ —Å–ª–æ–∂–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã, –∫—É—Ä—Å–æ—Ä—ã –º–æ–≥—É—Ç —Å—Ç–∞—Ç—å –Ω–µ–∑–∞–º–µ–Ω–∏–º—ã–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º.

–û–¥–Ω–∞–∫–æ –≤–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å, —á—Ç–æ –∫—É—Ä—Å–æ—Ä—ã –Ω–µ –≤—Å–µ–≥–¥–∞ —è–≤–ª—è—é—Ç—Å—è –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º —Ä–µ—à–µ–Ω–∏–µ–º. –û–Ω–∏ —Ç—Ä–µ–±—É—é—Ç –±–æ–ª—å—à–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ –º–æ–≥—É—Ç –∑–∞–º–µ–¥–ª–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –Ω–µ–æ–±–¥—É–º–∞–Ω–Ω–æ. –ü–æ—ç—Ç–æ–º—É –∏—Ö —Å—Ç–æ–∏—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ –≤ –æ–ø—Ä–∞–≤–¥–∞–Ω–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö.

---

### **2. –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—É—Ä—Å–æ—Ä—ã, –∞ –∫–æ–≥–¥–∞ –∏–∑–±–µ–≥–∞—Ç—å?**

–ö—É—Ä—Å–æ—Ä—ã –ø–æ–ª–µ–∑–Ω—ã –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Å–ª—É—á–∞—è—Ö:

1. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö**:
   - –ï—Å–ª–∏ –≤—ã–±–æ—Ä–∫–∞ —Å–ª–∏—à–∫–æ–º –≤–µ–ª–∏–∫–∞, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å –µ—ë –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤ –ø–∞–º—è—Ç—å, –∫—É—Ä—Å–æ—Ä –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö.
   - –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –º–∏–ª–ª–∏–æ–Ω—ã –∑–∞–ø–∏—Å–µ–π, –∫—É—Ä—Å–æ—Ä –ø–æ–º–æ–∂–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è –ø–∞–º—è—Ç–∏.

2. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π**:
   - –ö—É—Ä—Å–æ—Ä—ã –ø–æ–∑–≤–æ–ª—è—é—Ç –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥ –ø–æ –∫–∞–∫–æ–º—É-–ª–∏–±–æ —É—Å–ª–æ–≤–∏—é, –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—è –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å—Ä–∞–∑—É.

3. **–ü–µ—Ä–µ–¥–∞—á–∞ –≤—ã–±–æ—Ä–∫–∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é**:
   - –ö—É—Ä—Å–æ—Ä –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –ø–µ—Ä–µ–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—É, —á—Ç–æ–±—ã –æ–Ω –≤—ã–ø–æ–ª–Ω—è–ª –ø–æ—Å—Ç—Ä–æ—á–Ω—É—é –≤—ã–±–æ—Ä–∫—É –¥–∞–Ω–Ω—ã—Ö.

4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä–∞—Ö**:
   - –ï—Å–ª–∏ –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç—Ä–µ–±—É–µ—Ç –ø–æ—à–∞–≥–æ–≤–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ª–æ–∂–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã –∏–ª–∏ –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è), –∫—É—Ä—Å–æ—Ä—ã —É–ø—Ä–æ—â–∞—é—Ç –∑–∞–¥–∞—á—É.

–û–¥–Ω–∞–∫–æ –∫—É—Ä—Å–æ—Ä—ã –Ω–µ –Ω—É–∂–Ω—ã, –µ—Å–ª–∏:

1. **–ú–æ–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ–±—ã—á–Ω—ã–º SQL-–∑–∞–ø—Ä–æ—Å–æ–º**:
   - SQL-–∑–∞–ø—Ä–æ—Å—ã –±—ã—Å—Ç—Ä–µ–µ –∫—É—Ä—Å–æ—Ä–æ–≤, —Ç–∞–∫ –∫–∞–∫ —Å–µ—Ä–≤–µ—Ä —É–º–µ–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.

2. **–¢—Ä–µ–±—É—é—Ç—Å—è –º–∞—Å—Å–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö**:
   - –û–ø–µ—Ä–∞—Ü–∏–∏ `UPDATE`, `DELETE`, `INSERT` —Ä–∞–±–æ—Ç–∞—é—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ, –µ—Å–ª–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å—Ä–∞–∑—É –¥–ª—è –≤—Å–µ–≥–æ –Ω–∞–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö.

3. **–í–∞–∂–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**:
   - –ö—É—Ä—Å–æ—Ä—ã –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å –ª–∏—à–Ω–∏–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã, –ø–æ—ç—Ç–æ–º—É –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–æ–∏—Ç —Ç—â–∞—Ç–µ–ª—å–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å.

---

### **3. –†–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –∫—É—Ä—Å–æ—Ä–∞–º–∏ –∏ –æ–±—ã—á–Ω—ã–º–∏ SQL-–∑–∞–ø—Ä–æ—Å–∞–º–∏**

| **–ö—É—Ä—Å–æ—Ä—ã** üåÄ                          | **–û–±—ã—á–Ω—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã** ‚ö°                  |
|-----------------------------------------|---------------------------------------------|
| –†–∞–±–æ—Ç–∞—é—Ç **–ø–æ—Å—Ç—Ä–æ—á–Ω–æ**                  | –†–∞–±–æ—Ç–∞—é—Ç —Å **–Ω–∞–±–æ—Ä–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö**              |
| –¢—Ä–µ–±—É—é—Ç **–æ–±—ä—è–≤–ª–µ–Ω–∏—è, –æ—Ç–∫—Ä—ã—Ç–∏—è –∏ –∑–∞–∫—Ä—ã—Ç–∏—è** | –í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è **–æ–¥–Ω–∏–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º**            |
| –ú–æ–∂–Ω–æ **—É–ø—Ä–∞–≤–ª—è—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π** –≤—Ä—É—á–Ω—É—é  | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É—é—Ç—Å—è —Å–µ—Ä–≤–µ—Ä–æ–º       |
| –ó–∞–Ω–∏–º–∞—é—Ç –±–æ–ª—å—à–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö | –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã –¥–ª—è **–º–∞—Å—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π**        |

---

### **4. –û–±—ä—è–≤–ª–µ–Ω–∏–µ –∏ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫—É—Ä—Å–æ—Ä–æ–≤**

–ö—É—Ä—Å–æ—Ä—ã –æ–±—ä—è–≤–ª—è—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–π, –ø—Ä–æ—Ü–µ–¥—É—Ä –∏–ª–∏ –∞–Ω–æ–Ω–∏–º–Ω—ã—Ö –±–ª–æ–∫–æ–≤ —Å –ø–æ–º–æ—â—å—é –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ `CURSOR` –∏–ª–∏ `REFCURSOR`.

#### **–°–∏–Ω—Ç–∞–∫—Å–∏—Å –æ–±—ä—è–≤–ª–µ–Ω–∏—è –∫—É—Ä—Å–æ—Ä–∞:**
```sql
DECLARE –∏–º—è_–∫—É—Ä—Å–æ—Ä–∞ CURSOR FOR –∑–∞–ø—Ä–æ—Å;
```

–ü—Ä–∏–º–µ—Ä:
```sql
DECLARE my_cursor CURSOR FOR SELECT * FROM employees WHERE department = 'IT';
```

–ö—É—Ä—Å–æ—Ä—ã –±—ã–≤–∞—é—Ç –¥–≤—É—Ö —Ç–∏–ø–æ–≤:
4. **–°–≤—è–∑–∞–Ω–Ω—ã–µ –∫—É—Ä—Å–æ—Ä—ã**:
   - –ü—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É SQL-–∑–∞–ø—Ä–æ—Å—É.
   - –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –∏–∑–≤–µ—Å—Ç–µ–Ω –∑–∞—Ä–∞–Ω–µ–µ.

5. **–ù–µ—Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫—É—Ä—Å–æ—Ä—ã** (`REFCURSOR`):
   - –û–±—ä—è–≤–ª—è—é—Ç—Å—è –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ –∏ —Å–≤—è–∑—ã–≤–∞—é—Ç—Å—è —Å –Ω–∏–º –ø–æ–∑–∂–µ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏.
   - –ü–æ–∑–≤–æ–ª—è—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ä–∞–∑–Ω—ã–º–∏ SQL-–∑–∞–ø—Ä–æ—Å–∞–º–∏.

–ü—Ä–∏–º–µ—Ä –Ω–µ—Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ –∫—É—Ä—Å–æ—Ä–∞:
```sql
DECLARE dynamic_cursor REFCURSOR;
OPEN dynamic_cursor FOR SELECT * FROM employees WHERE department = 'Finance';
```

–ö—É—Ä—Å–æ—Ä—ã —Ç–∞–∫–∂–µ –º–æ–≥—É—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –∏—Ö –±–æ–ª–µ–µ –≥–∏–±–∫–∏–º–∏:
```sql
DECLARE emp_cursor CURSOR (dept_name TEXT) FOR
    SELECT id, name FROM employees WHERE department = dept_name;
OPEN emp_cursor('IT');
```

---

### **5. –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫—É—Ä—Å–æ—Ä–∞–º–∏**

#### **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (`FETCH`):**
–ü–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –∫—É—Ä—Å–æ—Ä–∞ –¥–∞–Ω–Ω—ã–µ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –ø–æ—Å—Ç—Ä–æ—á–Ω–æ —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã `FETCH`:
```sql
FETCH NEXT FROM emp_cursor INTO emp_record;
```

#### **–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –ø–æ –∫—É—Ä—Å–æ—Ä—É (`MOVE`):**
–ö–æ–º–∞–Ω–¥–∞ `MOVE` –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç —É–∫–∞–∑–∞—Ç–µ–ª—å –ø–æ –∫—É—Ä—Å–æ—Ä—É –±–µ–∑ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:
```sql
MOVE NEXT FROM emp_cursor;
```

#### **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –∫—É—Ä—Å–æ—Ä–∞ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö:**
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫—É—Ä—Å–æ—Ä—ã –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –ß—Ç–æ–±—ã –∫—É—Ä—Å–æ—Ä –æ—Å—Ç–∞–≤–∞–ª—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º, –µ–≥–æ –Ω—É–∂–Ω–æ –æ–±—ä—è–≤–∏—Ç—å —Å `WITH HOLD`:
```sql
DECLARE emp_cursor CURSOR WITH HOLD FOR SELECT * FROM employees;
```

#### **–ó–∞–∫—Ä—ã—Ç–∏–µ –∫—É—Ä—Å–æ—Ä–æ–≤ (`CLOSE`):**
–ü–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã —Å –∫—É—Ä—Å–æ—Ä–æ–º –µ–≥–æ –Ω—É–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å:
```sql
CLOSE emp_cursor;
```

---

### **6. –†–∞–±–æ—Ç–∞ —Å –∫—É—Ä—Å–æ—Ä–∞–º–∏ –≤ —Ü–∏–∫–ª–∞—Ö**

–¶–∏–∫–ª `FOR` –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É —Å –∫—É—Ä—Å–æ—Ä–∞–º–∏:
```sql
FOR emp_record IN emp_cursor LOOP
    RAISE NOTICE 'ID: %, Name: %', emp_record.id, emp_record.name;
END LOOP;
```

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü:
```sql
FOR dept_record IN dept_cursor LOOP
    FOR emp_record IN emp_cursor LOOP
        RAISE NOTICE 'Department: %, Employee: %', dept_record.name, emp_record.name;
    END LOOP;
END LOOP;
```

---

### **7. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –∫—É—Ä—Å–æ—Ä**

–î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è `WHERE CURRENT OF`:
```sql
UPDATE employees SET salary = salary * 1.1 WHERE CURRENT OF emp_cursor;
```

–ö—É—Ä—Å–æ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±—ä—è–≤–ª–µ–Ω —Å `FOR UPDATE`, —á—Ç–æ–±—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫–∏ –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥—Ä—É–≥–∏–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏.

---

### **8. –ü–µ—Ä–µ–¥–∞—á–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—É—Ä—Å–æ—Ä–æ–º –∫–ª–∏–µ–Ω—Ç—É**

–ö—É—Ä—Å–æ—Ä—ã –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—É, —á—Ç–æ–±—ã –æ–Ω —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –∏–∑–≤–ª–µ–∫–∞–ª –¥–∞–Ω–Ω—ã–µ:
```sql
CREATE OR REPLACE FUNCTION get_employees_cursor() RETURNS REFCURSOR AS $$
DECLARE 
    emp_cursor REFCURSOR;
BEGIN
    OPEN emp_cursor FOR SELECT id, name FROM employees WHERE department = 'IT';
    RETURN emp_cursor;
END;
$$ LANGUAGE plpgsql;
```

–ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∫—É—Ä—Å–æ—Ä–æ–º —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—ã `FETCH`, `MOVE` –∏ `CLOSE`.

---

### **9. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è**

#### **–ó–∞–¥–∞–Ω–∏–µ 1: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∞–≤—Ç–æ—Ä–æ–≤ –∫–Ω–∏–≥**
–§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–ø–∏—Å–æ–∫ –∞–≤—Ç–æ—Ä–æ–≤ –∫–Ω–∏–≥–∏:
```sql
CREATE OR REPLACE FUNCTION format_authors(book_id INT) RETURNS TEXT AS $$
DECLARE
    author_cursor CURSOR FOR SELECT name FROM authors WHERE book_id = format_authors.book_id;
    author_name TEXT;
    author_list TEXT := '';
    count INT := 0;
BEGIN
    OPEN author_cursor;
    LOOP
        FETCH author_cursor INTO author_name;
        EXIT WHEN NOT FOUND;
        count := count + 1;
        IF count <= 2 THEN
            IF author_list <> '' THEN
                author_list := author_list || ', ';
            END IF;
            author_list := author_list || author_name;
        END IF;
    END LOOP;
    CLOSE author_cursor;
    IF count > 2 THEN
        author_list := author_list || ' –∏ –¥—Ä—É–≥–∏–µ';
    END IF;
    RETURN author_list;
END;
$$ LANGUAGE plpgsql;
```

#### **–ó–∞–¥–∞–Ω–∏–µ 2: –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—É–º–º—ã –º–µ–∂–¥—É –æ—Ç–¥–µ–ª–∞–º–∏**
–§—É–Ω–∫—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—É–º–º—É –º–µ–∂–¥—É –æ—Ç–¥–µ–ª–∞–º–∏:
```sql
CREATE OR REPLACE FUNCTION distribute_amount(amount INT) RETURNS VOID AS $$
DECLARE
    dept_cursor CURSOR FOR SELECT id FROM departments;
    dept_id INT;
    base_amount INT;
    extra INT;
    count INT := 0;
BEGIN
    base_amount := amount / 3;
    extra := amount % 3;
    OPEN dept_cursor;
    LOOP
        FETCH dept_cursor INTO dept_id;
        EXIT WHEN NOT FOUND;
        count := count + 1;
        IF count = 1 THEN
            UPDATE departments SET budget = budget + base_amount + extra WHERE id = dept_id;
        ELSE
            UPDATE departments SET budget = budget + base_amount WHERE id = dept_id;
        END IF;
    END LOOP;
    CLOSE dept_cursor;
END;
$$ LANGUAGE plpgsql;
```

#### **–ó–∞–¥–∞–Ω–∏–µ 3: –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Å–ª–∏—è–Ω–∏–µ–º**
–§—É–Ω–∫—Ü–∏—è –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–≤–∞ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞–±–æ—Ä–∞ —á–∏—Å–µ–ª:
```sql
CREATE OR REPLACE FUNCTION merge_sorted_cursors(cursor1 REFCURSOR, cursor2 REFCURSOR) RETURNS TABLE (num INT) AS $$
DECLARE
    num1 INT;
    num2 INT;
BEGIN
    OPEN cursor1;
    OPEN cursor2;
    FETCH cursor1 INTO num1;
    FETCH cursor2 INTO num2;
    WHILE num1 IS NOT NULL OR num2 IS NOT NULL LOOP
        IF num1 IS NULL THEN
            RETURN NEXT num2;
            FETCH cursor2 INTO num2;
        ELSIF num2 IS NULL THEN
            RETURN NEXT num1;
            FETCH cursor1 INTO num1;
        ELSIF num1 <= num2 THEN
            RETURN NEXT num1;
            FETCH cursor1 INTO num1;
        ELSE
            RETURN NEXT num2;
            FETCH cursor2 INTO num2;
        END IF;
    END LOOP;
    CLOSE cursor1;
    CLOSE cursor2;
END;
$$ LANGUAGE plpgsql;
```

---

### **–ó–∞–∫–ª—é—á–µ–Ω–∏–µ**

–ö—É—Ä—Å–æ—Ä—ã ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç—Ä–æ—á–Ω–æ. –û–¥–Ω–∞–∫–æ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Å–æ–∑–Ω–∞–Ω–Ω—ã–º, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –º–æ–≥—É—Ç –∑–∞–º–µ–¥–ª–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã. –í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ —Å—Ç–æ–∏—Ç –æ—Ç–¥–∞–≤–∞—Ç—å SQL-–∑–∞–ø—Ä–æ—Å–∞–º, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç –±—ã—Å—Ç—Ä–µ–µ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ.