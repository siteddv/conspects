### **–ü–æ–¥—Ä–æ–±–Ω—ã–π –∫–æ–Ω—Å–ø–µ–∫—Ç —à–µ—Å—Ç–æ–π —á–∞—Å—Ç–∏: –ü–µ—Ä–µ–¥–∞—á–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—É—Ä—Å–æ—Ä–æ–º –∫–ª–∏–µ–Ω—Ç—É**

---

### **6.1. –ß—Ç–æ –∑–Ω–∞—á–∏—Ç –ø–µ—Ä–µ–¥–∞—á–∞ –∫—É—Ä—Å–æ—Ä–∞ –∫–ª–∏–µ–Ω—Ç—É?**

–û–±—ã—á–Ω–æ –∫—É—Ä—Å–æ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–≤–Ω—É—Ç—Ä–∏ PL/pgSQL**, –Ω–æ –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å **–æ—Ç–∫—Ä—ã—Ç—å –∫—É—Ä—Å–æ—Ä –≤ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –ø–µ—Ä–µ–¥–∞—Ç—å –µ–≥–æ –∫–ª–∏–µ–Ω—Ç—É**.  
–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∫–ª–∏–µ–Ω—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, Python-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ) —Å–º–æ–∂–µ—Ç **—Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –∏–∑–≤–ª–µ–∫–∞—Ç—å –¥–∞–Ω–Ω—ã–µ (`FETCH`) –∏–∑ –∫—É—Ä—Å–æ—Ä–∞**.

üí° **–ö–æ–≥–¥–∞ —ç—Ç–æ –ø–æ–ª–µ–∑–Ω–æ?**

- –ö–æ–≥–¥–∞ **–Ω–µ–ª—å–∑—è –∑–∞—Ä–∞–Ω–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –≤ –≤—ã–±–æ—Ä–∫–µ**.
- –ö–æ–≥–¥–∞ **–æ–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π**, –∏ –∫–ª–∏–µ–Ω—Ç—É **—É–¥–æ–±–Ω–µ–µ –∑–∞–±–∏—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ—Ä—Ü–∏—è–º–∏** (`FETCH 10`, `FETCH 50`).
- –ö–æ–≥–¥–∞ **–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Å—Ç–æ—Ä–æ–Ω–µ**.

---

### **6.2. –ö–∞–∫ –ø–µ—Ä–µ–¥–∞—Ç—å –∫—É—Ä—Å–æ—Ä –∫–ª–∏–µ–Ω—Ç—É?**

–î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **—Ç–∏–ø `REFCURSOR`**, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–∏–º—è –∫—É—Ä—Å–æ—Ä–∞** –∫–ª–∏–µ–Ω—Ç—É.  
–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∫–ª–∏–µ–Ω—Ç —Å–∞–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç `FETCH`, `MOVE` –∏ –¥—Ä—É–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏.

üìå **–ü—Ä–∏–º–µ—Ä —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –ø–µ—Ä–µ–¥–∞–µ—Ç –∫—É—Ä—Å–æ—Ä –∫–ª–∏–µ–Ω—Ç—É:**

```sql
CREATE OR REPLACE FUNCTION get_employees_cursor() RETURNS REFCURSOR AS $$
DECLARE 
    emp_cursor REFCURSOR;
BEGIN
    -- –°–æ–∑–¥–∞–µ–º –∫—É—Ä—Å–æ—Ä
    OPEN emp_cursor FOR 
        SELECT id, name FROM employees WHERE department = 'IT';
    
    -- –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–º—è –∫—É—Ä—Å–æ—Ä–∞ –∫–ª–∏–µ–Ω—Ç—É
    RETURN emp_cursor;
END;
$$ LANGUAGE plpgsql;
```

üîπ **–ß—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?**

1. **–û–±—ä—è–≤–ª—è–µ—Ç—Å—è –∫—É—Ä—Å–æ—Ä (`REFCURSOR`)**.
2. **–ö—É—Ä—Å–æ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞**.
3. **–ò–º—è –∫—É—Ä—Å–æ—Ä–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—É**, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Å–∞–º —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–∏–º.

---

### **6.3. –ö–∞–∫ –∫–ª–∏–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º –∫—É—Ä—Å–æ—Ä–æ–º?**

–ü–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç **–ø–æ–ª—É—á–∞–µ—Ç –∏–º—è –∫—É—Ä—Å–æ—Ä–∞** –∏ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–º–∞–Ω–¥—ã **`FETCH`, `CLOSE` –∏ –¥—Ä—É–≥–∏–µ**.

üìå **–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å –∫—É—Ä—Å–æ—Ä–æ–º –≤ SQL-–∫–ª–∏–µ–Ω—Ç–µ:**

```sql
BEGIN;
SELECT get_employees_cursor();  -- –ü–æ–ª—É—á–∞–µ–º –∏–º—è –∫—É—Ä—Å–æ—Ä–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä "emp_cursor"
FETCH 5 FROM emp_cursor;        -- –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–≤—ã–µ 5 —Å—Ç—Ä–æ–∫
FETCH 10 FROM emp_cursor;       -- –ü–æ–ª—É—á–∞–µ–º –µ—â–µ 10 —Å—Ç—Ä–æ–∫
CLOSE emp_cursor;               -- –ó–∞–∫—Ä—ã–≤–∞–µ–º –∫—É—Ä—Å–æ—Ä
COMMIT;
```

üîπ **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**

- `SELECT get_employees_cursor();` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–∏–º—è –∫—É—Ä—Å–æ—Ä–∞** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `emp_cursor`).
- `FETCH 5 FROM emp_cursor;` –∏–∑–≤–ª–µ–∫–∞–µ—Ç **5 —Å—Ç—Ä–æ–∫**.
- `FETCH 10 FROM emp_cursor;` –∑–∞–±–∏—Ä–∞–µ—Ç **–µ—â–µ 10 —Å—Ç—Ä–æ–∫**.
- `CLOSE emp_cursor;` **–æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã**.

---

### **6.4. –ü–µ—Ä–µ–¥–∞—á–∞ –∏–º–µ–Ω–∏ –∫—É—Ä—Å–æ—Ä–∞ –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞**

–ò–Ω–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç **—Å–∞–º —Ö–æ—á–µ—Ç –∑–∞–¥–∞–≤–∞—Ç—å –∏–º—è –∫—É—Ä—Å–æ—Ä–∞**.  
–í —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ –∏–º—è –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è **–∫–∞–∫ –≤—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ —Ñ—É–Ω–∫—Ü–∏—é**.

üìå **–ü—Ä–∏–º–µ—Ä:**

```sql
CREATE OR REPLACE FUNCTION get_employees_cursor(cursor_name REFCURSOR) RETURNS REFCURSOR AS $$
BEGIN
    OPEN cursor_name FOR 
        SELECT id, name FROM employees WHERE department = 'HR';
    RETURN cursor_name;
END;
$$ LANGUAGE plpgsql;
```

üìå **–ö–ª–∏–µ–Ω—Ç –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é, –ø–µ—Ä–µ–¥–∞–≤–∞—è –∏–º—è –∫—É—Ä—Å–æ—Ä–∞:**

```sql
BEGIN;
SELECT get_employees_cursor('my_cursor');  -- –ù–∞–∑–Ω–∞—á–∞–µ–º –∫—É—Ä—Å–æ—Ä—É –∏–º—è "my_cursor"
FETCH 10 FROM my_cursor;                   -- –ò–∑–≤–ª–µ–∫–∞–µ–º 10 —Å—Ç—Ä–æ–∫
CLOSE my_cursor;                            -- –ó–∞–∫—Ä—ã–≤–∞–µ–º –∫—É—Ä—Å–æ—Ä
COMMIT;
```

üîπ **–ö–æ–≥–¥–∞ —ç—Ç–æ –ø–æ–ª–µ–∑–Ω–æ?**

- –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç—É **–Ω—É–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∫—É—Ä—Å–æ—Ä–∞–º–∏**.
- –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç—É –≤–∞–∂–Ω–æ **—Å–∞–º–æ–º—É –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∏–º–µ–Ω–∞ –∫—É—Ä—Å–æ—Ä–æ–≤**.

---

### **6.5. –ö–∞–∫ –ø–µ—Ä–µ–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫—É—Ä—Å–æ—Ä–æ–≤ –∫–ª–∏–µ–Ω—Ç—É?**

–ò–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ **–ø–µ—Ä–µ–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—É –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤—ã–±–æ—Ä–æ–∫**, –Ω–æ –≤ PL/pgSQL **–Ω–µ–ª—å–∑—è –≤–µ—Ä–Ω—É—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ `REFCURSOR` –Ω–∞–ø—Ä—è–º—É—é**.  
–†–µ—à–µ–Ω–∏–µ: **–æ—Ç–∫—Ä—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫—É—Ä—Å–æ—Ä–æ–≤ –∏ –≤–µ—Ä–Ω—É—Ç—å –∏—Ö –∏–º–µ–Ω–∞**.

üìå **–ü—Ä–∏–º–µ—Ä —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–≤–∞ –∫—É—Ä—Å–æ—Ä–∞:**

```sql
CREATE OR REPLACE FUNCTION get_multiple_cursors(out cursor1 REFCURSOR, out cursor2 REFCURSOR) RETURNS RECORD AS $$
BEGIN
    OPEN cursor1 FOR 
        SELECT id, name FROM employees WHERE department = 'HR';
    
    OPEN cursor2 FOR 
        SELECT id, name FROM employees WHERE department = 'Finance';
END;
$$ LANGUAGE plpgsql;
```

üìå **–ö–ª–∏–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –¥–≤—É–º—è –∫—É—Ä—Å–æ—Ä–∞–º–∏:**

```sql
BEGIN;
SELECT * FROM get_multiple_cursors('cursorA', 'cursorB');
FETCH 5 FROM cursorA;  -- –ü–æ–ª—É—á–∞–µ–º 5 —Å—Ç—Ä–æ–∫ –∏–∑ –ø–µ—Ä–≤–æ–≥–æ –∫—É—Ä—Å–æ—Ä–∞
FETCH 5 FROM cursorB;  -- –ü–æ–ª—É—á–∞–µ–º 5 —Å—Ç—Ä–æ–∫ –∏–∑ –≤—Ç–æ—Ä–æ–≥–æ –∫—É—Ä—Å–æ—Ä–∞
CLOSE cursorA;
CLOSE cursorB;
COMMIT;
```

üí° **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç **—Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ä–∞–∑–Ω—ã–º–∏ –∫—É—Ä—Å–æ—Ä–∞–º–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ**.

---

### **6.6. –í—ã–≤–æ–¥ –ø–æ —à–µ—Å—Ç–æ–π —á–∞—Å—Ç–∏**

- **–ö—É—Ä—Å–æ—Ä—ã –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—É**, —á—Ç–æ–±—ã –æ–Ω **—Å–∞–º –≤—ã–±–∏—Ä–∞–ª, –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–∞—Ç—å –∏ –≤ –∫–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ**.
- **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `REFCURSOR`**, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–∏–º—è –∫—É—Ä—Å–æ—Ä–∞**, –∞ –∫–ª–∏–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –Ω–∏–º —á–µ—Ä–µ–∑ `FETCH`.
- –ú–æ–∂–Ω–æ **–ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∏–º—è –∫—É—Ä—Å–æ—Ä–∞ –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä**, —á—Ç–æ–±—ã –∫–ª–∏–µ–Ω—Ç **—Å–∞–º —É–ø—Ä–∞–≤–ª—è–ª –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ –∫—É—Ä—Å–æ—Ä–æ–≤**.
- **–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫—É—Ä—Å–æ—Ä–æ–≤**, –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –∏—Ö –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –≤–µ—Ä–Ω—É—Ç—å **—Ä–∞–∑–Ω—ã–µ –∏–º–µ–Ω–∞**.

---

üëâ **–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –†–∞–∑–±–∏—Ä–∞–µ–º **—Å–µ–¥—å–º—É—é —á–∞—Å—Ç—å: "–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è –∏ –∏—Ö –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ"**?