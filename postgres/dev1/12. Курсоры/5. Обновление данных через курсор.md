### **–ü–æ–¥—Ä–æ–±–Ω—ã–π –∫–æ–Ω—Å–ø–µ–∫—Ç –ø—è—Ç–æ–π —á–∞—Å—Ç–∏: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –∫—É—Ä—Å–æ—Ä**

---

### **5.1. –ö–∞–∫ –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç—Ä–æ–∫–∏ —Å –ø–æ–º–æ—â—å—é –∫—É—Ä—Å–æ—Ä–∞ (`WHERE CURRENT OF`)?**

–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∫—É—Ä—Å–æ—Ä–∞–º–∏ –º–æ–∂–Ω–æ **–∏–∑–º–µ–Ω—è—Ç—å –∏–ª–∏ —É–¥–∞–ª—è—Ç—å** —Å—Ç—Ä–æ–∫–∏, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö —Å—Ç–æ–∏—Ç —Ç–µ–∫—É—â–∏–π —É–∫–∞–∑–∞—Ç–µ–ª—å.  
–î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **`WHERE CURRENT OF –∫—É—Ä—Å–æ—Ä`**.

üìå **–ü—Ä–∏–º–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏ —á–µ—Ä–µ–∑ –∫—É—Ä—Å–æ—Ä:**

```sql
DECLARE emp_cursor CURSOR FOR 
    SELECT id, salary FROM employees WHERE department = 'IT' FOR UPDATE;

DECLARE emp_record RECORD;

BEGIN
    OPEN emp_cursor;
    
    LOOP
        FETCH emp_cursor INTO emp_record;
        EXIT WHEN NOT FOUND;
        
        UPDATE employees 
        SET salary = salary * 1.1  -- –ü–æ–≤—ã—à–∞–µ–º –∑–∞—Ä–ø–ª–∞—Ç—É –Ω–∞ 10%
        WHERE CURRENT OF emp_cursor;
    END LOOP;

    CLOSE emp_cursor;
END;
```

üîπ **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?**

1. **–û—Ç–∫—Ä—ã–≤–∞–µ–º –∫—É—Ä—Å–æ—Ä** –∏ –±–ª–æ–∫–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫–∏ `FOR UPDATE`.
2. **–ü–µ—Ä–µ–±–∏—Ä–∞–µ–º —Å—Ç—Ä–æ–∫–∏ –∫—É—Ä—Å–æ—Ä–æ–º** (`FETCH`).
3. **–û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É**, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π —Å—Ç–æ–∏—Ç –∫—É—Ä—Å–æ—Ä (`WHERE CURRENT OF`).
4. **–ó–∞–∫—Ä—ã–≤–∞–µ–º –∫—É—Ä—Å–æ—Ä** –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏.

üí° **–ö–æ–≥–¥–∞ `WHERE CURRENT OF` –ø–æ–ª–µ–∑–µ–Ω?**

- –ö–æ–≥–¥–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è **–∫ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–æ–∫–µ –∫—É—Ä—Å–æ—Ä–∞**.
- –ö–æ–≥–¥–∞ **–Ω–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∫–ª—é—á–∞** (–∏–Ω–∞—á–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `WHERE id = ...`).

---

### **5.2. –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π —Å `WHERE CURRENT OF`**

üìå **–ü—Ä–∏–º–µ—Ä —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏ —á–µ—Ä–µ–∑ –∫—É—Ä—Å–æ—Ä:**

```sql
DECLARE emp_cursor CURSOR FOR 
    SELECT id FROM employees WHERE salary < 50000 FOR UPDATE;

DECLARE emp_record RECORD;

BEGIN
    OPEN emp_cursor;
    
    LOOP
        FETCH emp_cursor INTO emp_record;
        EXIT WHEN NOT FOUND;
        
        DELETE FROM employees WHERE CURRENT OF emp_cursor;
    END LOOP;

    CLOSE emp_cursor;
END;
```

üîπ **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?**

- **–£–¥–∞–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫–∏, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö —Å—Ç–æ–∏—Ç —É–∫–∞–∑–∞—Ç–µ–ª—å –∫—É—Ä—Å–æ—Ä–∞.**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **`FOR UPDATE`**, —á—Ç–æ–±—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫–∏ –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥—Ä—É–≥–∏–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏.

---

### **5.3. –í–∞–∂–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è `WHERE CURRENT OF`**

- **–ö—É—Ä—Å–æ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±—ä—è–≤–ª–µ–Ω `FOR UPDATE`** ‚Äî –∏–Ω–∞—á–µ –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞.
- **–†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å `UPDATE` –∏ `DELETE`**.
- **–ù–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `WHERE CURRENT OF` –¥–ª—è –∫—É—Ä—Å–æ—Ä–æ–≤ —Å `JOIN`**, –ø–æ–¥–∑–∞–ø—Ä–æ—Å–∞–º–∏ –∏–ª–∏ –∞–≥—Ä–µ–≥–∞—Ç–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏.

üìå **–ü—Ä–∏–º–µ—Ä –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```sql
DECLARE emp_cursor CURSOR FOR 
    SELECT id, name FROM employees e JOIN departments d ON e.dept_id = d.id FOR UPDATE;
```

‚õî **–û—à–∏–±–∫–∞! –ö—É—Ä—Å–æ—Ä —Å `JOIN` –Ω–µ–ª—å–∑—è –æ–±–Ω–æ–≤–ª—è—Ç—å —á–µ—Ä–µ–∑ `WHERE CURRENT OF`.**

‚úÖ **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `WHERE id = emp_record.id`.

---

### **5.4. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑ `WHERE CURRENT OF`**

–ò–Ω–æ–≥–¥–∞ –ø—Ä–æ—â–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–æ–∫–∏ **—á–µ—Ä–µ–∑ `WHERE id = ...`**, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –µ—Å—Ç—å –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á.

üìå **–ü—Ä–∏–º–µ—Ä –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**

```sql
DECLARE emp_cursor CURSOR FOR 
    SELECT id, salary FROM employees WHERE department = 'IT';

DECLARE emp_record RECORD;

BEGIN
    OPEN emp_cursor;
    
    LOOP
        FETCH emp_cursor INTO emp_record;
        EXIT WHEN NOT FOUND;
        
        UPDATE employees 
        SET salary = salary * 1.1
        WHERE id = emp_record.id;
    END LOOP;

    CLOSE emp_cursor;
END;
```

üîπ **–ö–æ–≥–¥–∞ `WHERE id = ...` –ª—É—á—à–µ?**

- –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ **–∏–º–µ–µ—Ç –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `id`).
- –ï—Å–ª–∏ –∫—É—Ä—Å–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç —Å `JOIN` –∏–ª–∏ —Å–ª–æ–∂–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏.

---

### **5.5. –í—ã–≤–æ–¥ –ø–æ –ø—è—Ç–æ–π —á–∞—Å—Ç–∏**

- **`WHERE CURRENT OF`** –ø–æ–∑–≤–æ–ª—è–µ—Ç **–æ–±–Ω–æ–≤–ª—è—Ç—å –∏–ª–∏ —É–¥–∞–ª—è—Ç—å —Å—Ç—Ä–æ–∫–∏, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö —Å—Ç–æ–∏—Ç –∫—É—Ä—Å–æ—Ä**.
- –ù—É–∂–Ω–æ **–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `FOR UPDATE`**, —á—Ç–æ–±—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω—è–µ–º—ã–µ —Å—Ç—Ä–æ–∫–∏.
- **–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å `JOIN` –∏–ª–∏ –∞–≥—Ä–µ–≥–∞—Ç–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏**.
- **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±** ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `WHERE id = ...`, –µ—Å–ª–∏ –µ—Å—Ç—å –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á.

---

üëâ **–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –†–∞–∑–±–∏—Ä–∞–µ–º **—à–µ—Å—Ç—É—é —á–∞—Å—Ç—å: "–ü–µ—Ä–µ–¥–∞—á–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—É—Ä—Å–æ—Ä–æ–º –∫–ª–∏–µ–Ω—Ç—É"**?