### **–ö–æ–Ω—Å–ø–µ–∫—Ç. –ß–∞—Å—Ç—å 4: –ü–µ—Ä–µ–±–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–∞—Å—Å–∏–≤–∞ –≤ —Ü–∏–∫–ª–∞—Ö (PL/pgSQL)**

–í —ç—Ç–æ–π —á–∞—Å—Ç–∏ —Ä–∞–∑–±–µ—Ä–µ–º, –∫–∞–∫ **–ø–µ—Ä–µ–±–∏—Ä–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –º–∞—Å—Å–∏–≤–∞ –≤ —Ü–∏–∫–ª–∞—Ö**, –∏—Å–ø–æ–ª—å–∑—É—è `FOR`, `FOREACH`, —Ñ—É–Ω–∫—Ü–∏–∏ `array_length()`, `array_lower()`, `array_upper()` –∏ –¥—Ä—É–≥–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã.

---

## **1. –ü–µ—Ä–µ–±–æ—Ä –º–∞—Å—Å–∏–≤–∞ —Å –ø–æ–º–æ—â—å—é `FOR`**

### **1.1. –ò—Ç–µ—Ä–∞—Ü–∏—è –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º**

–ü–æ—Å–∫–æ–ª—å–∫—É –º–∞—Å—Å–∏–≤—ã –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è —Å 1, –º–æ–∂–Ω–æ –ø–µ—Ä–µ–±–∏—Ä–∞—Ç—å –∏—Ö, –∏—Å–ø–æ–ª—å–∑—É—è –æ–±—ã—á–Ω—ã–π —Ü–∏–∫–ª `FOR`.

```sql
DO $$ 
DECLARE
    arr INTEGER[] := ARRAY[10, 20, 30, 40, 50];
    i INTEGER;
BEGIN
    FOR i IN array_lower(arr, 1)..array_upper(arr, 1) LOOP
        RAISE NOTICE '–≠–ª–µ–º–µ–Ω—Ç %: %', i, arr[i];
    END LOOP;
END $$;
```

üîπ **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?**

- `array_lower(arr, 1)` ‚Äì –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∏–∂–Ω–∏–π –∏–Ω–¥–µ–∫—Å –º–∞—Å—Å–∏–≤–∞ (–æ–±—ã—á–Ω–æ 1).
- `array_upper(arr, 1)` ‚Äì –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–µ—Ä—Ö–Ω–∏–π –∏–Ω–¥–µ–∫—Å –º–∞—Å—Å–∏–≤–∞ (—á–∏—Å–ª–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤).
- `arr[i]` ‚Äì –¥–æ—Å—Ç—É–ø –∫ —ç–ª–µ–º–µ–Ω—Ç—É –º–∞—Å—Å–∏–≤–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É.

**–í—ã–≤–æ–¥:**

```
NOTICE:  –≠–ª–µ–º–µ–Ω—Ç 1: 10
NOTICE:  –≠–ª–µ–º–µ–Ω—Ç 2: 20
NOTICE:  –≠–ª–µ–º–µ–Ω—Ç 3: 30
NOTICE:  –≠–ª–µ–º–µ–Ω—Ç 4: 40
NOTICE:  –≠–ª–µ–º–µ–Ω—Ç 5: 50
```

---

## **2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `FOREACH` –¥–ª—è –ø–µ—Ä–µ–±–æ—Ä–∞ –º–∞—Å—Å–∏–≤–∞**

`FOREACH` –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ö–æ–¥–∏—Ç—å –º–∞—Å—Å–∏–≤ **–±–µ–∑ –∏–Ω–¥–µ–∫—Å–æ–≤**.

```sql
DO $$ 
DECLARE
    arr INTEGER[] := ARRAY[10, 20, 30, 40, 50];
    num INTEGER;
BEGIN
    FOREACH num IN ARRAY arr LOOP
        RAISE NOTICE '–≠–ª–µ–º–µ–Ω—Ç: %', num;
    END LOOP;
END $$;
```

üîπ **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?**

- –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `num` –ø–æ–ª—É—á–∞–µ—Ç **–∑–Ω–∞—á–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞** –º–∞—Å—Å–∏–≤–∞ –Ω–∞–ø—Ä—è–º—É—é.
- –¶–∏–∫–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç **–≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã** –º–∞—Å—Å–∏–≤–∞.

**–í—ã–≤–æ–¥:**

```
NOTICE:  –≠–ª–µ–º–µ–Ω—Ç: 10
NOTICE:  –≠–ª–µ–º–µ–Ω—Ç: 20
NOTICE:  –≠–ª–µ–º–µ–Ω—Ç: 30
NOTICE:  –≠–ª–µ–º–µ–Ω—Ç: 40
NOTICE:  –≠–ª–µ–º–µ–Ω—Ç: 50
```

‚úÖ **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `FOREACH`?**

- –ï—Å–ª–∏ **–Ω–µ –Ω—É–∂–µ–Ω –∏–Ω–¥–µ–∫—Å**, –Ω–æ –≤–∞–∂–Ω—ã **–∑–Ω–∞—á–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤**.

---

## **3. –ü–µ—Ä–µ–±–æ—Ä –¥–≤—É–º–µ—Ä–Ω–æ–≥–æ –º–∞—Å—Å–∏–≤–∞**

–î–ª—è –¥–≤—É–º–µ—Ä–Ω—ã—Ö –º–∞—Å—Å–∏–≤–æ–≤ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã**.

```sql
DO $$ 
DECLARE
    matrix INTEGER[][] := ARRAY[[1, 2, 3], [4, 5, 6]];
    row INT;
    col INT;
BEGIN
    FOR row IN array_lower(matrix, 1)..array_upper(matrix, 1) LOOP
        FOR col IN array_lower(matrix, 2)..array_upper(matrix, 2) LOOP
            RAISE NOTICE 'matrix[%][%] = %', row, col, matrix[row][col];
        END LOOP;
    END LOOP;
END $$;
```

üîπ **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?**

- `matrix[row][col]` ‚Äì –¥–æ—Å—Ç—É–ø –∫ —ç–ª–µ–º–µ–Ω—Ç—É –≤ –¥–≤—É–º–µ—Ä–Ω–æ–º –º–∞—Å—Å–∏–≤–µ.
- `array_lower(matrix, 1)` ‚Äì –Ω–∏–∂–Ω–∏–π –∏–Ω–¥–µ–∫—Å —Å—Ç—Ä–æ–∫ (–æ–±—ã—á–Ω–æ 1).
- `array_upper(matrix, 2)` ‚Äì –≤–µ—Ä—Ö–Ω–∏–π –∏–Ω–¥–µ–∫—Å —Å—Ç–æ–ª–±—Ü–æ–≤.

**–í—ã–≤–æ–¥:**

```
NOTICE:  matrix[1][1] = 1
NOTICE:  matrix[1][2] = 2
NOTICE:  matrix[1][3] = 3
NOTICE:  matrix[2][1] = 4
NOTICE:  matrix[2][2] = 5
NOTICE:  matrix[2][3] = 6
```

---

## **4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `FOREACH` –¥–ª—è –¥–≤—É–º–µ—Ä–Ω—ã—Ö –º–∞—Å—Å–∏–≤–æ–≤**

–ú–æ–∂–Ω–æ –ø–µ—Ä–µ–±–∏—Ä–∞—Ç—å –º–Ω–æ–≥–æ–º–µ—Ä–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã —Å `FOREACH`, –Ω–æ —Ç–æ–≥–¥–∞ –º—ã –ø–æ–ª—É—á–∏–º **—Ç–æ–ª—å–∫–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã**.

```sql
DO $$ 
DECLARE
    matrix INTEGER[][] := ARRAY[[1, 2, 3], [4, 5, 6]];
    row INTEGER[];
    num INTEGER;
BEGIN
    FOREACH row IN ARRAY matrix LOOP
        FOREACH num IN ARRAY row LOOP
            RAISE NOTICE '–≠–ª–µ–º–µ–Ω—Ç: %', num;
        END LOOP;
    END LOOP;
END $$;
```

**–í—ã–≤–æ–¥:**

```
NOTICE:  –≠–ª–µ–º–µ–Ω—Ç: 1
NOTICE:  –≠–ª–µ–º–µ–Ω—Ç: 2
NOTICE:  –≠–ª–µ–º–µ–Ω—Ç: 3
NOTICE:  –≠–ª–µ–º–µ–Ω—Ç: 4
NOTICE:  –≠–ª–µ–º–µ–Ω—Ç: 5
NOTICE:  –≠–ª–µ–º–µ–Ω—Ç: 6
```

‚úÖ **–ö–æ–≥–¥–∞ `FOREACH` –ø–æ–ª–µ–∑–µ–Ω –¥–ª—è –º–Ω–æ–≥–æ–º–µ—Ä–Ω—ã—Ö –º–∞—Å—Å–∏–≤–æ–≤?**

- –ï—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω—ã –∏–Ω–¥–µ–∫—Å—ã, –∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–æ –ø–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤.

---

## **5. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–∞–∑–º–µ—Ä–∞–º–∏ –º–∞—Å—Å–∏–≤–æ–≤**

### **5.1. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –º–∞—Å—Å–∏–≤–∞ (`array_length()`)**

```sql
SELECT array_length(ARRAY[10, 20, 30, 40], 1);
-- –í—ã–≤–µ–¥–µ—Ç: 4 (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤)
```

### **5.2. –ü–æ–ª—É—á–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü –º–∞—Å—Å–∏–≤–∞ (`array_lower()` –∏ `array_upper()`)**

```sql
SELECT array_lower(ARRAY[10, 20, 30, 40], 1);
-- –í—ã–≤–µ–¥–µ—Ç: 1 (–Ω–∏–∂–Ω–∏–π –∏–Ω–¥–µ–∫—Å)

SELECT array_upper(ARRAY[10, 20, 30, 40], 1);
-- –í—ã–≤–µ–¥–µ—Ç: 4 (–≤–µ—Ä—Ö–Ω–∏–π –∏–Ω–¥–µ–∫—Å)
```

### **5.3. –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç—Ä–æ–∫ –∏ —Å—Ç–æ–ª–±—Ü–æ–≤ –≤ –º–Ω–æ–≥–æ–º–µ—Ä–Ω–æ–º –º–∞—Å—Å–∏–≤–µ**

```sql
SELECT array_length(ARRAY[[1,2,3], [4,5,6]], 1); -- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫
SELECT array_length(ARRAY[[1,2,3], [4,5,6]], 2); -- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–æ–ª–±—Ü–æ–≤
```

---

## **6. –ò—Ç–æ–≥**

- **–¶–∏–∫–ª `FOR`** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–µ—Ä–µ–±–æ—Ä–∞ –º–∞—Å—Å–∏–≤–∞ –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º.
- **–¶–∏–∫–ª `FOREACH`** —É–¥–æ–±–µ–Ω –¥–ª—è –ø–µ—Ä–µ–±–æ—Ä–∞ **–±–µ–∑ –∏–Ω–¥–µ–∫—Å–æ–≤**.
- **–î–ª—è –¥–≤—É–º–µ—Ä–Ω—ã—Ö –º–∞—Å—Å–∏–≤–æ–≤** –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `FOREACH` –∏–ª–∏ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ `FOR`.
- **–§—É–Ω–∫—Ü–∏–∏ `array_length()`, `array_lower()` –∏ `array_upper()`** –ø–æ–º–æ–≥–∞—é—Ç –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ä–∞–∑–º–µ—Ä –º–∞—Å—Å–∏–≤–∞.

---

üëâ –í —Å–ª–µ–¥—É—é—â–µ–π —á–∞—Å—Ç–∏ —Ä–∞–∑–±–µ—Ä–µ–º **—Ñ—É–Ω–∫—Ü–∏–∏ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º —á–∏—Å–ª–æ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (`VARIADIC`)**, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –º–∞—Å—Å–∏–≤—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–∞–∑–Ω—ã–º —á–∏—Å–ª–æ–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤. –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º? üöÄ

