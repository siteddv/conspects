### **–ö–æ–Ω—Å–ø–µ–∫—Ç. –ß–∞—Å—Ç—å 7: –ü—Ä–∞–∫—Ç–∏–∫–∞ –ø–æ –º–∞—Å—Å–∏–≤–∞–º**

–í —ç—Ç–æ–π —á–∞—Å—Ç–∏ —Ä–∞–∑–±–µ—Ä–µ–º –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è –ø–æ **–º–∞—Å—Å–∏–≤–∞–º –≤ PostgreSQL**:

1. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–∏–≥–∏ —Å –º–∞—Å—Å–∏–≤–æ–º –∞–≤—Ç–æ—Ä–æ–≤** (—É–∂–µ —Ä–∞–∑–æ–±—Ä–∞–ª–∏).
2. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π (`map()` –∏ `reduce()`) –≤ PostgreSQL**.

---

## **1. –í–≤–µ–¥–µ–Ω–∏–µ –≤ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è**

–í —è–∑—ã–∫–∞—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –µ—Å—Ç—å –¥–≤–µ –≤–∞–∂–Ω—ã–µ **—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**:

- `map()` ‚Äì –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –∫ –∫–∞–∂–¥–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É –º–∞—Å—Å–∏–≤–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–Ω–æ–≤—ã–π –º–∞—Å—Å–∏–≤**.
- `reduce()` ‚Äì —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –º–∞—Å—Å–∏–≤ –≤ **–æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ**, –∏—Å–ø–æ–ª—å–∑—É—è —Ñ—É–Ω–∫—Ü–∏—é.

### **–ü—Ä–∏–º–µ—Ä—ã –≤ Python:**

```python
# map()
nums = [1, 2, 3, 4]
squared = list(map(lambda x: x * x, nums))
print(squared)  # [1, 4, 9, 16]

# reduce()
from functools import reduce
sum_all = reduce(lambda x, y: x + y, nums)
print(sum_all)  # 10
```

–¢–µ–ø–µ—Ä—å —Ä–µ–∞–ª–∏–∑—É–µ–º –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ–µ –≤ **PostgreSQL**.

---

## **2. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è `map()` –≤ PostgreSQL**

### **–ó–∞–¥–∞—á–∞: –£–º–Ω–æ–∂–∏—Ç—å –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞ –Ω–∞ 2**

–°–æ–∑–¥–∞–¥–∏–º —Ñ—É–Ω–∫—Ü–∏—é `array_map()`, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç:

- **–ò–º—è SQL-—Ñ—É–Ω–∫—Ü–∏–∏** (–≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏).
- **–ú–∞—Å—Å–∏–≤ –¥–∞–Ω–Ω—ã—Ö**.

```sql
CREATE FUNCTION array_map(func_name TEXT, arr ANYARRAY) RETURNS ANYARRAY AS $$
DECLARE
    result ANYARRAY := '{}';  -- –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
    elem ANYELEMENT;
    sql TEXT;
BEGIN
    -- –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –º–∞—Å—Å–∏–≤ –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º –ø–µ—Ä–µ–¥–∞–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
    FOREACH elem IN ARRAY arr LOOP
        sql := format('SELECT %I(%L)', func_name, elem);
        EXECUTE sql INTO elem;  -- –í—ã–ø–æ–ª–Ω—è–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π SQL
        result := result || elem;  -- –î–æ–±–∞–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –≤ –º–∞—Å—Å–∏–≤
    END LOOP;
    RETURN result;
END $$ LANGUAGE plpgsql;
```

### **–°–æ–∑–¥–∞–¥–∏–º —Ñ—É–Ω–∫—Ü–∏—é `double(x)`, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç —É–¥–≤–∞–∏–≤–∞—Ç—å —á–∏—Å–ª–∞**

```sql
CREATE FUNCTION double(x INT) RETURNS INT AS $$
BEGIN
    RETURN x * 2;
END $$ LANGUAGE plpgsql;
```

### **–¢–µ—Å—Ç–∏—Ä—É–µ–º `array_map()`**

```sql
SELECT array_map('double', ARRAY[1, 2, 3, 4]);
-- –í—ã–≤–µ–¥–µ—Ç: {2,4,6,8}
```

üéØ **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?**

- `format('SELECT %I(%L)', func_name, elem)` ‚Üí —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç SQL-–≤—ã—Ä–∞–∂–µ–Ω–∏–µ.
- `EXECUTE sql INTO elem` ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ—Ç SQL –∏ –ø–æ–ª—É—á–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
- `result := result || elem` ‚Üí –¥–æ–±–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –º–∞—Å—Å–∏–≤.

---

## **3. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è `reduce()` –≤ PostgreSQL**

### **–ó–∞–¥–∞—á–∞: –ù–∞–π—Ç–∏ —Å—É–º–º—É –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–∞—Å—Å–∏–≤–∞**

–°–æ–∑–¥–∞–¥–∏–º —Ñ—É–Ω–∫—Ü–∏—é `array_reduce()`, –∫–æ—Ç–æ—Ä–∞—è:

- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç **–∏–º—è SQL-—Ñ—É–Ω–∫—Ü–∏–∏**.
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç **–º–∞—Å—Å–∏–≤** –∏ **–Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ**.
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–æ–¥–Ω–æ –∏—Ç–æ–≥–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ**.

```sql
CREATE FUNCTION array_reduce(func_name TEXT, arr ANYARRAY, initial ANYELEMENT) RETURNS ANYELEMENT AS $$
DECLARE
    accumulator ALIAS FOR initial;
    elem ANYELEMENT;
    sql TEXT;
BEGIN
    -- –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º —ç–ª–µ–º–µ–Ω—Ç–∞–º –º–∞—Å—Å–∏–≤–∞
    FOREACH elem IN ARRAY arr LOOP
        sql := format('SELECT %I(%L, %L)', func_name, accumulator, elem);
        EXECUTE sql INTO accumulator;  -- –í—ã–ø–æ–ª–Ω—è–µ–º SQL-–≤—ã—Ä–∞–∂–µ–Ω–∏–µ
    END LOOP;
    RETURN accumulator;
END $$ LANGUAGE plpgsql;
```

### **–°–æ–∑–¥–∞–¥–∏–º —Ñ—É–Ω–∫—Ü–∏—é `sum_two(x, y)`, –∫–æ—Ç–æ—Ä–∞—è —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç –¥–≤–∞ —á–∏—Å–ª–∞**

```sql
CREATE FUNCTION sum_two(x INT, y INT) RETURNS INT AS $$
BEGIN
    RETURN x + y;
END $$ LANGUAGE plpgsql;
```

### **–¢–µ—Å—Ç–∏—Ä—É–µ–º `array_reduce()`**

```sql
SELECT array_reduce('sum_two', ARRAY[1, 2, 3, 4], 0);
-- –í—ã–≤–µ–¥–µ—Ç: 10
```

üéØ **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?**

- `accumulator` ‚Äì —Ö—Ä–∞–Ω–∏—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
- `FOREACH` –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—ã –º–∞—Å—Å–∏–≤–∞.
- `EXECUTE` –≤—ã–ø–æ–ª–Ω—è–µ—Ç `sum_two(accumulator, elem)`.
- –í –∫–æ–Ω—Ü–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å—É–º–º–∞ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤.

---

## **4. –î–µ–ª–∞–µ–º `map()` –∏ `reduce()` –ø–æ–ª–∏–º–æ—Ä—Ñ–Ω—ã–º–∏**

–ß—Ç–æ–±—ã —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞–ª–∏ **—Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö**, –∑–∞–º–µ–Ω–∏–º `ANYARRAY` –Ω–∞ `ANYELEMENT`.

### **–ü–æ–ª–∏–º–æ—Ä—Ñ–Ω—ã–π `array_map()`**

```sql
CREATE FUNCTION array_map_poly(func_name TEXT, arr ANYARRAY) RETURNS ANYARRAY AS $$
DECLARE
    result arr%TYPE := '{}';
    elem arr%TYPE;
    sql TEXT;
BEGIN
    FOREACH elem IN ARRAY arr LOOP
        sql := format('SELECT %I(%L)', func_name, elem);
        EXECUTE sql INTO elem;
        result := result || elem;
    END LOOP;
    RETURN result;
END $$ LANGUAGE plpgsql;
```

–¢–µ–ø–µ—Ä—å **—Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ –º–∞—Å—Å–∏–≤–∞–º–∏**:

```sql
SELECT array_map_poly('upper', ARRAY['hello', 'world']);
-- –í—ã–≤–µ–¥–µ—Ç: {HELLO,WORLD}
```

---

## **5. –ò—Ç–æ–≥**

‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏ `map()` –∏ `reduce()` –≤ PostgreSQL.**  
‚úÖ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π SQL (`EXECUTE`) –¥–ª—è –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–π.**  
‚úÖ **–°–¥–µ–ª–∞–ª–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–ª–∏–º–æ—Ä—Ñ–Ω—ã–º–∏ (`ANYARRAY`, `ANYELEMENT`).**  
‚úÖ **–¢–µ–ø–µ—Ä—å PostgreSQL –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è!** üöÄ

---

üëâ –í —Å–ª–µ–¥—É—é—â–µ–π (–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π) —á–∞—Å—Ç–∏ —Ä–∞–∑–±–µ—Ä–µ–º **–∫–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã** –∏ –∑–∞–≤–µ—Ä—à–∏–º –∫–æ–Ω—Å–ø–µ–∫—Ç. –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º? üòä

