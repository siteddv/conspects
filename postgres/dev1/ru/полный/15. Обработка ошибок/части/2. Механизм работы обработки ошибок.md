–í–æ—Ç **–≤—Ç–æ—Ä–∞—è —á–∞—Å—Ç—å** –∫–æ–Ω—Å–ø–µ–∫—Ç–∞ –≤–∏–¥–µ–æ –¥–ª—è **Obsidian** –≤ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.

---

# **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ PL/pgSQL**

## **2. –ú–µ—Ö–∞–Ω–∏–∑–º —Ä–∞–±–æ—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫**

### **2.1 –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `BEGIN ... EXCEPTION`?**

–í PL/pgSQL –º–µ—Ö–∞–Ω–∏–∑–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –ø–æ—Å—Ç—Ä–æ–µ–Ω –≤–æ–∫—Ä—É–≥ –±–ª–æ–∫–∞ `BEGIN ... EXCEPTION`, –∫–æ—Ç–æ—Ä—ã–π:

1. **–°–æ–∑–¥–∞–µ—Ç —Ç–æ—á–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (SAVEPOINT)** –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∫–æ–¥–∞.
2. **–í—ã–ø–æ–ª–Ω—è–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ `BEGIN`**.
3. **–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞**, PostgreSQL:
    - **–û—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** –¥–æ —Ç–æ—á–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.
    - **–ü—ã—Ç–∞–µ—Ç—Å—è –Ω–∞–π—Ç–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–∫–∏** –≤ —Å–µ–∫—Ü–∏–∏ `EXCEPTION`.
4. **–ï—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–π–¥–µ–Ω** ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–¥ –∏–∑ `WHEN`.
5. **–ï—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω** ‚Äî –ø–µ—Ä–µ–¥–∞–µ—Ç –æ—à–∏–±–∫—É –≤—ã—à–µ (–≤–Ω–µ—à–Ω–µ–º—É –±–ª–æ–∫—É –∏–ª–∏ –∫–ª–∏–µ–Ω—Ç—É).

–ü—Ä–∏–º–µ—Ä –±–∞–∑–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:

```plpgsql
DO $$ 
BEGIN
   -- –ö–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –æ—à–∏–±–∫—É
   INSERT INTO products (id, name) VALUES (1, 'Product A');

EXCEPTION
   WHEN unique_violation THEN
      RAISE NOTICE '–û—à–∏–±–∫–∞: —Ç–∞–∫–æ–π ID —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!';
   WHEN others THEN
      RAISE NOTICE '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞!';
END $$;
```

üí° **–í–∞–∂–Ω–æ:**

- **–û–ø–µ—Ä–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ `BEGIN` –±—É–¥—É—Ç –æ—Ç–º–µ–Ω–µ–Ω—ã, –µ—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞.**
- **–ö–æ–º–∞–Ω–¥—ã `COMMIT` –∏ `ROLLBACK` –∑–∞–ø—Ä–µ—â–µ–Ω—ã –≤–Ω—É—Ç—Ä–∏ `EXCEPTION`**, —Ç–∞–∫ –∫–∞–∫ —Ç–æ—á–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

---

### **2.2 –ß—Ç–æ —Ç–∞–∫–æ–µ —Ç–æ—á–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (`SAVEPOINT`)?**

–ö–æ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è `BEGIN ... EXCEPTION`, PostgreSQL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–æ—á–∫—É –æ—Ç–∫–∞—Ç–∞ (Savepoint).

- –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, **–≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–∞–º–∫–∞—Ö –±–ª–æ–∫–∞ –æ—Ç–º–µ–Ω—è—é—Ç—Å—è**.
- **–û—Å—Ç–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω–æ–π**.

#### **–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `SAVEPOINT` –≤—Ä—É—á–Ω—É—é**

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å **—Ç–æ–ª—å–∫–æ —á–∞—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `SAVEPOINT`:

```plpgsql
BEGIN;
SAVEPOINT my_savepoint;

INSERT INTO products (id, name) VALUES (1, 'Product A');

-- –í—Ä—É—á–Ω—É—é –æ—Ç–∫–∞—Ç—ã–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è, –Ω–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è
ROLLBACK TO SAVEPOINT my_savepoint;

-- –î—Ä—É–≥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
INSERT INTO products (id, name) VALUES (2, 'Product B');
COMMIT;
```

üìå **–†–∞–∑–Ω–∏—Ü–∞ —Å `EXCEPTION`**

- –í `EXCEPTION` PostgreSQL —Å–∞–º —Å–æ–∑–¥–∞–µ—Ç `SAVEPOINT` –∏ **–æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ**.
- –ï—Å–ª–∏ `SAVEPOINT` —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é, **–µ–≥–æ –º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å –≤—ã–±–æ—Ä–æ—á–Ω–æ**.

üí° **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `EXCEPTION` = –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç**.  
üí° **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `SAVEPOINT` –≤—Ä—É—á–Ω—É—é = –∫–æ–Ω—Ç—Ä–æ–ª—å –æ—Ç–∫–∞—Ç–æ–≤ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**.

---

### **2.3 –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –æ—à–∏–±–æ–∫ —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏**

–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—à–∏–±–æ–∫ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

6. **–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –≤ `EXCEPTION`**, PostgreSQL –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∫–æ–¥ –≤–Ω—É—Ç—Ä–∏ `BEGIN`.
7. **–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞**, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è **—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π** (—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ).
8. **–ï—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∞**, –ª—é–±—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤—ã–¥–∞–¥—É—Ç –æ—à–∏–±–∫—É, –ø–æ–∫–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω `ROLLBACK` –∏–ª–∏ `COMMIT`.

#### **–ü—Ä–∏–º–µ—Ä –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**

```plpgsql
BEGIN;
DELETE FROM orders WHERE id = 1;

-- –û—à–∏–±–∫–∞ –Ω–∞—Ä—É—à–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
INSERT INTO orders (id, amount) VALUES (1, 100); -- –ù–∞—Ä—É—à–µ–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏

-- –õ—é–±–∞—è –∫–æ–º–∞–Ω–¥–∞ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏ —Å–ª–æ–º–∞–µ—Ç—Å—è!
UPDATE orders SET amount = 200 WHERE id = 1; -- –û—à–∏–±–∫–∞!

-- –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã—Ö–æ–¥ ‚Äî —è–≤–Ω—ã–π ROLLBACK –∏–ª–∏ COMMIT
ROLLBACK;
```

üí° **–í—ã–≤–æ–¥:**

- –ï—Å–ª–∏ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞, **–µ—ë –Ω–µ–ª—å–∑—è –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å** –±–µ–∑ `ROLLBACK`.
- –í `BEGIN ... EXCEPTION` PostgreSQL **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç** –∏–∑–º–µ–Ω–µ–Ω–∏—è, –Ω–æ **–Ω–µ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –≤—Å—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é**.

---

### **2.4 –ö–∞–∫ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–∫–∏?**

–ö–æ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—à–∏–±–∫–∞:

9. PostgreSQL **–∏—â–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ —Ç–µ–∫—É—â–µ–º –±–ª–æ–∫–µ `EXCEPTION`**.
10. –ï—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω, –æ—à–∏–±–∫–∞ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è **–≤–Ω–µ—à–Ω–µ–º—É –±–ª–æ–∫—É**.
11. –ï—Å–ª–∏ –Ω–∏ –æ–¥–∏–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω, **–æ—à–∏–±–∫–∞ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—É**.

#### **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫**

- **–ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø–æ–¥—Ö–æ–¥—è—Ç, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–µ—Ä–≤—ã–π –Ω–∞–π–¥–µ–Ω–Ω—ã–π.**
- **–û–±—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `WHEN OTHERS`** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫—Ä–∞–π–Ω–µ–º —Å–ª—É—á–∞–µ.

–ü—Ä–∏–º–µ—Ä:

```plpgsql
DO $$ 
BEGIN
   -- –û—à–∏–±–∫–∞ –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å
   SELECT 1 / 0;
   
EXCEPTION
   WHEN division_by_zero THEN
      RAISE NOTICE '–ü–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–æ –¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å!';
   WHEN others THEN
      RAISE NOTICE '–ü–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–∞ –¥—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞!';
END $$;
```

üí° **–í—ã–≤–æ–¥:**

- –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø–æ–¥—Ö–æ–¥—è—Ç, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **—Å–∞–º—ã–π –≤–µ—Ä—Ö–Ω–∏–π**.
- `WHEN OTHERS` **–ª–æ–≤–∏—Ç –≤—Å—ë**, –Ω–æ **–µ–≥–æ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫—Ä–∞–π–Ω–µ–º —Å–ª—É—á–∞–µ**.

---

### **2.5 –û—à–∏–±–∫–∏ –≤ `DECLARE` –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö –æ—à–∏–±–æ–∫**

–û—à–∏–±–∫–∏ –≤ —Å–µ–∫—Ü–∏–∏ `DECLARE` –∏ –≤–Ω—É—Ç—Ä–∏ `EXCEPTION` **–Ω–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç—Å—è** —Å–∞–º–∏–º –±–ª–æ–∫–æ–º.

- –ö–æ–¥ –≤ `DECLARE` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–¥–æ –≤—Ö–æ–¥–∞ –≤ `BEGIN`**, –ø–æ—ç—Ç–æ–º—É –æ—à–∏–±–∫–∏ —Ç–∞–º **–Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã**.
- –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ **–≤–æ–∑–Ω–∏–∫–∞–µ—Ç –≤–Ω—É—Ç—Ä–∏ `EXCEPTION`**, –æ–Ω–∞ **–Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–∞**.

–ü—Ä–∏–º–µ—Ä –æ—à–∏–±–∫–∏ –≤ `DECLARE`:

```plpgsql
DO $$ 
DECLARE x INT := 1 / 0; -- –û—à–∏–±–∫–∞ –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å!
BEGIN
   RAISE NOTICE '–≠—Ç–æ—Ç –∫–æ–¥ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è';
EXCEPTION
   WHEN division_by_zero THEN
      RAISE NOTICE '–ü–µ—Ä–µ—Ö–≤–∞—Ç –æ—à–∏–±–∫–∏!';
END $$;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**  
‚õî –û—à–∏–±–∫–∞ `division_by_zero` –Ω–µ –±—É–¥–µ—Ç –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–∞, —Ç–∞–∫ –∫–∞–∫ –≤–æ–∑–Ω–∏–∫–ª–∞ **–¥–æ –≤—Ö–æ–¥–∞ –≤ `BEGIN`**.

–ü—Ä–∏–º–µ—Ä –æ—à–∏–±–∫–∏ –≤ `EXCEPTION`:

```plpgsql
DO $$ 
BEGIN
   -- –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞
   RAISE EXCEPTION '–û—à–∏–±–∫–∞!';
   
EXCEPTION
   WHEN others THEN
      -- –û—à–∏–±–∫–∞ –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ
      SELECT 1 / 0; 
END $$;
```

‚õî **–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- –û—à–∏–±–∫–∞ –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å **–Ω–µ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞**, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤–æ–∑–Ω–∏–∫–ª–∞ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ.

üí° **–í—ã–≤–æ–¥:**

- **–û—à–∏–±–∫–∞ –≤ `DECLARE` –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è.**
- **–û—à–∏–±–∫–∞ –≤ `EXCEPTION` –ª–æ–º–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤—ã—à–µ.**

---

### **2.6 –ü–æ—á–µ–º—É `COMMIT` –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ `EXCEPTION`?**

–í–Ω—É—Ç—Ä–∏ `BEGIN ... EXCEPTION` –Ω–µ–ª—å–∑—è –≤—ã–ø–æ–ª–Ω—è—Ç—å `COMMIT`, –ø–æ—Ç–æ–º—É —á—Ç–æ:

12. PostgreSQL **—É–∂–µ —Å–æ–∑–¥–∞–ª `SAVEPOINT`** –≤ –Ω–∞—á–∞–ª–µ –±–ª–æ–∫–∞.
13. `COMMIT` **—Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –≤—Å—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é**, –Ω–æ –≤–Ω—É—Ç—Ä–∏ `EXCEPTION` —ç—Ç–æ –∑–∞–ø—Ä–µ—â–µ–Ω–æ.
14. –û—à–∏–±–∫–∞ **–Ω–µ –¥–æ–ª–∂–Ω–∞ –º–µ—à–∞—Ç—å –æ–±—â–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**, –ø–æ—ç—Ç–æ–º—É `SAVEPOINT` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ `COMMIT`.

–ü—Ä–∏–º–µ—Ä –æ—à–∏–±–∫–∏ —Å `COMMIT`:

```plpgsql
DO $$ 
BEGIN
   -- –í—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
   INSERT INTO orders (id, amount) VALUES (1, 100);
   
EXCEPTION
   WHEN unique_violation THEN
      COMMIT; -- –û—à–∏–±–∫–∞!
END $$;
```

‚õî **–†–µ–∑—É–ª—å—Ç–∞—Ç:**

```
ERROR:  COMMIT is not allowed in a subtransaction
```

üí° **–í—ã–≤–æ–¥:**

- `COMMIT` –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–∏ `EXCEPTION`.
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–∫–æ–º–º–∏—Ç –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫**.

‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–±**:

```plpgsql
BEGIN;
BEGIN
   INSERT INTO orders (id, amount) VALUES (1, 100);
EXCEPTION
   WHEN unique_violation THEN
      RAISE NOTICE '–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞!';
END;
COMMIT;
```

üöÄ **–í–µ—Å—å –±–ª–æ–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –Ω–æ –æ—à–∏–±–∫–∏ –≤–Ω—É—Ç—Ä–∏ `BEGIN` –Ω–µ –ª–æ–º–∞—é—Ç –æ–±—â—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é.**

---

## **–ó–∞–∫–ª—é—á–µ–Ω–∏–µ –≤—Ç–æ—Ä–æ–π —á–∞—Å—Ç–∏**

–í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –º—ã —Ä–∞–∑–æ–±—Ä–∞–ª–∏:

- –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `BEGIN ... EXCEPTION`.
- –ß—Ç–æ —Ç–∞–∫–æ–µ `SAVEPOINT` –∏ –∫–∞–∫ –æ–Ω –≤–ª–∏—è–µ—Ç –Ω–∞ –æ—à–∏–±–∫–∏.
- –ö–∞–∫ PostgreSQL –≤—ã–±–∏—Ä–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–∫–∏.
- –ü–æ—á–µ–º—É `COMMIT` –∑–∞–ø—Ä–µ—â–µ–Ω –≤–Ω—É—Ç—Ä–∏ `EXCEPTION`.
- –ö–∞–∫ –æ—à–∏–±–∫–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –ø–æ —Å—Ç–µ–∫—É –≤—ã–∑–æ–≤–æ–≤.

---

## **–°–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:**

üöÄ **3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –ø—Ä–∏–º–µ—Ä—ã –∏–º–µ–Ω –æ—à–∏–±–æ–∫**  
–ë—É–¥–µ–º —Ä–∞–∑–±–∏—Ä–∞—Ç—å:

- –ö–∞–∫ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –∏–º–µ–Ω–∞ –∏ –∫–æ–¥—ã –æ—à–∏–±–æ–∫.
- –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `GET DIAGNOSTICS`.
- –ü–µ—Ä–µ—Ö–≤–∞—Ç –æ—à–∏–±–æ–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º.

‚ö° –ó–∞–ø—Ä–∞—à–∏–≤–∞–π —Ç—Ä–µ—Ç—å—é —á–∞—Å—Ç—å, –∏ —è –ø–æ–¥–≥–æ—Ç–æ–≤–ª—é –µ—ë —Ç–∞–∫ –∂–µ –ø–æ–¥—Ä–æ–±–Ω–æ!

