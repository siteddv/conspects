# **–ö–æ–Ω—Å–ø–µ–∫—Ç –≤–∏–¥–µ–æ: –ß–∞—Å—Ç—å 5 ‚Äì –¶–∏–∫–ª—ã –≤ PL/pgSQL**

## **5.1. –í–≤–µ–¥–µ–Ω–∏–µ –≤ —Ü–∏–∫–ª—ã**

–¶–∏–∫–ª—ã –≤ **PL/pgSQL** –ø–æ–∑–≤–æ–ª—è—é—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å **–ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –æ–ø–µ—Ä–∞—Ü–∏–∏**.  
–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç—Ä–∏ —Ç–∏–ø–∞ —Ü–∏–∫–ª–æ–≤:

1. **`FOR`** ‚Äì —Ü–∏–∫–ª —Å –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º –∑–Ω–∞—á–µ–Ω–∏–π.
2. **`WHILE`** ‚Äì —Ü–∏–∫–ª —Å —É—Å–ª–æ–≤–∏–µ–º.
3. **`LOOP`** ‚Äì –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª —Å —è–≤–Ω—ã–º –≤—ã—Ö–æ–¥–æ–º.

‚úÖ **–¶–∏–∫–ª—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è:**

- –ü–µ—Ä–µ–±–æ—Ä–∞ –∑–Ω–∞—á–µ–Ω–∏–π.
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π, –ø–æ–∫–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è —É—Å–ª–æ–≤–∏–µ.
- –°–æ–∑–¥–∞–Ω–∏—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤.

---

## **5.2. –¶–∏–∫–ª `FOR` (–ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É –∑–Ω–∞—á–µ–Ω–∏–π)**

–¶–∏–∫–ª `FOR` –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è **–≤ –∑–∞–¥–∞–Ω–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ**.

### **–°–∏–Ω—Ç–∞–∫—Å–∏—Å:**

```sql
FOR –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è IN –Ω–∞—á–∞–ª—å–Ω–æ–µ_–∑–Ω–∞—á–µ–Ω–∏–µ..–∫–æ–Ω–µ—á–Ω–æ–µ_–∑–Ω–∞—á–µ–Ω–∏–µ LOOP
  -- –î–µ–π—Å—Ç–≤–∏—è –≤–Ω—É—Ç—Ä–∏ —Ü–∏–∫–ª–∞
END LOOP;
```

- –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è **—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –≤–Ω—É—Ç—Ä–∏ `FOR`.
- `..` –æ–∑–Ω–∞—á–∞–µ—Ç **–æ—Ç –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –¥–æ –∫–æ–Ω–µ—á–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è**.
- –ó–Ω–∞—á–µ–Ω–∏–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è **–Ω–∞ 1** (–º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –¥—Ä—É–≥–æ–π —à–∞–≥).

---

### **–ü—Ä–∏–º–µ—Ä: –ü–µ—Ä–µ–±–æ—Ä —á–∏—Å–µ–ª –æ—Ç 1 –¥–æ 5**

```sql
DO $$
BEGIN
  FOR i IN 1..5 LOOP
    RAISE NOTICE '–ß–∏—Å–ª–æ: %', i;
  END LOOP;
END $$;
```

‚úÖ **–í—ã—Ö–æ–¥:**

```
–ß–∏—Å–ª–æ: 1
–ß–∏—Å–ª–æ: 2
–ß–∏—Å–ª–æ: 3
–ß–∏—Å–ª–æ: 4
–ß–∏—Å–ª–æ: 5
```

---

### **5.2.1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `REVERSE` (–ø–µ—Ä–µ–±–æ—Ä –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ)**

```sql
DO $$
BEGIN
  FOR i IN REVERSE 5..1 LOOP
    RAISE NOTICE '–û–±—Ä–∞—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫: %', i;
  END LOOP;
END $$;
```

‚úÖ **–í—ã—Ö–æ–¥:**

```
–û–±—Ä–∞—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫: 5
–û–±—Ä–∞—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫: 4
–û–±—Ä–∞—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫: 3
–û–±—Ä–∞—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫: 2
–û–±—Ä–∞—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫: 1
```

---

### **5.2.2. –¶–∏–∫–ª `FOR` —Å —à–∞–≥–æ–º (–∏–∑–º–µ–Ω–µ–Ω–∏–µ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞)**

–ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å —à–∞–≥ —Å –ø–æ–º–æ—â—å—é `BY`.

```sql
FOR –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è IN –Ω–∞—á–∞–ª—å–Ω–æ–µ_–∑–Ω–∞—á–µ–Ω–∏–µ..–∫–æ–Ω–µ—á–Ω–æ–µ_–∑–Ω–∞—á–µ–Ω–∏–µ BY —à–∞–≥ LOOP
```

**–ü—Ä–∏–º–µ—Ä (–≤—ã–≤–æ–¥–∏—Ç—å —Ç–æ–ª—å–∫–æ —á–µ—Ç–Ω—ã–µ —á–∏—Å–ª–∞):**

```sql
DO $$
BEGIN
  FOR i IN 2..10 BY 2 LOOP
    RAISE NOTICE '–ß–µ—Ç–Ω–æ–µ —á–∏—Å–ª–æ: %', i;
  END LOOP;
END $$;
```

‚úÖ **–í—ã—Ö–æ–¥:**

```
–ß–µ—Ç–Ω–æ–µ —á–∏—Å–ª–æ: 2
–ß–µ—Ç–Ω–æ–µ —á–∏—Å–ª–æ: 4
–ß–µ—Ç–Ω–æ–µ —á–∏—Å–ª–æ: 6
–ß–µ—Ç–Ω–æ–µ —á–∏—Å–ª–æ: 8
–ß–µ—Ç–Ω–æ–µ —á–∏—Å–ª–æ: 10
```

---

## **5.3. –¶–∏–∫–ª `WHILE` (–ø–æ–∫–∞ —É—Å–ª–æ–≤–∏–µ –∏—Å—Ç–∏–Ω–Ω–æ)**

–¶–∏–∫–ª –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–ø–æ–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —É—Å–ª–æ–≤–∏–µ**.

### **–°–∏–Ω—Ç–∞–∫—Å–∏—Å:**

```sql
WHILE —É—Å–ª–æ–≤–∏–µ LOOP
  -- –î–µ–π—Å—Ç–≤–∏—è –≤–Ω—É—Ç—Ä–∏ —Ü–∏–∫–ª–∞
END LOOP;
```

### **–ü—Ä–∏–º–µ—Ä: –ü–µ—Ä–µ–±–æ—Ä –∑–Ω–∞—á–µ–Ω–∏–π —Å `WHILE`**

```sql
DO $$
DECLARE
  i INTEGER := 1;
BEGIN
  WHILE i <= 5 LOOP
    RAISE NOTICE 'WHILE: %', i;
    i := i + 1;
  END LOOP;
END $$;
```

‚úÖ **–í—ã—Ö–æ–¥:**

```
WHILE: 1
WHILE: 2
WHILE: 3
WHILE: 4
WHILE: 5
```

‚úÖ **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

- –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `i` **–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∞ –∑–∞—Ä–∞–Ω–µ–µ**.
- –¶–∏–∫–ª –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –ø–æ–∫–∞ `i <= 5`.
- –í –∫–æ–Ω—Ü–µ –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ **`i := i + 1;`** —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ.

---

## **5.4. –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª `LOOP` (—è–≤–Ω—ã–π –≤—ã—Ö–æ–¥ `EXIT`)**

`LOOP` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–±–µ—Å–∫–æ–Ω–µ—á–Ω–æ**, –ø–æ–∫–∞ –Ω–µ –±—É–¥–µ—Ç `EXIT`.

### **–°–∏–Ω—Ç–∞–∫—Å–∏—Å:**

```sql
LOOP
  -- –î–µ–π—Å—Ç–≤–∏—è
  EXIT WHEN —É—Å–ª–æ–≤–∏–µ;
END LOOP;
```

### **–ü—Ä–∏–º–µ—Ä: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `EXIT`**

```sql
DO $$
DECLARE
  counter INTEGER := 1;
BEGIN
  LOOP
    RAISE NOTICE 'LOOP: %', counter;
    counter := counter + 1;

    EXIT WHEN counter > 5;  -- –í—ã—Ö–æ–¥ –∏–∑ —Ü–∏–∫–ª–∞, –µ—Å–ª–∏ counter > 5
  END LOOP;
END $$;
```

‚úÖ **–í—ã—Ö–æ–¥:**

```
LOOP: 1
LOOP: 2
LOOP: 3
LOOP: 4
LOOP: 5
```

‚úÖ **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

- `LOOP` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–¥–æ –≤—ã–∑–æ–≤–∞ `EXIT`**.
- `EXIT WHEN` –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –µ—Å–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ —É—Å–ª–æ–≤–∏–µ.

---

## **5.5. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Ç–µ—Ä–∞—Ü–∏—è–º–∏ (`EXIT` –∏ `CONTINUE`)**

–í —Ü–∏–∫–ª–∞—Ö –º–æ–∂–Ω–æ **–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤—ã—Ö–æ–¥–∏—Ç—å (`EXIT`)** –∏–ª–∏ **–ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –∏—Ç–µ—Ä–∞—Ü–∏–∏ (`CONTINUE`)**.

### **5.5.1. `EXIT` (–≤—ã—Ö–æ–¥ –∏–∑ —Ü–∏–∫–ª–∞)**

```sql
EXIT [WHEN —É—Å–ª–æ–≤–∏–µ];
```

**–ü—Ä–∏–º–µ—Ä: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ü–∏–∫–ª–∞ –ø—Ä–∏ `i = 3`**

```sql
DO $$
BEGIN
  FOR i IN 1..5 LOOP
    EXIT WHEN i = 3;
    RAISE NOTICE 'EXIT: %', i;
  END LOOP;
END $$;
```

‚úÖ **–í—ã—Ö–æ–¥:**

```
EXIT: 1
EXIT: 2
```

‚úÖ **–¶–∏–∫–ª –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ `i = 3`**.

---

### **5.5.2. `CONTINUE` (–ø—Ä–æ–ø—É—Å–∫ –∏—Ç–µ—Ä–∞—Ü–∏–∏)**

```sql
CONTINUE [WHEN —É—Å–ª–æ–≤–∏–µ];
```

**–ü—Ä–∏–º–µ—Ä: –ü—Ä–æ–ø—É—Å–∫ —á–µ—Ç–Ω—ã—Ö —á–∏—Å–µ–ª**

```sql
DO $$
BEGIN
  FOR i IN 1..5 LOOP
    CONTINUE WHEN i % 2 = 0;
    RAISE NOTICE 'CONTINUE: %', i;
  END LOOP;
END $$;
```

‚úÖ **–í—ã—Ö–æ–¥:**

```
CONTINUE: 1
CONTINUE: 3
CONTINUE: 5
```

‚úÖ **–ß–µ—Ç–Ω—ã–µ —á–∏—Å–ª–∞ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è.**

---

## **5.6. –í–ª–æ–∂–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã**

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **—Ü–∏–∫–ª—ã –≤–Ω—É—Ç—Ä–∏ —Ü–∏–∫–ª–æ–≤**.

**–ü—Ä–∏–º–µ—Ä: –¢–∞–±–ª–∏—Ü–∞ —É–º–Ω–æ–∂–µ–Ω–∏—è 1-3**

```sql
DO $$
BEGIN
  FOR i IN 1..3 LOOP
    FOR j IN 1..3 LOOP
      RAISE NOTICE '% x % = %', i, j, i*j;
    END LOOP;
  END LOOP;
END $$;
```

‚úÖ **–í—ã—Ö–æ–¥:**

```
1 x 1 = 1
1 x 2 = 2
1 x 3 = 3
2 x 1 = 2
...
```

‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `FOR` –≤–Ω—É—Ç—Ä–∏ `FOR`.**

---

## **–í—ã–≤–æ–¥ –ø–æ —á–∞—Å—Ç–∏ 5:**

- **–¶–∏–∫–ª `FOR`** —É–¥–æ–±–µ–Ω –¥–ª—è **–ø–µ—Ä–µ–±–æ—Ä–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤**.
- **–¶–∏–∫–ª `WHILE`** –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –ø–æ–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —É—Å–ª–æ–≤–∏–µ.
- **–¶–∏–∫–ª `LOOP`** —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ, –ø–æ–∫–∞ **–Ω–µ –±—É–¥–µ—Ç `EXIT`**.
- **`EXIT`** –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ü–∏–∫–ª, **`CONTINUE`** –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –∏—Ç–µ—Ä–∞—Ü–∏—é.
- **–ú–æ–∂–Ω–æ –≤–∫–ª–∞–¥—ã–≤–∞—Ç—å —Ü–∏–∫–ª—ã** (`FOR` –≤–Ω—É—Ç—Ä–∏ `FOR`).

‚è≠ **–°–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å** ‚Äì **–í—ã—á–∏—Å–ª–µ–Ω–∏—è –≤—ã—Ä–∞–∂–µ–Ω–∏–π –≤ PL/pgSQL** (–∫–∞–∫ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–π –≤ SQL-–∑–∞–ø—Ä–æ—Å—ã). –ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å? üöÄ

