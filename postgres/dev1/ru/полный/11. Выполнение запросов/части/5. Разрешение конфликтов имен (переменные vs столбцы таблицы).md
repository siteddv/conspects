### **–ß–∞—Å—Ç—å 5: –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏–º–µ–Ω –≤ PL/pgSQL**

–í —ç—Ç–æ–π —á–∞—Å—Ç–∏ —Ä–∞–∑–±–∏—Ä–∞—é—Ç—Å—è:

- **–ß—Ç–æ —Ç–∞–∫–æ–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç –∏–º–µ–Ω –≤ PL/pgSQL –∏ –ø–æ—á–µ–º—É –æ–Ω –≤–æ–∑–Ω–∏–∫–∞–µ—Ç**
- **–ö–∞–∫ PostgreSQL –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∏–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –∏–ª–∏ —Å—Ç–æ–ª–±—Ü–æ–º —Ç–∞–±–ª–∏—Ü—ã**
- **–°–ø–æ—Å–æ–±—ã —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏–º–µ–Ω**
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `ALIAS`, –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤, –∏ –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–º–µ–Ω**
- **–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã PostgreSQL (`plpgsql.variable_conflict`)**

---

## **1. –ß—Ç–æ —Ç–∞–∫–æ–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç –∏–º–µ–Ω –≤ PL/pgSQL?**

–ö–æ–Ω—Ñ–ª–∏–∫—Ç –∏–º–µ–Ω –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –∫–æ–≥–¥–∞ –≤ –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è** –¥–ª—è:

- **–õ–æ–∫–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π**
- **–°—Ç–æ–ª–±—Ü–∞ —Ç–∞–±–ª–∏—Ü—ã**

üìå **–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –∏–º–µ–Ω:**

```plpgsql
DECLARE 
    id INT;
BEGIN
    SELECT id INTO id FROM users WHERE id = 5;  -- –û—à–∏–±–∫–∞! id –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–∞–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, —Ç–∞–∫ –∏ —Å—Ç–æ–ª–±—Ü–æ–º
END;
```

–í —ç—Ç–æ–º –∫–æ–¥–µ **PL/pgSQL –Ω–µ –∑–Ω–∞–µ—Ç, –∫ –∫–∞–∫–æ–º—É `id` –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è** ‚Äì –∫ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –∏–ª–∏ –∫ —Å—Ç–æ–ª–±—Ü—É —Ç–∞–±–ª–∏—Ü—ã.  
–≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –æ—à–∏–±–∫–µ **"column reference is ambiguous" (–Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ–ª–æ–Ω–∫—É)**.

---

## **2. –ö–∞–∫ PostgreSQL —Ä–µ—à–∞–µ—Ç, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –∏–ª–∏ —Å—Ç–æ–ª–±–µ—Ü?**

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é PostgreSQL –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç **–ø–µ—Ä–µ–º–µ–Ω–Ω—É—é**, –µ—Å–ª–∏ –æ–Ω–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç –ø–æ –∏–º–µ–Ω–∏ —Å–æ —Å—Ç–æ–ª–±—Ü–æ–º.

üìå –ù–∞–ø—Ä–∏–º–µ—Ä:

```plpgsql
DECLARE 
    id INT := 10;
BEGIN
    UPDATE users SET id = id + 1 WHERE id = 5;
END;
```

PostgreSQL –ø–æ–Ω–∏–º–∞–µ—Ç —ç—Ç–æ —Ç–∞–∫:

```sql
UPDATE users SET id = –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è_id + 1 WHERE id = 5;
```

üí° **–ü—Ä–∏–º–µ—Ä –æ—à–∏–±–∫–∏:**

```plpgsql
DECLARE 
    name TEXT;
BEGIN
    SELECT name INTO name FROM users WHERE id = 5;
END;
```

–û—à–∏–±–∫–∞, –ø–æ—Ç–æ–º—É —á—Ç–æ `name` ‚Äì —ç—Ç–æ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è, –∏ —Å—Ç–æ–ª–±–µ—Ü.

---

## **3. –°–ø–æ—Å–æ–±—ã —Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏–º–µ–Ω**

### ‚úÖ **–°–ø–æ—Å–æ–± 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–º–µ–Ω (`—Ç–∞–±–ª–∏—Ü–∞.—Å—Ç–æ–ª–±–µ—Ü`)**

–°–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–± ‚Äì **—è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å, –æ—Ç–∫—É–¥–∞ –±–µ—Ä–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ**.

```plpgsql
DECLARE 
    user_id INT;
BEGIN
    SELECT users.id INTO user_id FROM users WHERE users.id = 5;
END;
```

üìå **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**  
‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–∫–ª—é—á–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏–º–µ–Ω.  
‚úÖ –ü–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.

---

### ‚úÖ **–°–ø–æ—Å–æ–± 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Å–µ–≤–¥–æ–Ω–∏–º–æ–≤ (`ALIAS`)**

–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å **–ø—Å–µ–≤–¥–æ–Ω–∏–º** (`AS`) –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –≤ –∫–æ–¥–µ.

```plpgsql
DECLARE 
    user_id INT;
BEGIN
    SELECT u.id INTO user_id FROM users u WHERE u.id = 5;
END;
```

üìå **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**  
‚úÖ –ö–æ–¥ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —á–∏—â–µ –∏ –ø–æ–Ω—è—Ç–Ω–µ–µ.  
‚úÖ –ò–∑–±–µ–≥–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏–º–µ–Ω.

---

### ‚úÖ **–°–ø–æ—Å–æ–± 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤ (`_` –∏–ª–∏ `l_`)**

–ï—Å–ª–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ –ø—Ä–∏–Ω—è—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∏–º–µ–Ω–∞, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å **–ø—Ä–µ—Ñ–∏–∫—Å—ã** –∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º:

```plpgsql
DECLARE 
    _id INT;
BEGIN
    SELECT id INTO _id FROM users WHERE id = 5;
END;
```

–ò–ª–∏:

```plpgsql
DECLARE 
    l_id INT;  -- l_ = local
BEGIN
    SELECT id INTO l_id FROM users WHERE id = 5;
END;
```

üìå **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**  
‚úÖ –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –æ—à–∏–±–∫–∏ –≤ –±–æ–ª—å—à–∏—Ö –∫–æ–¥–æ–≤—ã—Ö –±–∞–∑–∞—Ö.  
‚úÖ –•–æ—Ä–æ—à–æ —á–∏—Ç–∞–µ—Ç—Å—è –≤ –∫–æ–¥–µ.  
‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫—Ä—É–ø–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö.

üìå **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫:**  
‚ùå –ù—É–∂–Ω–æ —Å–æ–±–ª—é–¥–∞—Ç—å –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è (–ª—É—á—à–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ ‚Äì –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω —Å—Ç–∏–ª—å –≤–æ –≤—Å–µ–º –∫–æ–¥–µ).

---

### ‚úÖ **–°–ø–æ—Å–æ–± 4: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `plpgsql.variable_conflict`**

PostgreSQL –ø–æ–∑–≤–æ–ª—è–µ—Ç **–≥–ª–æ–±–∞–ª—å–Ω–æ –∑–∞–¥–∞—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–ª–∏ —Å—Ç–æ–ª–±—Ü–æ–≤**.

üìå **–ü–∞—Ä–∞–º–µ—Ç—Ä `plpgsql.variable_conflict`**

- `plpgsql.variable_conflict = use_variable` ‚Äì **–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**.
- `plpgsql.variable_conflict = use_column` ‚Äì **—Å—Ç–æ–ª–±—Ü—ã —Ç–∞–±–ª–∏—Ü—ã –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**.
- `plpgsql.variable_conflict = error` ‚Äì **–≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –ø—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ –∏–º–µ–Ω**.

üìå **–ü—Ä–∏–º–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞:**

```sql
SET plpgsql.variable_conflict = use_column;
```

üí° –¢–µ–ø–µ—Ä—å PostgreSQL –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **—Å—Ç–æ–ª–±—Ü—ã —Ç–∞–±–ª–∏—Ü** –ø—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –∏–º–µ–Ω.

üìå **–õ—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç** ‚Äì `plpgsql.variable_conflict = error`, —á—Ç–æ–±—ã –Ω–µ –¥–æ–ø—É—Å–∫–∞—Ç—å –Ω–µ—è–≤–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è.

```sql
SET plpgsql.variable_conflict = error;
```

–¢–æ–≥–¥–∞ –≤ —Å–ª—É—á–∞–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞, –∏ –≤—ã —Å–º–æ–∂–µ—Ç–µ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥.

---

## **4. –†–∞–∑–±–æ—Ä –æ—à–∏–±–æ–∫, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞–º–∏ –∏–º–µ–Ω**

üìå **–û—à–∏–±–∫–∞: "column reference is ambiguous"**  
üî¥ –ü—Ä–∏—á–∏–Ω–∞: –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –∏ —Å—Ç–æ–ª–±–µ—Ü –∏–º–µ—é—Ç –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –∏–º—è.  
‚úÖ **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `—Ç–∞–±–ª–∏—Ü–∞.—Å—Ç–æ–ª–±–µ—Ü` –∏–ª–∏ `–ø—Å–µ–≤–¥–æ–Ω–∏–º—ã`.

üìå **–û—à–∏–±–∫–∞: "variable conflicts with column name"**  
üî¥ –ü—Ä–∏—á–∏–Ω–∞: PostgreSQL –Ω–µ –º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.  
‚úÖ **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `plpgsql.variable_conflict = error` –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º.

üìå **–û—à–∏–±–∫–∞: "record variable has no field"**  
üî¥ –ü—Ä–∏—á–∏–Ω–∞: –ü–æ–ø—ã—Ç–∫–∞ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ —Å—Ç–æ–ª–±—Ü—É, –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ—Ç –≤ `RECORD`.  
‚úÖ **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ROWTYPE` –∏–ª–∏ —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å `RECORD.–ø–æ–ª–µ`.

---

## **5. –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –ø—Ä–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏–º–µ–Ω**

‚úÖ **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `—Ç–∞–±–ª–∏—Ü–∞.—Å—Ç–æ–ª–±–µ—Ü`, –µ—Å–ª–∏ –æ–±—Ä–∞—â–∞–µ—Ç–µ—Å—å –∫ –¥–∞–Ω–Ω—ã–º.**  
‚úÖ **–î–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ—Ñ–∏–∫—Å—ã (`_id`, `l_name`, `v_counter`).**  
‚úÖ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `plpgsql.variable_conflict = error`, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –æ—à–∏–±–∫—É.**  
‚úÖ **–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Å–µ–≤–¥–æ–Ω–∏–º—ã (`users u`).**

üìå **–ü—Ä–∏–º–µ—Ä –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞:**

```plpgsql
DECLARE 
    l_id INT;
BEGIN
    SELECT u.id INTO l_id FROM users u WHERE u.id = 5;
END;
```

–¢–∞–∫–æ–π –∫–æ–¥ **–ø–æ–Ω—è—Ç–µ–Ω, –±–µ–∑–æ–ø–∞—Å–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–æ –≤—Å–µ—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö**.

---

### **–í—ã–≤–æ–¥—ã**

‚úÖ –í PL/pgSQL **–º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç –∏–º–µ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ —Å—Ç–æ–ª–±—Ü–æ–≤ —Ç–∞–±–ª–∏—Ü—ã**.  
‚úÖ PostgreSQL **–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–±–∏—Ä–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** –ø—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –∏–º–µ–Ω.  
‚úÖ **–õ—É—á—à–∏–µ —Å–ø–æ—Å–æ–±—ã —Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞**:

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `—Ç–∞–±–ª–∏—Ü–∞.—Å—Ç–æ–ª–±–µ—Ü`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Å–µ–≤–¥–æ–Ω–∏–º—ã (`ALIAS`)
- –î–æ–±–∞–≤–ª—è—Ç—å –ø—Ä–µ—Ñ–∏–∫—Å—ã (`_id`, `l_id`)
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `plpgsql.variable_conflict = error`

---

–¢–µ–ø–µ—Ä—å –º–æ–∂–µ—à—å –∑–∞–ø—Ä–æ—Å–∏—Ç—å **—à–µ—Å—Ç—É—é —á–∞—Å—Ç—å**, –∏ —è —Ä–∞–∑–±–µ—Ä—É, –∫–∞–∫ –≤ PL/pgSQL –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏. üöÄ

