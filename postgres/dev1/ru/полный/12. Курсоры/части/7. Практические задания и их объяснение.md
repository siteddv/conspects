### **–ü–æ–¥—Ä–æ–±–Ω—ã–π –∫–æ–Ω—Å–ø–µ–∫—Ç —Å–µ–¥—å–º–æ–π —á–∞—Å—Ç–∏: –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è –∏ –∏—Ö –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ**

---

### **7.1. –ó–∞–¥–∞–Ω–∏–µ 1: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∞–≤—Ç–æ—Ä–æ–≤ –∫–Ω–∏–≥**

#### **–£—Å–ª–æ–≤–∏–µ:**

–ù–∞–ø–∏—Å–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç **ID –∫–Ω–∏–≥–∏** –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **—Å–ø–∏—Å–æ–∫ –∞–≤—Ç–æ—Ä–æ–≤** –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏.

- –ï—Å–ª–∏ —É –∫–Ω–∏–≥–∏ **–æ–¥–∏–Ω –∞–≤—Ç–æ—Ä** ‚Üí –≤–µ—Ä–Ω—É—Ç—å –µ–≥–æ –∏–º—è.
- –ï—Å–ª–∏ **–¥–≤–∞ –∞–≤—Ç–æ—Ä–∞** ‚Üí –≤–µ—Ä–Ω—É—Ç—å –¥–≤–∞ –∏–º–µ–Ω–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é.
- –ï—Å–ª–∏ **—Ç—Ä–∏ –∏ –±–æ–ª–µ–µ –∞–≤—Ç–æ—Ä–æ–≤** ‚Üí –≤–µ—Ä–Ω—É—Ç—å **–ø–µ—Ä–≤—ã–µ –¥–≤–∞ –∏–º–µ–Ω–∏ + "–∏ –¥—Ä—É–≥–∏–µ"**.

---

#### **–†–µ—à–µ–Ω–∏–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫—É—Ä—Å–æ—Ä–∞ (`PL/pgSQL`):**

```sql
CREATE OR REPLACE FUNCTION format_authors(book_id INT) RETURNS TEXT AS $$
DECLARE
    author_cursor CURSOR FOR 
        SELECT name FROM authors WHERE book_id = format_authors.book_id;
    author_name TEXT;
    author_list TEXT := '';
    count INT := 0;
BEGIN
    OPEN author_cursor;
    
    LOOP
        FETCH author_cursor INTO author_name;
        EXIT WHEN NOT FOUND;
        
        count := count + 1;
        
        IF count <= 2 THEN
            IF author_list <> '' THEN
                author_list := author_list || ', ';
            END IF;
            author_list := author_list || author_name;
        END IF;
    END LOOP;
    
    CLOSE author_cursor;
    
    IF count > 2 THEN
        author_list := author_list || ' –∏ –¥—Ä—É–≥–∏–µ';
    END IF;

    RETURN author_list;
END;
$$ LANGUAGE plpgsql;
```

üìå **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?**

1. **–û—Ç–∫—Ä—ã–≤–∞–µ–º –∫—É—Ä—Å–æ—Ä**, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–±–∏—Ä–∞–µ—Ç –∞–≤—Ç–æ—Ä–æ–≤ –¥–ª—è –¥–∞–Ω–Ω–æ–π –∫–Ω–∏–≥–∏.
2. **–¶–∏–∫–ª–æ–º `LOOP FETCH`** –ø–µ—Ä–µ–±–∏—Ä–∞–µ–º —Å—Ç—Ä–æ–∫–∏ –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ `author_list`.
3. **–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –¥–æ –¥–≤—É—Ö –∞–≤—Ç–æ—Ä–æ–≤**, –∞ –µ—Å–ª–∏ –∏—Ö –±–æ–ª—å—à–µ, –¥–æ–±–∞–≤–ª—è–µ–º `"–∏ –¥—Ä—É–≥–∏–µ"`.
4. **–í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∞–≤—Ç–æ—Ä–æ–≤**.

---

#### **–†–µ—à–µ–Ω–∏–µ –Ω–∞ —á–∏—Å—Ç–æ–º SQL (`WITH RECURSIVE`):**

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ, –∑–∞–¥–∞—á—É –º–æ–∂–Ω–æ —Ä–µ—à–∏—Ç—å **–±–µ–∑ –∫—É—Ä—Å–æ—Ä–æ–≤**, –∏—Å–ø–æ–ª—å–∑—É—è **—Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π CTE**:

```sql
WITH author_list AS (
    SELECT name FROM authors WHERE book_id = 123 LIMIT 2
)
SELECT STRING_AGG(name, ', ') || 
       CASE WHEN (SELECT COUNT(*) FROM authors WHERE book_id = 123) > 2 THEN ' –∏ –¥—Ä—É–≥–∏–µ' ELSE '' END
FROM author_list;
```

üí° **–ö–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –ª—É—á—à–µ?**

|**–ú–µ—Ç–æ–¥**|**–ü–ª—é—Å—ã**|**–ú–∏–Ω—É—Å—ã**|
|---|---|---|
|**PL/pgSQL (–ö—É—Ä—Å–æ—Ä—ã)**|–ì–∏–±–∫–æ—Å—Ç—å, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Å–ª–æ–∂–Ω—ã—Ö –ª–æ–≥–∏–∫–∞—Ö|–ú–µ–¥–ª–µ–Ω–Ω–µ–µ, –±–æ–ª—å—à–µ –∫–æ–¥–∞|
|**–ß–∏—Å—Ç—ã–π SQL (`STRING_AGG`)**|–ë—ã—Å—Ç—Ä–µ–µ, –∫–æ—Ä–æ—á–µ|–ù–µ –≤—Å–µ–≥–¥–∞ —É–¥–æ–±–Ω–æ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π|

---

### **7.2. –ó–∞–¥–∞–Ω–∏–µ 2: –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—É–º–º—ã –º–µ–∂–¥—É –æ—Ç–¥–µ–ª–∞–º–∏**

#### **–£—Å–ª–æ–≤–∏–µ:**

–ù–∞–ø–∏—Å–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è **–ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å—É–º–º—É** –∏ **—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç** –µ—ë –º–µ–∂–¥—É —Ç—Ä–µ–º—è –æ—Ç–¥–µ–ª–∞–º–∏.

- –ï—Å–ª–∏ —Å—É–º–º–∞ **–Ω–µ –¥–µ–ª–∏—Ç—Å—è –Ω–∞ 3 –±–µ–∑ –æ—Å—Ç–∞—Ç–∫–∞**, —Ç–æ **–∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –∫–æ–ø–µ–π–∫–∏ —É—Ö–æ–¥—è—Ç –≤ –ø–µ—Ä–≤—ã–π –æ—Ç–¥–µ–ª**.

---

#### **–†–µ—à–µ–Ω–∏–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫—É—Ä—Å–æ—Ä–∞:**

```sql
CREATE OR REPLACE FUNCTION distribute_amount(amount INT) RETURNS VOID AS $$
DECLARE
    dept_cursor CURSOR FOR SELECT id FROM departments;
    dept_id INT;
    base_amount INT;
    extra INT;
    count INT := 0;
BEGIN
    base_amount := amount / 3;
    extra := amount % 3; -- –û—Å—Ç–∞—Ç–æ–∫ –æ—Ç –¥–µ–ª–µ–Ω–∏—è

    OPEN dept_cursor;
    
    LOOP
        FETCH dept_cursor INTO dept_id;
        EXIT WHEN NOT FOUND;

        count := count + 1;

        -- –ü–µ—Ä–≤–æ–º—É –æ—Ç–¥–µ–ª—É –¥–∞–µ–º –æ—Å—Ç–∞—Ç–æ–∫
        IF count = 1 THEN
            UPDATE departments SET budget = budget + base_amount + extra WHERE id = dept_id;
        ELSE
            UPDATE departments SET budget = budget + base_amount WHERE id = dept_id;
        END IF;
    END LOOP;
    
    CLOSE dept_cursor;
END;
$$ LANGUAGE plpgsql;
```

üìå **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?**

1. **–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –±–∞–∑–æ–≤—É—é —Å—É–º–º—É** (`base_amount = amount / 3`).
2. **–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ—Å—Ç–∞—Ç–æ–∫ (`extra`)**, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–¥–∞–µ–º **–ø–µ—Ä–≤–æ–º—É –æ—Ç–¥–µ–ª—É**.
3. **–ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –æ—Ç–¥–µ–ª—ã —á–µ—Ä–µ–∑ –∫—É—Ä—Å–æ—Ä** –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∏—Ö –±—é–¥–∂–µ—Ç.

---

#### **–†–µ—à–µ–Ω–∏–µ –Ω–∞ —á–∏—Å—Ç–æ–º SQL (`WITH ROW_NUMBER`)**

```sql
WITH dept_distribution AS (
    SELECT id, ROW_NUMBER() OVER () AS row_num FROM departments
)
UPDATE departments
SET budget = budget + 
    CASE 
        WHEN row_num = 1 THEN amount / 3 + amount % 3
        ELSE amount / 3
    END
FROM dept_distribution
WHERE departments.id = dept_distribution.id;
```

üí° **–ö–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –ª—É—á—à–µ?**

|**–ú–µ—Ç–æ–¥**|**–ü–ª—é—Å—ã**|**–ú–∏–Ω—É—Å—ã**|
|---|---|---|
|**PL/pgSQL (–ö—É—Ä—Å–æ—Ä—ã)**|–ü–æ–Ω—è—Ç–Ω–æ –∏ –ª–µ–≥–∫–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å|–î–æ–ª—å—à–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è|
|**–ß–∏—Å—Ç—ã–π SQL (`WITH`)**|–ì–æ—Ä–∞–∑–¥–æ –±—ã—Å—Ç—Ä–µ–µ|–°–ª–æ–∂–Ω–µ–µ —á–∏—Ç–∞—Ç—å|

---

### **7.3. –ó–∞–¥–∞–Ω–∏–µ 3: –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Å–ª–∏—è–Ω–∏–µ–º (`Merge Sort`) —Å –∫—É—Ä—Å–æ—Ä–∞–º–∏**

#### **–£—Å–ª–æ–≤–∏–µ:**

–ù–∞–ø–∏—Å–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è **–ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–≤–∞ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞–±–æ—Ä–∞ —á–∏—Å–µ–ª –≤ –≤–∏–¥–µ –∫—É—Ä—Å–æ—Ä–æ–≤** –∏ **–æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –∏—Ö –≤ –æ–¥–∏–Ω –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**.

---

#### **–†–µ—à–µ–Ω–∏–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫—É—Ä—Å–æ—Ä–æ–≤:**

```sql
CREATE OR REPLACE FUNCTION merge_sorted_cursors(cursor1 REFCURSOR, cursor2 REFCURSOR) RETURNS TABLE (num INT) AS $$
DECLARE
    num1 INT;
    num2 INT;
BEGIN
    -- –û—Ç–∫—Ä—ã–≤–∞–µ–º –æ–±–∞ –∫—É—Ä—Å–æ—Ä–∞
    OPEN cursor1;
    OPEN cursor2;

    -- –ß–∏—Ç–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É –∏–∑ –∫–∞–∂–¥–æ–≥–æ –∫—É—Ä—Å–æ—Ä–∞
    FETCH cursor1 INTO num1;
    FETCH cursor2 INTO num2;

    -- –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å–ø–∏—Å–∫–∏
    WHILE num1 IS NOT NULL OR num2 IS NOT NULL LOOP
        IF num1 IS NULL THEN
            RETURN NEXT num2;
            FETCH cursor2 INTO num2;
        ELSIF num2 IS NULL THEN
            RETURN NEXT num1;
            FETCH cursor1 INTO num1;
        ELSIF num1 <= num2 THEN
            RETURN NEXT num1;
            FETCH cursor1 INTO num1;
        ELSE
            RETURN NEXT num2;
            FETCH cursor2 INTO num2;
        END IF;
    END LOOP;

    CLOSE cursor1;
    CLOSE cursor2;
END;
$$ LANGUAGE plpgsql;
```

üìå **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?**

4. **–û—Ç–∫—Ä—ã–≤–∞–µ–º –¥–≤–∞ –∫—É—Ä—Å–æ—Ä–∞**, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–¥–µ—Ä–∂–∞—Ç **–æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**.
5. **–ß–∏—Ç–∞–µ–º –ø–µ—Ä–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∫–∞–∂–¥–æ–≥–æ –∫—É—Ä—Å–æ—Ä–∞** (`FETCH`).
6. **–ü–æ—Å—Ç—Ä–æ—á–Ω–æ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º —á–∏—Å–ª–∞** –∏ **–¥–æ–±–∞–≤–ª—è–µ–º –Ω–∞–∏–º–µ–Ω—å—à–µ–µ** –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
7. **–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –æ–±–∞ –Ω–∞–±–æ—Ä–∞ –Ω–µ –∑–∞–∫–æ–Ω—á–∞—Ç—Å—è**.

---

### **7.4. –í—ã–≤–æ–¥ –ø–æ —Å–µ–¥—å–º–æ–π —á–∞—Å—Ç–∏**

- **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∞–≤—Ç–æ—Ä–æ–≤** ‚Üí –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å **—á–µ—Ä–µ–∑ –∫—É—Ä—Å–æ—Ä—ã –∏–ª–∏ SQL (`STRING_AGG`)**.
- **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—É–º–º—ã –º–µ–∂–¥—É –æ—Ç–¥–µ–ª–∞–º–∏** ‚Üí —á–µ—Ä–µ–∑ **PL/pgSQL (`CURSOR LOOP`) –∏–ª–∏ SQL (`ROW_NUMBER()`)**.
- **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Å–ª–∏—è–Ω–∏–µ–º (`Merge Sort`)** ‚Üí —Ö–æ—Ä–æ—à–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è **—Å –ø–æ–º–æ—â—å—é –∫—É—Ä—Å–æ—Ä–æ–≤**.

üí° **–ï—Å–ª–∏ –º–æ–∂–Ω–æ —Ä–µ—à–∏—Ç—å –∑–∞–¥–∞—á—É SQL-–∑–∞–ø—Ä–æ—Å–æ–º, —Ç–æ —Ç–∞–∫ –±—É–¥–µ—Ç –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º —Å –∫—É—Ä—Å–æ—Ä–∞–º–∏!**

---

üéØ **–§–∏–Ω–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ –ø–æ –≤—Å–µ–π —Ç–µ–º–µ –∫—É—Ä—Å–æ—Ä–æ–≤:**

- **–ö—É—Ä—Å–æ—Ä—ã –ø–æ–ª–µ–∑–Ω—ã –¥–ª—è –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏**, –Ω–æ –∏—Ö **—Å—Ç–æ–∏—Ç –∏–∑–±–µ–≥–∞—Ç—å**, –µ—Å–ª–∏ –º–æ–∂–Ω–æ —Ä–µ—à–∏—Ç—å –∑–∞–¥–∞—á—É SQL-–∑–∞–ø—Ä–æ—Å–æ–º.
- **–ü–µ—Ä–µ–¥–∞—á–∞ –∫—É—Ä—Å–æ—Ä–æ–≤ –∫–ª–∏–µ–Ω—Ç—É** –ø–æ–∑–≤–æ–ª—è–µ—Ç **—Ä–∞–±–æ—Ç–∞—Ç—å —Å –±–æ–ª—å—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –±–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ–π –≤—ã–±–æ—Ä–∫–∏ –≤ –ø–∞–º—è—Ç—å**.
- **–†–∞–±–æ—Ç–∞ —Å –∫—É—Ä—Å–æ—Ä–∞–º–∏ –≤ —Ü–∏–∫–ª–∞—Ö (`FOR`, `LOOP FETCH`)** –¥–µ–ª–∞–µ—Ç –∫–æ–¥ –≥–∏–±–∫–∏–º, –Ω–æ –º–æ–∂–µ—Ç —Å–Ω–∏–∂–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

‚úÖ **–ì–æ—Ç–æ–≤–æ! –≠—Ç–æ –±—ã–ª –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Å–ø–µ–∫—Ç –≤–∏–¥–µ–æ. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ Obsidian.** üéâ

