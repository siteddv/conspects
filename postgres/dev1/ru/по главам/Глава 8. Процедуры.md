# Глава 8. Процедуры

## Содержание

- [[1. Введение в процедуры]] [1. Введение в процедуры](../полный/8. Процедуры/1. Введение в процедуры.md)
- [[2. Отличия процедур от функций]] [2. Отличия процедур от функций](../полный/8. Процедуры/2. Отличия процедур от функций.md)
- [[3. Создание и использование процедур]] [3. Создание и использование процедур](../полный/8. Процедуры/3. Создание и использование процедур.md)
- [[4. Управление транзакциями в процедурах]] [4. Управление транзакциями в процедурах](../полный/8. Процедуры/4. Управление транзакциями в процедурах.md)
- [[5. Практические примеры]] [5. Практические примеры](../полный/8. Процедуры/5. Практические примеры.md)

---

## Введение в процедуры

В PostgreSQL существуют две основные категории подпрограмм: функции и процедуры. Основное различие заключается в способе вызова и возможностях управления транзакциями.

Функции в PostgreSQL всегда возвращают значение и работают в рамках текущей транзакции. Они могут быть вызваны как часть SQL-выражения, например, в операторах SELECT. Процедуры, напротив, не обязаны возвращать значения и вызываются через отдельный оператор CALL. Одним из ключевых преимуществ процедур является возможность управлять транзакциями внутри их тела, что особенно важно для выполнения сложных операций изменения состояния базы данных.

Процедуры появились в PostgreSQL только в версии 11, и их внедрение было обусловлено необходимостью более гибкого управления транзакциями.

## Основные отличия процедур от функций

Способ вызова: функции интегрируются непосредственно в SQL-выражения (например, `SELECT my_function()`), процедуры вызываются автономно через оператор CALL (`CALL my_procedure()`).

Возвращаемое значение: функции обязаны возвращать результат, даже если это специальный тип void, процедуры могут не возвращать значений напрямую, хотя могут передавать данные через параметры.

Управление транзакциями: функции выполняются строго в контексте текущей транзакции без возможности самостоятельного управления COMMIT/ROLLBACK, процедуры предоставляют возможность управления транзакционными границами внутри своего тела.

Предназначение использования: функции ориентированы на вычислительные задачи и получение результатов, процедуры предназначены для выполнения операций изменения состояния базы данных.

## Создание и использование процедур

Создание процедуры начинается с ключевого слова `CREATE PROCEDURE`, за которым следует имя процедуры и список параметров (если они есть). После указания языка реализации (LANGUAGE) следует тело процедуры, заключенное в блок `$$ ... $$`.

Процедуры решают проблему отсутствия возможности управления транзакциями внутри функций несколькими способами: возможность открывать и закрывать транзакции внутри процедуры, использование операторов COMMIT и ROLLBACK, контроль выполнения операций на уровне базы данных.

**Подробнее:** [[8. Процедуры]] [8. Процедуры](../полный/8. Процедуры/резюме.md)

