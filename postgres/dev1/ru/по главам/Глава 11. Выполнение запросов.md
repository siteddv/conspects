# Глава 11. Выполнение запросов

## Содержание

- [[1. Введение]] [1. Введение](../полный/11. Выполнение запросов/1. Введение.md)
- [[2. Использование SQL в PLpgSQL]] [2. Использование SQL в PLpgSQL](../полный/11. Выполнение запросов/2. Использование SQL в PLpgSQL.md)
- [[3. Управление транзакциями в PLpgSQL]] [3. Управление транзакциями в PLpgSQL](../полный/11. Выполнение запросов/3. Управление транзакциями в PLpgSQL.md)
- [[4. Работа с результатами SQL-запросов]] [4. Работа с результатами SQL-запросов](../полный/11. Выполнение запросов/4. Работа с результатами SQL-запросов.md)
- [[5. Разрешение конфликтов имен (переменные vs столбцы таблицы)]] [5. Разрешение конфликтов имен (переменные vs столбцы таблицы)](../полный/11. Выполнение запросов/5. Разрешение конфликтов имен (переменные vs столбцы таблицы).md)
- [[6. Диагностика выполнения SQL-запросов]] [6. Диагностика выполнения SQL-запросов](../полный/11. Выполнение запросов/6. Диагностика выполнения SQL-запросов.md)
- [[7. Создание табличных функций в PLpgSQL]] [7. Создание табличных функций в PLpgSQL](../полный/11. Выполнение запросов/7. Создание табличных функций в PLpgSQL.md)
- [[8. Практические задания]] [8. Практические задания](../полный/11. Выполнение запросов/8. Практические задания.md)

---

## Введение

PL/pgSQL — это процедурный язык PostgreSQL, который тесно интегрирован с SQL и позволяет использовать переменные и сложную логику внутри SQL-запросов. Этот язык используется для создания функций и хранимых процедур, которые работают напрямую в PostgreSQL.

Преимущества PL/pgSQL: гибкость (можно комбинировать SQL-запросы и процедурную логику), мощность (доступ ко всем возможностям SQL), эффективность (выполнение PL/pgSQL-кода внутри PostgreSQL без необходимости передачи данных на клиент) и поддержка подготовленных операторов (PostgreSQL автоматически использует prepared statements, оптимизируя выполнение запросов).

## Использование SQL в PL/pgSQL

PL/pgSQL позволяет напрямую использовать SQL-запросы в коде, комбинируя их с процедурной логикой. Все SQL-запросы внутри PL/pgSQL автоматически компилируются в подготовленные операторы (prepared statements), что ускоряет выполнение и защищает от SQL-инъекций.

Разрешенные SQL-команды: `SELECT` (получение данных), `INSERT`, `UPDATE`, `DELETE` (модификация данных), `EXECUTE` (динамическое выполнение SQL-кода), `RETURNING` (получение данных после `INSERT` или `UPDATE`).

Ограничения SQL в PL/pgSQL: нельзя использовать административные команды, такие как `VACUUM`, `ANALYZE`, ограничения на управление транзакциями (нельзя выполнять `COMMIT` и `ROLLBACK` в функциях).

## Управление транзакциями

PostgreSQL поддерживает автоматическое управление транзакциями. Если запрос выполняется вне хранимой процедуры, PostgreSQL автоматически создает транзакцию. Разница между функциями и процедурами: функции (`FUNCTION`) не могут выполнять `COMMIT` и `ROLLBACK`, процедуры (`PROCEDURE`) могут управлять транзакциями.

## Работа с результатами SQL-запросов

PL/pgSQL предоставляет различные способы работы с результатами SQL-запросов: присваивание результатов переменным, использование `INTO` для сохранения результатов, работа с множественными строками через курсоры и табличные функции.

**Подробнее:** [[11. Выполнение запросов]] [11. Выполнение запросов](../полный/11. Выполнение запросов/резюме.md)

