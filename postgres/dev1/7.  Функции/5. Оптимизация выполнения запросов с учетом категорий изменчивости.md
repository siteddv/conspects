### **–ö–æ–Ω—Å–ø–µ–∫—Ç –ø—è—Ç–æ–π –ª–æ–≥–∏—á–µ—Å–∫–æ–π —á–∞—Å—Ç–∏: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ —Å —É—á—ë—Ç–æ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç–∏**

---

### **1. –ö–∞–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç–∏ –≤–ª–∏—è—é—Ç –Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é?**

–ö–∞—Ç–µ–≥–æ—Ä–∏—è –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç–∏ (`VOLATILE`, `STABLE`, `IMMUTABLE`) –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫ PostgreSQL **–ø–ª–∞–Ω–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π**:

- **VOLATILE** ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è **–∫–∞–∂–¥—ã–π —Ä–∞–∑** –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏.
- **STABLE** ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è **–æ–¥–∏–Ω —Ä–∞–∑** –∑–∞ –∑–∞–ø—Ä–æ—Å.
- **IMMUTABLE** ‚Üí –º–æ–∂–µ—Ç –±—ã—Ç—å **–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –≤—ã—á–∏—Å–ª–µ–Ω–∞** –∏ –∑–∞–º–µ–Ω–µ–Ω–∞ –Ω–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É.

---

### **2. –ü—Ä–∏–º–µ—Ä –≤–ª–∏—è–Ω–∏—è –Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é**

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º —Ñ—É–Ω–∫—Ü–∏—é, –≤–æ–∑–≤—Ä–∞—â–∞—é—â—É—é —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ:

```sql
CREATE FUNCTION get_random_number() RETURNS float 
AS $$
  SELECT random();
$$ LANGUAGE sql VOLATILE;
```

–ó–∞–ø—Ä–æ—Å:

```sql
SELECT * FROM users WHERE get_random_number() > 0.5;
```

- PostgreSQL **–≤—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏**, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ `VOLATILE`.
- –≠—Ç–æ –∑–∞–º–µ–¥–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.

‚úÖ **–†–µ—à–µ–Ω–∏–µ:**

- –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –¥–æ–ª–∂–Ω–∞ –º–µ–Ω—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–Ω—É—Ç—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞, —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `STABLE`.

---

### **3. –ü—Ä–∏–º–µ—Ä –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å `STABLE`**

–°–æ–∑–¥–∞–¥–∏–º —Ñ—É–Ω–∫—Ü–∏—é, –≤–æ–∑–≤—Ä–∞—â–∞—é—â—É—é —Ç–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

```sql
CREATE FUNCTION get_user_count() RETURNS integer 
AS $$
  SELECT COUNT(*) FROM users;
$$ LANGUAGE sql STABLE;
```

–ó–∞–ø—Ä–æ—Å:

```sql
SELECT * FROM orders WHERE user_id = get_user_count();
```

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—Å—è?**

- PostgreSQL **–≤—ã—á–∏—Å–ª—è–µ—Ç `get_user_count()` —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑**.
- –ï—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å `VOLATILE`, —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–∑–æ–≤–µ—Ç—Å—è **–Ω–∞ –∫–∞–∂–¥—É—é —Å—Ç—Ä–æ–∫—É**.

üìå **–í—ã–≤–æ–¥:** `STABLE`-—Ñ—É–Ω–∫—Ü–∏–∏ —Å–Ω–∏–∂–∞—é—Ç –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞.

---

### **4. –ö–∞–∫ `IMMUTABLE` —É—Å–∫–æ—Ä—è–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ**

–§—É–Ω–∫—Ü–∏–∏ `IMMUTABLE` –º–æ–≥—É—Ç –±—ã—Ç—å **–∑–∞—Ä–∞–Ω–µ–µ –≤—ã—á–∏—Å–ª–µ–Ω—ã** –Ω–∞ —ç—Ç–∞–ø–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞.

–ü—Ä–∏–º–µ—Ä:

```sql
CREATE FUNCTION square(x int) RETURNS int 
AS $$
  SELECT x * x;
$$ LANGUAGE sql IMMUTABLE;
```

–ó–∞–ø—Ä–æ—Å:

```sql
SELECT * FROM users WHERE age = square(5);
```

–ß—Ç–æ –¥–µ–ª–∞–µ—Ç PostgreSQL?

- **–ó–∞–º–µ–Ω—è–µ—Ç –≤—ã–∑–æ–≤ `square(5)` –Ω–∞ `25` –µ—â—ë –¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞**.
- –≠—Ç–æ —É—Å–∫–æ—Ä—è–µ—Ç –∑–∞–ø—Ä–æ—Å, —Ç–∞–∫ –∫–∞–∫ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏.

üìå **–í—ã–≤–æ–¥:** `IMMUTABLE` –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–µ—Ä–≤–µ—Ä—É –∑–∞—Ä–∞–Ω–µ–µ –∑–∞–º–µ–Ω–∏—Ç—å –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ –µ—ë —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

---

### **5. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–≤: –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π –≤–æ –≤–Ω–µ—à–Ω–∏–π –∑–∞–ø—Ä–æ—Å**

–í PostgreSQL **—Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ —è–∑—ã–∫–µ SQL –º–æ–≥—É—Ç –±—ã—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω—ã –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—Ä–æ—Å**, –µ—Å–ª–∏ –æ–Ω–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —É—Å–ª–æ–≤–∏—è–º:

1. **–§—É–Ω–∫—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –æ–ø–µ—Ä–∞—Ç–æ—Ä `SELECT`.**
2. **–§—É–Ω–∫—Ü–∏—è –Ω–µ –∏–º–µ–µ—Ç –ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–≤, –≥—Ä—É–ø–ø–∏—Ä–æ–≤–æ–∫ –∏–ª–∏ `ORDER BY`.**
3. **–ö–∞—Ç–µ–≥–æ—Ä–∏—è –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç–∏ `STABLE` –∏–ª–∏ `IMMUTABLE`.**

#### **–ü—Ä–∏–º–µ—Ä –±–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–ø–ª–æ—Ö–æ–π –≤–∞—Ä–∏–∞–Ω—Ç)**

–°–æ–∑–¥–∞–¥–∏–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```sql
CREATE FUNCTION get_max_user_id() RETURNS int 
AS $$
  SELECT MAX(id) FROM users;
$$ LANGUAGE sql STABLE;
```

–ó–∞–ø—Ä–æ—Å:

```sql
SELECT * FROM orders WHERE user_id = get_max_user_id();
```

–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç?

- PostgreSQL **—Å–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—Ä–æ—Å**, –∑–∞—Ç–µ–º **–≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–¥–µ–ª—å–Ω–æ**.
- –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å **–Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ**.

#### **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç**

–§—É–Ω–∫—Ü–∏—è —Å `IMMUTABLE`:

```sql
CREATE FUNCTION double_value(x int) RETURNS int 
AS $$
  SELECT x * 2;
$$ LANGUAGE sql IMMUTABLE;
```

–ó–∞–ø—Ä–æ—Å:

```sql
SELECT * FROM orders WHERE user_id = double_value(5);
```

- PostgreSQL **–ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç `double_value(5) ‚Üí 10`** –µ—â—ë –¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞.
- –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ **–Ω–µ—Ç –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**.

üìå **–í—ã–≤–æ–¥:** PostgreSQL –º–æ–∂–µ—Ç –ø–æ–¥—Å—Ç–∞–≤–ª—è—Ç—å `IMMUTABLE`-—Ñ—É–Ω–∫—Ü–∏–∏ –≤ –∑–∞–ø—Ä–æ—Å, —á—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É—Å–∫–æ—Ä—è–µ—Ç –µ–≥–æ.

---

### **6. –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –æ—Ç `VOLATILE` –≤ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–∞—Ö**

–°–æ–∑–¥–∞–¥–∏–º `VOLATILE`-—Ñ—É–Ω–∫—Ü–∏—é:

```sql
CREATE FUNCTION get_random_discount() RETURNS int 
AS $$
  SELECT (random() * 100)::int;
$$ LANGUAGE sql VOLATILE;
```

–ó–∞–ø—Ä–æ—Å:

```sql
SELECT product_id, get_random_discount() FROM products;
```

- **–§—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏**, —á—Ç–æ **–∑–∞–º–µ–¥–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å**.
- **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã**, —Ç–∞–∫ –∫–∞–∫ —Å–∫–∏–¥–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–∑–Ω–æ–π –¥–∞–∂–µ –¥–ª—è –æ–¥–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞.

‚úÖ **–†–µ—à–µ–Ω–∏–µ:** –ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω—ã–º –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –∑–∞–ø—Ä–æ—Å–∞ ‚Üí `STABLE`.

---

### **7. –ò—Ç–æ–≥–æ–≤–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç–∏ –≤ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**

|–ö–∞—Ç–µ–≥–æ—Ä–∏—è|–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?|–ö–∞–∫ –≤–ª–∏—è–µ—Ç –Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é?|
|---|---|---|
|**VOLATILE**|–§—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `random()`, `now()`).|**–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ** ‚Üí –º–µ–¥–ª–µ–Ω–Ω–æ.|
|**STABLE**|–§—É–Ω–∫—Ü–∏–∏, —á–∏—Ç–∞—é—â–∏–µ, –Ω–æ –Ω–µ –∏–∑–º–µ–Ω—è—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `COUNT(*)`, `NOW()`).|**–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ –∑–∞–ø—Ä–æ—Å** ‚Üí –±—ã—Å—Ç—Ä–µ–µ.|
|**IMMUTABLE**|–§—É–Ω–∫—Ü–∏–∏, –Ω–µ –∑–∞–≤–∏—Å—è—â–∏–µ –æ—Ç –±–∞–∑—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `x * x`).|**–ü–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∑–∞—Ä–∞–Ω–µ–µ** ‚Üí –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ.|

---

### **–í—ã–≤–æ–¥—ã –ø–æ –ø—è—Ç–æ–π —á–∞—Å—Ç–∏**

4. **–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç–∏ –≤–ª–∏—è—é—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: `VOLATILE` —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è —á–∞—Å—Ç–æ, `STABLE` —Ä–µ–∂–µ, `IMMUTABLE` –ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –∑–∞—Ä–∞–Ω–µ–µ.
5. **PostgreSQL –º–æ–∂–µ—Ç –ø–æ–¥—Å—Ç–∞–≤–ª—è—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –≤–æ –≤–Ω–µ—à–Ω–∏–π –∑–∞–ø—Ä–æ—Å**, –µ—Å–ª–∏ –æ–Ω–∏ –ø—Ä–æ—Å—Ç—ã–µ (`IMMUTABLE`, `STABLE`).
6. **–§—É–Ω–∫—Ü–∏–∏ `IMMUTABLE` –¥–∞—é—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é**, —Ç–∞–∫ –∫–∞–∫ —Å–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç –∏—Ö –≤—ã—á–∏—Å–ª–∏—Ç—å –Ω–∞ —ç—Ç–∞–ø–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞.
7. **–§—É–Ω–∫—Ü–∏–∏ `STABLE` –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ –∑–∞–ø—Ä–æ—Å**, —Å–Ω–∏–∂–∞—è –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.
8. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `VOLATILE` –º–æ–∂–µ—Ç –∑–∞–º–µ–¥–ª—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã**, —Ç–∞–∫ –∫–∞–∫ PostgreSQL –Ω–µ –∫—ç—à–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

---

–°–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å –±—É–¥–µ—Ç –ø—Ä–æ **–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è**: —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–Ω–∏–∂–Ω—ã–º –º–∞–≥–∞–∑–∏–Ω–æ–º, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –∫–æ—Ä–Ω–µ–π —É—Ä–∞–≤–Ω–µ–Ω–∏–π. –ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å? üòä