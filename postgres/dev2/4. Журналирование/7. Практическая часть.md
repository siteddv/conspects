### Часть 7: Практическая часть

#### 7.1 Задания по работе с pg_prewarm
Первое задание в практической части связано с использованием расширения **pg_prewarm**, которое позволяет "разогревать" буферный кэш, то есть предварительно загружать данные в кэш после перезапуска сервера.

- **Проблема холодного старта**:
  - После перезапуска PostgreSQL буферный кэш пуст, и первые запросы могут выполняться медленно, так как данные считываются с диска.
  - Это особенно заметно для больших баз данных или систем с высокой нагрузкой.

- **Как работает pg_prewarm**:
  - Расширение позволяет сохранять состояние буферного кэша перед выключением сервера.
  - После перезапуска можно восстановить содержимое кэша, чтобы запросы сразу работали с разогретым кэшем.

- **Практическое задание**:
  - Установите расширение `pg_prewarm`.
  - Создайте тестовую таблицу и заполните её данными.
  - Выполните запросы, чтобы загрузить данные в буферный кэш.
  - Используйте функцию `pg_prewarm` для сохранения состояния кэша.
  - Перезапустите сервер и проверьте, как быстро выполняются запросы после восстановления кэша.

#### 7.2 Исследование буферных колец
Второе задание связано с исследованием **буферных колец** — механизма, который определяет, сколько буферов требуется для чтения данных.

- **Цель задания**:
  - Создайте большую таблицу (например, несколько гигабайт) и выполните запрос, который читает её целиком.
  - Используйте представление `pg_buffercache` или аналогичные инструменты, чтобы посмотреть, сколько буферов было использовано для чтения данных.

- **Неожиданные результаты**:
  - В некоторых случаях количество используемых буферов может оказаться меньше, чем ожидалось.
  - Это связано с тем, что PostgreSQL эффективно управляет буферами, переиспользуя их для новых страниц, если старые уже не нужны.

- **Комментарии к заданию**:
  - В решениях объясняется, почему PostgreSQL может использовать меньше буферов, чем размер таблицы поделённый на размер страницы.
  - Это связано с алгоритмом вытеснения и тем, как данные читаются блоками.

#### 7.3 Сравнение производительности в разных режимах записи
Третье задание предлагает сравнить производительность системы в **синхронном** и **асинхронном** режимах записи журнала WAL.

- **Инструменты для тестирования**:
  - Используйте утилиту `pgbench`, которая позволяет выполнять эталонное тестирование производительности.
  - Настройте параметр `synchronous_commit` на значения `on` (синхронный режим) и `off` (асинхронный режим).

- **Методика тестирования**:
  1. Запустите `pgbench` в синхронном режиме и измерьте количество транзакций в секунду.
  2. Переключитесь в асинхронный режим и повторите тест.
  3. Сравните результаты.

- **Ожидаемые результаты**:
  - В асинхронном режиме производительность будет значительно выше, так как команда `COMMIT` не ждёт записи на диск.
  - Однако в случае сбоя последние транзакции могут быть потеряны.

- **Практический вывод**:
  - Это задание помогает понять, насколько сильно синхронная запись может замедлять работу системы.
  - Оно также демонстрирует компромисс между надёжностью и производительностью.

---

Это завершает седьмую и последнюю часть конспекта, посвящённую практическим заданиям. Хотите обсудить конкретные детали или примеры из практики?