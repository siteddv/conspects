### **7. Заключение: Возможности и ограничения**

#### Подведение итогов
В этом разделе мы подведем итоги всему, что было рассмотрено в видео, и обсудим основные возможности и ограничения различных подходов к написанию серверных подпрограмм.

---

#### Основные выводы
1. **Языки программирования для серверных подпрограмм**:
   - PostgreSQL поддерживает множество языков, как доверенных (например, PL/pgSQL), так и недоверенных (например, Python).
   - Каждый язык имеет свои преимущества и ограничения, которые необходимо учитывать при выборе.

2. **Доверенные и недоверенные языки**:
   - Доверенные языки безопасны и доступны для всех пользователей, но ограничены в своих возможностях.
   - Недоверенные языки предоставляют полный доступ к функционалу языка, но требуют осторожности при использовании.

3. **Подключение новых языков**:
   - Большинство языков подключаются через механизм расширений (`CREATE EXTENSION`).
   - Для успешного подключения необходимы три компонента: обработчик, валидатор и функция для анонимных блоков.

4. **Преобразование типов данных**:
   - Преобразование типов данных между базой данных и языком программирования является важным аспектом работы с серверными подпрограммами.
   - Трансформации типов позволяют решать проблемы, связанные с некорректным преобразованием данных (например, JSON).

5. **Интерфейсы взаимодействия**:
   - Низкоуровневый интерфейс SPI используется для выполнения запросов и управления транзакциями.
   - Высокоуровневые обертки (например, `plpy` для Python) упрощают работу с базой данных.

6. **Практические примеры**:
   - Мы рассмотрели несколько практических задач, таких как отправка писем, разложение строки на слова и определение типа файла.
   - Эти примеры демонстрируют широкий спектр возможностей, которые предоставляют серверные подпрограммы.

---

#### Преимущества использования хранимых процедур
1. **Производительность**:
   - Хранимые процедуры выполняются на стороне сервера, что минимизирует сетевые задержки.
   - Запросы компилируются один раз и могут быть переиспользованы.

2. **Безопасность**:
   - Хранимые процедуры ограничивают доступ к данным, обеспечивая безопасность.

3. **Интеграция**:
   - Хранимые процедуры могут использовать богатую экосистему библиотек языков программирования.

---

#### Ограничения и спорные вопросы
4. **Сложность отладки**:
   - Отладка хранимых процедур может быть сложной, особенно для языков, не предназначенных для работы с базой данных.

5. **Ограниченная функциональность некоторых языков**:
   - Не все языки поддерживают все возможности базы данных.

6. **Проблемы с поддержкой**:
   - Использование хранимых процедур может усложнить миграцию на другую СУБД.

7. **Спорные вопросы**:
   - Есть две полярные точки зрения: одни считают, что хранимые процедуры — это мощный инструмент, другие считают, что их использование нежелательно.
   - Истина, как правило, находится где-то посередине.

---

#### Практические рекомендации
8. **Выбор языка**:
   - Для задач, связанных с обработкой данных внутри базы данных, лучше использовать доверенные языки (например, PL/pgSQL).
   - Для задач, выходящих за рамки базы данных, можно использовать недоверенные языки (например, Python).

9. **Использование трансформаций**:
   - Если возникают проблемы с преобразованием типов данных, используйте трансформации.

10. **Отправка писем**:
   - Убедитесь, что письма отправляются только после успешного завершения транзакции.

11. **Разработка функций**:
   - Используйте готовые решения и библиотеки для упрощения разработки.

---

#### Заключение
Серверные подпрограммы — это мощный инструмент, который позволяет решать широкий спектр задач. Однако их использование требует осторожности и учета ограничений. Важно знать, какие языки и интерфейсы доступны, и выбирать наиболее подходящие для конкретной задачи.