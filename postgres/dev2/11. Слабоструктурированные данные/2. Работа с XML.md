### Часть 2: Работа с XML

#### 2.1 Основы формата XML
XML (eXtensible Markup Language) — это язык разметки, появившийся в контексте веба в 1998 году. Он используется для структурирования данных с помощью тегов, атрибутов и вложенных элементов. Основные характеристики:
- **Теги**: Открывающие (`<tag>`) и закрывающие (`</tag>`) теги.
- **Атрибуты**: Дополнительные параметры внутри тегов.
- **Иерархическая структура**: Элементы могут быть вложенными.

Примеры использования XML:
- XHTML (строгий HTML).
- FB2 (формат электронных книг).
- RSS/Atom (новостные ленты).
- SVG (векторная графика).
- SOAP (веб-сервисы).

#### 2.2 Языки запросов и преобразования
Для работы с XML существуют специализированные языки:
- **XPath**: Язык запросов для выбора частей XML-документа.
- **XQuery**: Более мощный язык запросов, основанный на XPath.
- **XSLT**: Язык преобразования XML-документов.

PostgreSQL поддерживает только XPath первой версии, что ограничивает возможности работы с XML.

#### 2.3 Поддержка XML в PostgreSQL
PostgreSQL предоставляет базовую поддержку XML:
- **Функции**: `xpath()`, `xmltable()`.
- **Ограничения**: Нет полноценной поддержки индексирования XML-документов.
- **Причины ограниченности**: XML утратил популярность в пользу JSON, поэтому развитие поддержки замедлилось.

#### 2.4 Примеры запросов к XML
Рассмотрим пример XML-документа, описывающего компьютер:
```xml
<computer>
  <motherboard>
    <ram size="8">DDR4</ram>
    <ram size="16">DDR4</ram>
  </motherboard>
  <disks>
    <disk model="Toshiba" size="500"/>
    <disk model="Seagate" size="1000"/>
  </disks>
</computer>
```

##### Пример 1: Выбор элементов
Запрос для выбора всех элементов RAM:
```sql
SELECT xpath('/computer/motherboard/ram', xml_data);
```
Результат:
```xml
<ram size="8">DDR4</ram>, <ram size="16">DDR4</ram>
```

##### Пример 2: Фильтрация по атрибутам
Запрос для выбора дисков с размером больше 500:
```sql
SELECT xpath('/computer/disks/disk[@size > 500]', xml_data);
```
Результат:
```xml
<disk model="Seagate" size="1000"/>
```

##### Пример 3: Преобразование в реляционные данные
Функция `xmltable()` позволяет преобразовать XML в таблицу:
```sql
SELECT *
FROM xmltable(
  '/computer/disks/disk'
  PASSING xml_data
  COLUMNS model TEXT PATH '@model',
          size INT PATH '@size'
);
```
Результат:
| model   | size |
|---------|------|
| Toshiba | 500  |
| Seagate | 1000 |

#### 2.5 Преобразование между XML и реляционными данными
##### XML → Реляционные данные
Используется функция `xmltable()` для разбора XML и преобразования его в строки таблицы.

##### Реляционные данные → XML
Используется функция `xmlelement()` для создания XML-элементов из таблиц:
```sql
SELECT xmlelement(name disk, xmlattributes(model AS model, size AS size))
FROM disks;
```

#### 2.6 Практические применения
- **Хранение сложных данных**: XML удобен для хранения данных с переменной структурой.
- **Обмен данными**: Используется как универсальный формат для передачи данных между системами.
- **Интеграция**: Подходит для взаимодействия с устаревшими системами, где XML остается стандартом.

---

Это вторая часть конспекта, посвященная работе с XML. Если вы хотите продолжить со следующей частью (работа с JSON), дайте знать!