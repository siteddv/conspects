# 17. Обзор полнотекстового поиска

## Описание

Эта глава посвящена полнотекстовому поиску в PostgreSQL. Мы рассмотрим введение в полнотекстовый поиск, основные возможности и проблемы полнотекстового поиска, механизм работы полнотекстового поиска, настройку и конфигурацию полнотекстового поиска, а также практическое применение полнотекстового поиска.

## Части главы

- [[части/1. Введение в полнотекстовый поиск|1. Введение в полнотекстовый поиск]] [1. Введение в полнотекстовый поиск](части/1. Введение в полнотекстовый поиск.md)
- [[части/2. Основные возможности и проблемы полнотекстового поиска|2. Основные возможности и проблемы полнотекстового поиска]] [2. Основные возможности и проблемы полнотекстового поиска](части/2. Основные возможности и проблемы полнотекстового поиска.md)
- [[части/3. Механизм работы полнотекстового поиска|3. Механизм работы полнотекстового поиска]] [3. Механизм работы полнотекстового поиска](части/3. Механизм работы полнотекстового поиска.md)
- [[части/4. Настройка и конфигурация полнотекстового поиска|4. Настройка и конфигурация полнотекстового поиска]] [4. Настройка и конфигурация полнотекстового поиска](части/4. Настройка и конфигурация полнотекстового поиска.md)
- [[части/5. Практическое применение полнотекстового поиска|5. Практическое применение полнотекстового поиска]] [5. Практическое применение полнотекстового поиска](части/5. Практическое применение полнотекстового поиска.md)

---

Полнотекстовый поиск — это механизм, позволяющий искать информацию в текстовых данных на основе содержимого, а не только по точному совпадению слов или символов. Это мощный инструмент, который используется для анализа больших объемов текстовой информации и предоставления релевантных результатов. Без использования полнотекстового поиска, основными средствами для поиска в базах данных являются конструкции типа `LIKE` и регулярные выражения. Однако эти методы имеют существенные ограничения: отсутствие поддержки словоформ, нет возможности ранжирования результатов и низкая эффективность.

Полнотекстовый поиск решает многие из перечисленных проблем: ранжирование результатов (позволяет выдавать наиболее релевантные документы в начале списка), учет различных словоформ (может находить слова в разных падежах, числах и временах) и встроенная поддержка языковых особенностей (учитывает специфику различных языков, такие как стоп-слова и морфологические изменения). Внутренний полнотекстовый поиск в базе данных обеспечивает мгновенное отражение изменений (все изменения в данных сразу доступны для поиска), транзакционность (поиск работает в рамках транзакций, гарантируя согласованность данных) и контроль доступа (легче управлять правами доступа к данным, так как все операции происходят внутри базы данных).

Одной из ключевых особенностей полнотекстового поиска является возможность ранжирования результатов. Это означает, что найденные документы могут быть отсортированы по степени их релевантности запросу пользователя. Функции ранжирования, такие как `ts_rank`, позволяют вычислить релевантность документа на основе частоты найденных слов (лексем). Чем чаще встречается слово в документе, тем выше его значимость. Если слова запроса находятся близко друг к другу, это также увеличивает релевантность. Можно назначать разные веса различным частям документа. Например, заголовок может быть важнее, чем основной текст, и это можно учесть при ранжировании.

Полнотекстовый поиск — это многоступенчатый процесс, который начинается с анализа исходного текстового документа и заканчивается формированием специального типа данных, называемого **tsvector** (вектор текста). Первым шагом в работе полнотекстового поиска является пропускание документа через **анализатор** (parser). Анализатор разбивает текст на фрагменты различных типов (слова, числа, URL-адреса, электронные адреса, разделители). После того, как текст разбит на фрагменты, каждый фрагмент передается через цепочку **словарей**. Словарь — это программа, которая преобразует фрагменты в **лексемы** (lexemes). Основная задача словарей — нормализация фрагментов: приведение к нижнему регистру, удаление стоп-слов, стемминг (stemming) — приведение слова к его базовой форме (корню), обработка синонимов.

После того, как все фрагменты были обработаны через анализатор и словари, они собираются в специальный тип данных — **tsvector**. **tsvector** — это набор лексем с указанием их позиций в исходном документе. Позиции важны для выполнения **фразового поиска** (phrase search) и ранжирования результатов. Поисковый запрос также преобразуется в специальный тип данных — **tsquery**. **tsquery** представляет собой набор лексем, соединенных логическими операторами (`AND`, `OR`, `NOT`) и дополнительными конструкциями, такими как фразовый поиск или поиск с учетом расстояния между словами.

Индексы играют ключевую роль в ускорении полнотекстового поиска. В PostgreSQL есть несколько типов индексов, которые могут быть использованы для этой цели: **GIN (Generalized Inverted Index)** — наиболее часто используемый тип индекса для полнотекстового поиска, обеспечивает высокую точность поиска и компактный размер, но медленное обновление при добавлении новых документов; **GiST (Generalized Search Tree)** — менее точен, чем GIN, но быстрее обновляется; **расширение pg_trgm** — предоставляет дополнительные возможности для полнотекстового поиска, такие как поддержка триграмм (трехсимвольных последовательностей).

