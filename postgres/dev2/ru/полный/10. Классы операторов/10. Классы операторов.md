# 10. Классы операторов

## Описание

Эта глава посвящена классам операторов и методам доступа в PostgreSQL. Мы рассмотрим введение в тему классов операторов и методов доступа, методы доступа и их реализацию, классы операторов (определение и функционал), практический пример создания нового типа данных и индекса, метод доступа GiST (принципы работы), практические применения GiST, расширение возможностей PostgreSQL, а также заключение и практические задания.

## Части главы

- [[части/1. Введение в тему классов операторов и методов доступа|1. Введение в тему классов операторов и методов доступа]] [1. Введение в тему классов операторов и методов доступа](части/1. Введение в тему классов операторов и методов доступа.md)
- [[части/2. Методы доступа и их реализация|2. Методы доступа и их реализация]] [2. Методы доступа и их реализация](части/2. Методы доступа и их реализация.md)
- [[части/3. Классы операторов. определение и функционал|3. Классы операторов. определение и функционал]] [3. Классы операторов. определение и функционал](части/3. Классы операторов. определение и функционал.md)
- [[части/4. Практический пример. создание нового типа данных и индекса|4. Практический пример. создание нового типа данных и индекса]] [4. Практический пример. создание нового типа данных и индекса](части/4. Практический пример. создание нового типа данных и индекса.md)
- [[части/5. Метод доступа GiST. принципы работы|5. Метод доступа GiST. принципы работы]] [5. Метод доступа GiST. принципы работы](части/5. Метод доступа GiST. принципы работы.md)
- [[части/6. Практические применения GiST|6. Практические применения GiST]] [6. Практические применения GiST](части/6. Практические применения GiST.md)
- [[части/7. Расширение возможностей PostgreSQL|7. Расширение возможностей PostgreSQL]] [7. Расширение возможностей PostgreSQL](части/7. Расширение возможностей PostgreSQL.md)
- [[части/8. Заключение и практические задания|8. Заключение и практические задания]] [8. Заключение и практические задания](части/8. Заключение и практические задания.md)

---

PostgreSQL — это расширяемая система управления базами данных, и эта расширяемость проявляется не только в возможности добавления новых типов данных, но и в поддержке новых способов доступа к данным. Методы доступа в PostgreSQL делятся на две основные группы: табличные методы доступа (отвечают за чтение данных из таблиц, например, стандартный метод `heap`) и индексные методы доступа (предоставляют дополнительные структуры данных для быстрого доступа к данным, например, `btree`, `hash`, `gist`, `gin`).

Методы доступа берут на себя следующие обязанности: реализация алгоритмов для работы с индексными структурами данных, обеспечение конкурентного доступа к данным, страничная организация данных и журналирование операций для восстановления данных в случае сбоя системы. B-tree используется для упорядоченных данных и является наиболее распространённым методом доступа. Hash используется для быстрого поиска по равенству. GiST (Generalized Search Tree) — это обобщённое дерево поиска, которое работает с произвольными предикатами. GIN (Generalized Inverted Index) — это инвертированный индекс, полезный для работы с массивами и текстовыми данными.

Классы операторов играют роль промежуточного звена между методами доступа и типами данных. Они предоставляют API, который метод доступа использует для работы с конкретным типом данных. Для числовых типов данных класс операторов определяет операции сравнения (`<`, `<=`, `=`, `>=`, `>`). Для строковых типов данных могут быть разные классы операторов, учитывающие или игнорирующие правила сортировки. Классы операторов объединяются в семейства операторов, что помогает планировщику PostgreSQL эффективно работать с разными типами данных.

Для создания нового класса операторов необходимо создать функцию сравнения, которая преобразует значения типа в байты для сравнения, определить операторы (`<`, `<=`, `=`, `>=`, `>`) на основе функции сравнения и создать класс операторов для метода доступа B-tree. После создания класса операторов можно сортировать данные в правильном порядке и создавать индексы для столбцов соответствующего типа.

GiST (Generalized Search Tree) — это обобщённое дерево поиска, которое не предполагает упорядоченность данных. В узлах дерева вычисляются предикаты, которые должны выполняться для всех узлов поддерева. Если предикат истинен для узла, то он также истинен для всех узлов поддерева. GiST может использоваться для создания ограничений, запрещающих пересечение интервалов времени, с помощью ключевого слова `EXCLUDE` и оператора пересечения (`&&`). Расширение `btree_gist` добавляет классы операторов для числовых типов данных, позволяя использовать GiST с типами данных, которые обычно поддерживаются только B-tree.

Расширения позволяют добавлять новые функциональные возможности в PostgreSQL без изменения исходного кода. Расширение `pg_trgm` добавляет поддержку триграмм для текстовых данных, что позволяет ускорять запросы с оператором `LIKE`, даже если шаблон начинается с `%`. Создание собственного метода доступа требует программирования на языке C и реализации алгоритмов работы с индексной структурой данных.

