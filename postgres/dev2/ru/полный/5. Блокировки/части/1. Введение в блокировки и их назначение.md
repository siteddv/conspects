### Часть 1: Введение в блокировки и их назначение

#### Общее определение блокировок
Блокировки — это механизм, который позволяет упорядочить конкурентный доступ к разделяемым ресурсам. Конкурентный доступ может быть:
- **Одновременным** (например, на многоядерных процессорах).
- **При разделении времени** (логически одновременный доступ разных процессов).

Для того чтобы использовать разделяемый ресурс, процесс обязан:
1. **Захватить блокировку** перед обращением к данным.
2. **Освободить блокировку** после завершения работы с данными (обычно в конце транзакции).

Блокировки могут быть двух основных типов:
- **Монопольные (исключительные)** — могут удерживаться только одним процессом.
- **Разделяемые** — могут удерживаться несколькими процессами одновременно.

#### Примеры совместимости блокировок
- Если один процесс удерживает монопольную блокировку, другие процессы не смогут получить даже разделяемую блокировку до её освобождения.
- Для управления совместимостью используется **матрица совместимости блокировок**, которая показывает, какие режимы блокировок могут сосуществовать.

#### Блокировки в оперативной памяти
Важно отметить, что речь идет не о блокировках в оперативной памяти (которые быстро освобождаются), а о блокировках, связанных с данными. Информация о таких блокировках хранится в оперативной памяти сервера и видна через представление `pg_locks`.

---

### Ключевые моменты для Obsidian:

#### Основные принципы работы с блокировками
- **Захват блокировки**: Процесс должен захватить блокировку перед работой с данными.
- **Освобождение блокировки**: После завершения работы блокировка освобождается.
- **Несовместимость режимов**: Если блокировка уже удерживается в несовместимом режиме, новый процесс должен ждать её освобождения.

#### Матрица совместимости блокировок
| Режим блокировки | Разделяемая | Монопольная |
|------------------|-------------|-------------|
| Разделяемая      | Совместимо  | Несовместимо |
| Монопольная      | Несовместимо | Несовместимо |

#### Практические примеры
- **Чтение данных**: Процесс может использовать разделяемую блокировку, которая совместима с другими разделяемыми блокировками.
- **Изменение данных**: Требует монопольной блокировки, которая несовместима ни с какими другими блокировками.

#### Важные термины
- **Конкурентный доступ**: Доступ к разделяемым ресурсам несколькими процессами.
- **Монопольная блокировка**: Исключительный доступ к ресурсу.
- **Разделяемая блокировка**: Доступ, совместимый с другими разделяемыми блокировками.

---

Это завершает первую часть конспекта. Хотите перейти ко второй части?

