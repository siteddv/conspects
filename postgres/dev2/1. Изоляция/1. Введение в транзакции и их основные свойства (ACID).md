### Часть 1: Введение в транзакции и их основные свойства (ACID)

#### Определение транзакции
Транзакция — это множество операций, которые переводят базу данных из одного корректного состояния в другое. Главная особенность транзакции заключается в том, что все операции внутри неё должны выполняться **полностью** или **не выполняться вообще**. Это означает, что если одна из операций завершается с ошибкой, то все предыдущие изменения откатываются (отменяются), чтобы сохранить целостность данных.

Пример: Представим операцию перевода денег с одного счета на другой. Она состоит из двух шагов:
1. Списание денег с одного счета.
2. Зачисление денег на другой счет.

Если первый шаг выполнен успешно, но второй завершился ошибкой, то деньги не должны быть списаны с первого счета. Это обеспечивается свойством **атомарности** транзакций.

#### Четыре основных свойства транзакций (ACID)
1. **Атомарность (Atomicity)**  
   Транзакция должна быть выполнена как единое неделимое действие. Либо все её операции выполняются, либо ни одна. Если транзакция прерывается, все изменения откатываются.

2. **Согласованность (Consistency)**  
   Транзакция переводит базу данных из одного согласованного состояния в другое. Это означает, что после выполнения транзакции данные остаются корректными и соответствуют всем ограничениям целостности (например, внешние ключи, уникальность полей).  
   - **Ограничения целостности**: Правила, которые определяют допустимые значения данных в таблицах. Например, проверка на уникальность значений в столбце.
   - **Семантика приложения**: Логика работы приложения, которая может задавать дополнительные правила для данных. Например, при переводе денег сумма на счетах должна остаться неизменной.

3. **Изоляция (Isolation)**  
   Транзакции выполняются независимо друг от друга, даже если они работают с одними и теми же данными одновременно. Это гарантирует, что изменения одной транзакции не влияют на выполнение другой до тех пор, пока транзакция не зафиксирована (commit).

4. **Долговечность (Durability)**  
   После успешного завершения транзакции её изменения сохраняются в базе данных, даже если произойдет сбой системы. Это достигается через механизм журналирования (write-ahead logging), который фиксирует все изменения перед их применением к данным.

#### Пример с переводом денег между счетами
Рассмотрим пример перевода денег с одного счета на другой:
- **Шаг 1**: Списание денег с одного счета.
- **Шаг 2**: Зачисление денег на другой счет.

Если первый шаг выполнен успешно, но второй завершился ошибкой, то состояние базы данных становится **несогласованным**, потому что деньги были списаны, но не зачислены. Чтобы этого избежать, транзакция должна быть атомарной: либо оба шага выполняются, либо ни один.

#### Проблемы согласованности
Важно понимать, что согласованность — это не только соблюдение ограничений целостности, но и логическая корректность данных. Например, если мы выполнили первую операцию (списание денег), то состояние базы данных будет несогласованным до тех пор, пока мы не выполним вторую операцию (зачисление денег). 

Кроме того, некоторые ограничения целостности могут быть проверены не сразу, а отложены до окончания транзакции. Например, можно указать, что проверка уникальности значений в столбце должна выполняться только после завершения всех операций транзакции.

---

Это завершает первую часть конспекта. Хотите перейти ко второй части — "Свойства согласованности и изоляции транзакций"?