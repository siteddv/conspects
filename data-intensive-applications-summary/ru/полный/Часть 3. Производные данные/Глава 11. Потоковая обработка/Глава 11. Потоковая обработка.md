# Глава 11. Потоковая обработка

В этой главе были рассмотрены потоки событий — для каких целей они применяются и как их обрабатывать. В некоторых отношениях потоковая обработка очень похожа на пакетную, представленную в главе 10, с той разницей, что потоковая выполняется непрерывно и не на наборе входных данных фиксированного размера, а для неограниченных (бесконечных) потоков.

## Основные темы главы

### Потоки событий

Проблема с ежедневными пакетными процессами заключается в том, что изменения входной информации отражаются на выходе только через день — для многих нетерпеливых пользователей это слишком долго. Для уменьшения задержки можно чаще повторять обработку: например, обрабатывать данные раз в секунду или даже непрерывно, полностью отказавшись от разделения времени на фиксированные интервалы. Просто обрабатывать события по мере их возникновения. Это и есть идея потоковой обработки.

### Два типа брокерских сообщений

**Брокеры сообщений типа AMQP/JMS:**
- Брокер отправляет сообщения потребителям, а те высылают подтверждение каждый раз, когда сообщение успешно обработано
- После получения подтверждения удаляются из брокера сообщения
- Такая технология подходит в качестве асинхронной формы RPC

**Брокер сообщений на основе журналирования:**
- Брокер отправляет все сообщения из данного раздела одному узлу-потребителю и всегда в одном и том же порядке
- Параллелизм достигается путем секционирования, а потребители отслеживают прогресс, проверяя смещение последнего обработанного сообщения
- Брокер сохраняет сообщения на диске, поэтому при необходимости можно вернуться и прочитать старые сообщения заново

### Базы данных и потоки

Представление баз данных в виде потоков открывает широкие возможности для интеграции систем. Можно фиксировать историю всех изменений, сделанных в базе — либо неявно, путем захвата данных об изменениях, либо явно, через источники событий. Уплотнение журнала позволяет потоку сохранять полную копию содержимого БД.

### Обработка потоков

Средства для поддержания состояния в виде потоков и повторения сообщений легли в основу технологий, которые позволяют объединять потоки и обеспечивать отказоустойчивость в различных системах потоковой обработки.

**Применения:**
- Поиск событий по шаблону (сложная обработка событий)
- Вычисление оконных агрегаций (анализ потоков)
- Поддержание производных информационных систем в актуальном состоянии (материализованные представления)

**Три типа объединений:**
- Объединения «поток — поток»
- Объединения «поток — таблица»
- Объединения «таблица — таблица»

## Подтемы главы

- [[11.1. Передача потоков событий]] [11.1. Передача потоков событий](подтемы/11.1. Передача потоков событий.md) — системы обмена сообщениями, брокеры сообщений, секционирование журналов
- [[11.2. Базы данных и потоки]] [11.2. Базы данных и потоки](подтемы/11.2. Базы данных и потоки.md) — синхронизация систем, перехват изменений данных, источники событий, состояние, потоки и неизменяемость
- [[11.3. Обработка потоков]] [11.3. Обработка потоков](подтемы/11.3. Обработка потоков.md) — применение обработки потоков, рассуждения о времени, объединения потоков, отказоустойчивость
- [[11.4. Резюме]] [11.4. Резюме](подтемы/11.4. Резюме.md) — краткое резюме основных тем главы

