В этой главе рассмотрен широкий спектр проблем, возникающих в распределенных системах.

## Основные проблемы распределенных систем

### Ненадежность сети
- Вероятность потери или задержки на произвольное время отправленного по сети пакета
- Может потеряться или задержаться ответ, так что при его отсутствии невозможно узнать, дошло ли сообщение до адресата
- Неоднородность сетевых задержек может привести к ошибочному предположению о фатальном сбое узла
- Узел может работать хуже, чем обычно (например, снижение пропускной способности с гигабита до 1 Кб/с), что сложнее обнаружить, чем явный отказ

### Ненадежность часов
- Часы узла могут оказаться существенно рассинхронизированными с другими узлами, несмотря на настройку NTP
- Часы могут неожиданно перескакивать вперед или назад во времени
- Полагаться на часы опасно, так как неизвестен интервал их погрешности
- Использование часов истинного времени для упорядочивания событий может привести к потере данных

### Паузы процессов
- Выполнение процесса может быть приостановлено в любой момент на существенное время (например, вследствие паузы на сборку мусора)
- Процесс могут объявить неработающим другие узлы
- Процесс способен возобновить работу, не зная, что останавливался
- Это может привести к истечению договоров аренды и конфликтам при доступе к ресурсам

## Частичные отказы

Возможность **частичных отказов** (partial failures) — определяющая характеристика распределенных систем. При всяком действии программного обеспечения, вовлекающем использование других узлов, существует вероятность:
- Сбоя
- Замедления работы
- Полного прекращения ответа узла (с истечением времени ожидания)

В распределенных системах мы пытаемся сделать ПО устойчивым к частичным отказам, чтобы система в целом продолжала функционировать даже при отказе некоторых ее элементов.

## Обнаружение и обработка сбоев

**Проблемы обнаружения:**
- В большинстве систем нет безошибочных механизмов обнаружения сбоев узлов
- Большинство распределенных алгоритмов определяет доступность удаленного узла по времени ожидания
- Этот метод не позволяет различать сетевые отказы и отказы узлов
- Неоднородность сетевых задержек иногда приводит к ошибочному предположению о фатальном сбое узла

**Проблемы обработки:**
- Нет глобальных переменных, ни разделяемой памяти, ни общих знаний, ни какого-либо другого разделяемого всеми машинами состояния
- Узлы не могут даже согласовать время, не говоря уже о чем-то более существенном
- Единственный способ передачи информации между узлами — отправка по ненадежной сети
- Один узел не может принять никаких серьезных решений, так что необходимы протоколы, вовлекающие другие узлы и ищущие кворум для согласования решения

## Переход от однопроцессных к распределенным системам

Для разработчиков, привыкших писать программное обеспечение в идеальном мире одного компьютера, где одна операция всегда детерминистически возвращает тот же самый результат, переход к запутанной реальности распределенных систем может оказаться шоком.

Напротив, разработчики распределенных систем зачастую считают задачу тривиальной, при условии, что ее можно решить на отдельном компьютере. Отдельный компьютер в наши дни способен на многое, но распределение добавляет множество новых проблем и сложностей.

## Ключевые выводы

1. **Распределенные системы принципиально отличаются** от однопроцессных систем наличием частичных отказов
2. **Нет глобального источника истины** — истина определяется большинством узлов через механизмы кворума
3. **Время и синхронизация ненадежны** — нельзя полагаться на точное время или синхронизацию часов
4. **Обнаружение сбоев сложно** — нет безошибочных механизмов, приходится полагаться на время ожидания
5. **Требуются специальные протоколы** — для согласования решений между узлами, защиты от устаревших операций (ограждающие маркеры), обработки конфликтов

Эта глава подготовила нас к пониманию проблем распределенных систем, которые будут решаться в последующих главах с помощью различных алгоритмов и протоколов.

