На самом абстрактном уровне базы данных Hadoop и операционные системы выполняют одни и те же функции: хранят данные, позволяют их обрабатывать и запрашивать. В базе данные хранятся в виде записей, построенных по определенной информационной модели. В файловой системе они хранятся в файлах, но по своей сути то и другое — системы «управления информацией».

## Объединение технологий хранения данных

В книге мы обсудили различные возможности, предоставляемые базами данных, и технологии их работы. Похоже, есть параллели между функциями, встроенными в базы данных, и производными информационными системами, которые строят на базе пакетных и потоковых процессоров.

**Создание индекса:**
- Что происходит, когда мы делаем запрос CREATE INDEX? База проверяет согласованный снимок таблицы, выбирает все индексируемые значения полей, сортирует их и генерирует на выходе индекс
- Этот процесс очень похож на создание копии ведомого узла, а также на настройку перехвата изменений данных в потоковой системе
- Всякий раз при выполнении запроса CREATE INDEX база данных, по сути заново перерабатывает существующий набор данных и генерирует индекс как новое представление существующих данных

**Тотальная метабаза данных:**
- Поток данных всей организации начинает выглядеть как одна огромная БД
- Всякий раз, когда пакет, поток или ETL-процесс переносит данные из одних места и формы в другие место и форму, он действует подобно подсистеме базы, которая постоянно обновляет индексы и материализованные представления
- Пакетные и потоковые процессоры подобны сложным триггерам, хранимым процедурам и процедурам обслуживания материализованных представлений

**Два основных способа объединения:**
- **Объединенные базы данных: унифицированное чтение** — можно обеспечить единый интерфейс запросов для широкого круга базовых механизмов хранения и методов обработки
- **Разделенные базы данных: унифицированная запись** — идея объединения баз касается запросов на чтение в разных системах, она не предлагает хороших решений для синхронизации записи в этих системах

## Как сделать, чтобы разделение работало

**Традиционный подход:**
- Традиционный подход к синхронизации записи требует распределенных транзакций в гетерогенных системах хранения информации
- Это, по моему мнению, является ошибочным решением

**Альтернативный подход:**
- При пересечении данными границы между различными технологическими решениями я считаю гораздо более надежным и практичным подходом асинхронный журнал событий с идемпотентной записью
- Упорядоченный журнал событий с идемпотентными потребителями является гораздо более простой абстракцией, и, следовательно, его гораздо проще реализовать в гетерогенных системах

**Преимущества интеграции на основе журнала:**
- На системном уровне благодаря потокам асинхронных событий система в целом становится более устойчивой к отказам и падению производительности отдельных компонентов
- На уровне человеческого восприятия разделение информационных систем позволяет разрабатывать, улучшать и поддерживать различные программные компоненты и сервисы независимо друг от друга

## Разделенные и интегрированные системы

Даже если разделение систем действительно станет технологией будущего, то все равно не заменит базы данных в их нынешнем виде — они будут так же нужны, как и сейчас. Базы по-прежнему необходимы для хранения состояния потоковых процессоров и обслуживания запросов при генерации выходных данных пакетной и потоковой обработки.

**Цель разделения:**
- Цель разделения не конкуренция с отдельными базами данных по производительности для конкретных рабочих нагрузок, а возможность объединить несколько разных баз и получить хорошую производительность для гораздо более широкого диапазона рабочих нагрузок
- Речь идет не о глубине, а о широте — в том же смысле, что и разнообразие моделей хранения и обработки

## Проектирование приложений на основе потока данных

**Программный код как функция построения вторичных данных:**
- Когда один набор данных происходит от другого, он обрабатывается какой-то функцией преобразования
- Примеры: вторичный индекс, полнотекстовый поисковый индекс, система машинного обучения, кэш
- Когда функция, создающая производный набор данных, не является стандартной, для обработки специфических аспектов конкретного приложения нужно писать специальный, нестандартный, код

**Разделение кода приложения и состояния:**
- Теоретически база данных может служить средой развертывания для произвольного приложения, но на практике базы плохо подходят для этих целей
- Я полагаю, есть смысл предназначить отдельные части системы для долговременного хранения данных, в то время как другие части будут специализироваться на запуске приложений
- Тенденция заключается в том, чтобы отделить логику приложения без учета состояния от управления состоянием (с помощью БД)

**Потоки данных: взаимодействие между изменениями состояния и приложением:**
- Вместо того чтобы рассматривать БД как пассивную переменную, которой манипулирует приложение, мы уделяем гораздо больше внимания взаимодействию и сотрудничеству между состояниями, изменению состояния и коду, их обрабатывающему
- Код приложения реагирует на изменение состояния в одном месте, запуская изменение состояния в другом месте
- Разделение БД и приложений означает принятие этой идеи и применение ее к созданию производных наборов данных за пределами первичной базы

**Потоковые процессоры и сервисы:**
- Объединение потоковых операторов в системы потоков данных имеет много общих свойств с технологией микросервисов
- Однако базовый механизм коммуникации у них сильно различается: это однонаправленные, асинхронные потоки сообщений, а не синхронные взаимодействия типа «запрос — ответ»
- Подписка на поток изменений вместо запроса текущего состояния в момент необходимости приближает нас к модели расчета, подобной таблице

## Наблюдение за производными состояниями

**Путь записи и путь чтения:**
- Путь записи — та часть пути, где данные вычисляются предварительно; другими словами, это делается максимально быстро в момент поступления данных, независимо от того, поступал ли запрос на них
- Путь чтения — часть маршрута, которая выполняется только тогда, когда кто-то сделал запрос
- Производный набор данных — точка соединения пути записи и пути чтения

**Материализованные представления и кэширование:**
- Роль кэшей, индексов и материализованных представлений проста: они сдвигают границу между путем чтения и путем записи
- Они позволяют выполнять основную работу на пути записи, предварительно вычисляя результаты, чтобы сэкономить усилия на пути чтения

**Клиенты, сохраняющие состояние при отключении от сети:**
- Современные «одностраничные» веб-приложения JavaScript получили много возможностей с поддержкой состояния
- Мобильные приложения также могут хранить много состояний на устройстве и для большинства пользовательских операций не требуют обращения к серверу
- Это позволяет рассматривать состояние на устройстве как кэш состояния на сервере

**Передача изменений состояния клиентам:**
- Более новые протоколы вышли за рамки базового HTTP-шаблона «запрос — ответ»: события, отправленные сервером, и технология WebSocket предоставляют каналы связи
- Это позволяет серверу активно сообщать конечному клиенту о любых изменениях состояния, хранящегося локально, обновляя состояние на стороне клиента

**Сквозные потоки событий:**
- Было бы вполне естественно расширить эту модель программирования и позволить серверу вносить события изменения состояния в данный конвейер событий на стороне клиента
- Таким образом, изменения состояния могли бы проходить через сквозной путь записи: от взаимодействия на одном устройстве, через журналы событий и несколько производных информационных систем и потоковых процессоров, вплоть до пользовательского интерфейса и человека, наблюдающего за состоянием другого устройства

**Чтение тоже событие:**
- Запросы чтения тоже можно представить в качестве потоков событий и пропускать через потоковый процессор как события записи, так и события чтения
- Если и операции записи, и операции чтения представлять в виде событий и направлять для обработки к одному и тому же потоковому оператору, то получится фактически объединение «поток — таблица» между потоком запросов чтения и базой данных
- Еще одно потенциальное преимущество от записи событий чтения в журнал — возможность отслеживать причинно-следственные зависимости и происхождение данных в системе

**Обработка данных, хранящихся в нескольких разделах:**
- Если запросы касаются только одного раздела, то вычислительные затраты на отправку запросов через поток с последующим сбором потока ответов, вероятно, слишком высоки
- Однако эта идея открывает возможности распределенного выполнения сложных запросов, для которых необходимо объединить данные из нескольких разделов

