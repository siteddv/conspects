# Глава 9. Согласованность и консенсус

Рассматриваются модели согласованности (от конечной до линеаризуемости) и проблема достижения консенсуса в распределенных системах.

## [[9.1. Гарантии согласованности]] [9.1. Гарантии согласованности](../../../полный/Часть 2. Распределенные данные/Глава 9. Согласованность и консенсус/подтемы/9.1. Гарантии согласованности.md)

**Конечная согласованность:** слабая модель, данные со временем сходятся. Ограничения: устаревшие данные, проблемы для разработчиков.

**Согласованность чтения после записи:** пользователь видит свои изменения.

**Монотонное чтение:** предотвращение "движения во времени назад".

**Согласованное префиксное чтение:** сохранение причинно-следственной связи.

## [[9.2. Линеаризуемость]] [9.2. Линеаризуемость](../../../полный/Часть 2. Распределенные данные/Глава 9. Согласованность и консенсус/подтемы/9.2. Линеаризуемость.md)

**Линеаризуемость:** реплицированные данные выглядят как одна копия, все операции атомарны. Легко понять, но замедляет систему, особенно при больших сетевых задержках. Теорема CAP: нельзя одновременно обеспечить согласованность, доступность и устойчивость к разделению.

**Реализация:** репликация с ведущим узлом (синхронная), консенсусные алгоритмы. Ограничения: производительность, задержки.

## [[9.3. Гарантии упорядоченности]] [9.3. Гарантии упорядоченности](../../../полный/Часть 2. Распределенные данные/Глава 9. Согласованность и консенсус/подтемы/9.3. Гарантии упорядоченности.md)

**Причинность:** соблюдение последовательности событий на основе причинно-следственных связей. Более слабая модель, чем линеаризуемость, но эффективнее. Отдельные события могут быть конкурентными.

**Временные метки Лампорта:** отслеживание причинно-следственного порядка. Недостаточно для некоторых задач (уникальность имени пользователя).

**Рассылка общей последовательности:** протокол обмена сообщениями с надежной доставкой и полностью упорядоченной доставкой. Эквивалентна консенсусу.

## [[9.4. Распределенные транзакции и консенсус]] [9.4. Распределенные транзакции и консенсус](../../../полный/Часть 2. Распределенные данные/Глава 9. Согласованность и консенсус/подтемы/9.4. Распределенные транзакции и консенсус.md)

**Двухфазная фиксация (2PC):** координатор и участники. Проблемы: блокирующий протокол, застревание при сбое координатора, блокировки удерживаются долго.

**Отказоустойчивые консенсусные алгоритмы:** Paxos, Raft (etcd), Zab (ZooKeeper). Реализуют рассылку общей последовательности. Используют ведущий узел с гарантией уникальности в период. Ограничения: синхронная репликация, строгое большинство, фиксированный набор узлов, чувствительность к сетевым проблемам.

**Сервисы координации:** ZooKeeper, etcd. Функции: линеаризуемые атомарные операции, общая последовательность, обнаружение сбоев, уведомления об изменениях.

**Эквивалентные проблемы:** линейные реестры, атомарная транзакция, рассылка общей последовательности, блокировки, сервис членства, ограничение уникальности — все сводятся к консенсусу.

## [[9.5. Резюме]] [9.5. Резюме](../../../полный/Часть 2. Распределенные данные/Глава 9. Согласованность и консенсус/подтемы/9.5. Резюме.md)

Линеаризуемость — сильная, но дорогая гарантия. Причинность — более слабая, но эффективная модель. Рассылка общей последовательности эквивалентна консенсусу. Консенсус — фундаментальная проблема, к которой сводятся многие другие. 2PC — простой, но проблемный алгоритм. Отказоустойчивые алгоритмы (Paxos, Raft, Zab) — более надежные решения. Сервисы координации — практические реализации с дополнительными функциями.

---

**Подробнее:** [[Глава 9. Согласованность и консенсус]] [Глава 9. Согласованность и консенсус](Глава 9. Согласованность и консенсус.md)

