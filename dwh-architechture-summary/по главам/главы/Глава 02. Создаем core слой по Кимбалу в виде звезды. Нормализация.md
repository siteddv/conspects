# Глава 02. Создаем core слой по Кимбалу в виде звезды. Нормализация

Вторая глава курса посвящена созданию основного слоя хранилища данных (Core Layer) по методологии Кимбалла с использованием схемы "звезда" и нормализации данных.

## [[02.1. Введение и вопросы по прошлому занятию]] [02.1. Введение и вопросы по прошлому занятию](../полный/Глава 02. Создаем core слой по Кимбалу в виде звезды. Нормализация/подтемы/02.1. Введение и вопросы по прошлому занятию.md)

Разбираются вопросы участников по прошлому занятию: обновление схемы базы данных в PostgreSQL, создание новых подключений, получение списка баз данных через `pg_database`, работа с временными таблицами. Важный момент — типы данных в связанных таблицах должны совпадать для оптимальной производительности и использования памяти. Разбирается домашнее задание по заполнению таблицы случайными данными с использованием `ORDER BY RANDOM()`.

## [[02.2. Основные слои хранилища данных и нормализация]] [02.2. Основные слои хранилища данных и нормализация](../полный/Глава 02. Создаем core слой по Кимбалу в виде звезды. Нормализация/подтемы/02.2. Основные слои хранилища данных и нормализация.md)

Напоминание о трех основных слоях хранилища данных: Staging (сырые данные), Core (нормализованные данные) и Marts (витрины данных). Ключевая задача core-слоя — подготовка данных, их унификация и нормализация.

Рассматривается процесс нормализации данных для избежания дублирования, обеспечения согласованности и повышения гибкости хранения. Подробно разбираются три нормальные формы: 1NF (атомарность данных — в одной ячейке одно значение), 2NF (зависимость всех полей от составного ключа целиком), 3NF (зависимость полей только от первичного ключа, а не от других полей).

## Многомерное моделирование данных и схемы (звезда и снежинка)

Рассматриваются многомерные модели данных: схема "звезда" (star schema) и схема "снежинка" (snowflake schema). В схеме "звезда" факты находятся в центре, окруженные денормализованными измерениями. В схеме "снежинка" измерения нормализованы и разбиты на подтаблицы. Для хранилищ данных по Кимбалу предпочтительна схема "звезда" из-за простоты и производительности запросов.

## Создание таблиц в core-слое

Создается схема `core` в PostgreSQL. Создаются таблицы измерений: `dim_inventory` (информация о фильмах и дисках) с полями `inventory_pk`, `inventory_id`, `film_id`, `title`, `rental_duration`, `rental_rate`, `replacement_cost`, `rating`. Создается таблица фактов `fact_payment` (оплата аренды) с полями `payment_pk`, `date_id`, `inventory_pk`, `staff_pk`, `amount`, `payment_count` и внешними ключами на измерения. Формируется структура схемы "звезда" с фактами в центре и измерениями вокруг.

## Подведение итогов и домашнее задание

Проверяется структура базы данных, визуализируется связь между `fact_payment` и `dim_inventory`. Домашнее задание: создать таблицу измерений `dim_staff` (сотрудники и магазины) и таблицу фактов `fact_rental` (факты аренды). Все связи должны быть настроены через FOREIGN KEY. Занятие подготовило основу хранилища данных в виде схемы "звезда" с фактами и измерениями.

---

**Подробнее:** [[Глава 02. Создаем core слой по Кимбалу в виде звезды. Нормализация]] [Глава 02. Создаем core слой по Кимбалу в виде звезды. Нормализация](../полный/Глава 02. Создаем core слой по Кимбалу в виде звезды. Нормализация/Глава 02. Создаем core слой по Кимбалу в виде звезды. Нормализация.md)

