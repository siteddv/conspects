# 01.1. Введение в курс и концепция хранилищ данных

### **1.1. Начало курса и цели обучения**

- Курс посвящён **созданию хранилищ данных (DWH)**.
- До этого слушатели изучали **процедурные возможности PostgreSQL**:
    - Создание **функций** и **процедур**.
    - Использование **языка PL/pgSQL**.
- Теперь эти знания понадобятся, так как в курсе будут создаваться **ETL-процессы** для загрузки данных в хранилище.
- Введение в курс завершено, и **лектор спрашивает, есть ли вопросы** по прошлым занятиям.
- **Вопросов нет**, и он переходит к новой теме.

---

### **1.2. Зачем нужно хранилище данных?**

#### **1.2.1. Пример с магазином компакт-дисков**

- Представим базу данных небольшого **магазина по аренде компакт-дисков**.
    
- В этой базе данных есть несколько таблиц:
    
    - **Фильмы** (movies) — список всех фильмов.
    - **Компакт-диски** (CDs) — физические носители с фильмами.
    - **История аренды** — какие фильмы и когда брали клиенты.
    - **Платежи за аренду**.
- **Дополнительная бухгалтерская система** (например, 1С):
    
    - Там хранятся **расходы** (аренда помещения, зарплата сотрудников, коммунальные платежи).
    - Там нет информации о **доходах**, потому что она есть в базе данных магазина.
- **Проблема**:
    
    - Доходы хранятся в **одной системе** (БД магазина), а расходы — в **другой** (1С).
    - Нужно строить **отчёт по прибыли**, но нет единого источника данных.
    - Необходимо **объединить** данные из обеих систем.

#### **1.2.2. Проблема нагрузки на базы данных**

- В магазине **постоянно происходят изменения**:
    - Добавляются **новые платежи**.
    - Клиенты **берут и возвращают диски**.
- Если построить аналитический отчёт прямо в **основной базе данных**, это приведёт к **замедлению работы**.
- **Почему аналитические запросы создают нагрузку?**
    - Такие запросы **анализируют огромные объёмы данных**.
    - Например, отчёт по продажам **за год** может затрагивать **миллионы записей**.
    - **Обычная реляционная БД (OLTP)** плохо справляется с такими нагрузками.

#### **1.2.3. Решение проблемы — создание хранилища данных (DWH)**

- **Хранилище данных (Data Warehouse, DWH)** — это **отдельная система**, куда загружаются данные из разных источников.
- Все аналитические запросы выполняются **в хранилище**, а не в исходной базе данных.
- **Преимущества DWH**:
    - **Объединение данных** из разных систем.
    - **Минимизация нагрузки** на операционные базы данных.
    - **Более высокая скорость выполнения аналитических запросов**.

---

### **1.3. Основные слои хранилища данных**

- Хранилище данных **не просто копирует** информацию из исходных баз, а структурирует её по уровням.
- В классической архитектуре DWH есть **три основных слоя**:

#### **1.3.1. Источники данных**

- **Где хранятся оригинальные данные?**
    - **Бухгалтерская система (1С)**.
    - **База данных магазина компакт-дисков**.
    - **Excel-файлы с дополнительными данными** (например, смены сотрудников).
- Эти источники **не предназначены для сложных аналитических запросов**, поэтому **данные оттуда нужно загружать в хранилище**.

#### **1.3.2. Слой Staging (промежуточный слой)**

- **Что делает этот слой?**
    - Получает **данные из источников** в **сыром виде** (без изменений).
    - Загружает данные в хранилище, **не перегружая исходные базы данных**.
    - Позволяет **отделить процесс сбора данных от их дальнейшей обработки**.

#### **1.3.3. Слой Core (основное хранилище данных)**

- В этом слое данные уже **структурированы** и **обогащены**:
    - Применены **нормализация** и **очистка данных**.
    - Хранятся **исторические данные** (например, информация о доходах за прошлые годы).
    - Данные готовы для **быстрого построения отчетов**.

#### **1.3.4. Слой Data Marts (витрины данных)**

- **Data Mart** — это специально подготовленный набор данных, предназначенный для **конкретных отчётов**.
- Например:
    - Витрина для **финансового анализа** (доходы и расходы по месяцам).
    - Витрина для **анализа продаж фильмов**.
- **Зачем нужны Data Marts?**
    - Упрощают и ускоряют построение отчетов.
    - Оптимизированы под **конкретные запросы** аналитиков.

---

### **1.4. Data Marts и Кубы (OLAP)**

#### **1.4.1. Что такое OLAP-кубы?**

- **Куб OLAP (Online Analytical Processing)** — это специальная **структура данных**, оптимизированная для анализа.
- Куб содержит:
    - **Факты** (например, сумма продаж).
    - **Измерения** (например, дата, магазин, категория товара).
- Пример куба:
    - Измерения:
        - **Дата (месяцы)**.
        - **Магазины**.
        - **Категории товаров**.
    - Факт:
        - **Общая сумма продаж**.
- **Преимущество кубов**:
    - **Мгновенный анализ данных** (без необходимости сканировать всю базу).

#### **1.4.2. Влияние уровня детализации (гранулярности)**

- **Гранулярность** — это уровень детализации данных в кубе.
- **Чем выше детализация** (например, данные **по каждому часу**), тем:
    - **Дольше** строятся отчёты.
    - Больше записей в кубе.
- **Чем ниже детализация** (например, данные **по месяцам**), тем:
    - Отчёты строятся **быстрее**.
    - Но **теряется детализация информации**.

---

### **1.5. Специализированные системы для работы с кубами**

#### **1.5.1. Какие инструменты используются для построения кубов?**

- **Microsoft SQL Server Analysis Services (SSAS)**:
    - Поддерживает **MDX (Multi-Dimensional Expressions)**.
- **PostgreSQL и OLAP-кубы**:
    - PostgreSQL **не оптимизирован для кубов**.
    - Обычно используют **отдельные OLAP-системы** (например, ClickHouse, Greenplum).

#### **1.5.2. Почему сейчас кубы используются реже?**

- Современные базы данных (PostgreSQL, ClickHouse) **обрабатывают большие объемы данных быстрее**.
- Кубы используются **реже**, так как современные инструменты позволяют строить отчёты **на лету**.
- **Кубы всё ещё полезны**, но в **узкоспециализированных задачах**.

---

### **Выводы из первой части**

- **Хранилище данных (DWH) решает три задачи**:
    1. Объединяет данные из **разных источников**.
    2. **Разгружает** операционные базы данных.
    3. Позволяет **быстро строить отчеты**.
- **Три слоя хранилища данных**:
    - **Staging** (временное хранилище сырых данных).
    - **Core** (обогащенные данные).
    - **Data Marts** (готовые данные для отчетов).
- **OLAP-кубы** позволяют **анализировать данные быстрее**, но **используются реже**.

